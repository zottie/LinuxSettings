var trup,init,fire,lfgs,sycl,cfgo,uris,clip,dast,perm,blak,scbr,exts,down,D=!1;
Registry.require("statistics convert xmlhttprequest downloads cache storage uri compat parser helper syncinfo notify asker i18n native".split(" "),function(){var sa=function(a){D|=60<=a;J.debug(!1);p.debug(D,!1);U.debug(D)},n=Registry.prepare(!0),x=$.Deferred,K=function(a){var b=x();b.resolve(a);return b.promise()},N=function(){var a=x();a.reject();return a.promise()},ka=function(){var a=[],b=!0,c=function(a,b,f){var e={title:a.join("\n\n")};console.warn(a.join("\n"));chrome.browserAction.setIcon(b);
chrome.browserAction.setTitle(e);b=function(e,b,f){e={name:"1",sub_menu_item:!0,pos:"left",items:[]};e.items.push({name:a[0],image:"info"});1<a.length&&e.items.push({name:a[1]});f({items:[e],options:{enabled:!1}})};f||chrome.extension.onMessage.addListener(b)};return{run:function(){try{if(Registry.verify("52").length){var a=["Tampermonkey detected that Chrome is caching some outdated code parts.","In order to avoid unexpected behavior TM will be kept paused until Chrome was restarted."],
h={path:chrome.extension.getURL("images/icon_paused.png")};b=!1;c(a,h)}else chrome.extension.inIncognitoContext&&n.RUNTIME.CHROME&&28>n.RUNTIME.BROWSER_VERSION&&(a=["Tampermonkey detected that it can not work in incognito mode with your browser version.","Please update your browser to version 28 or higher."],h={path:chrome.extension.getURL("images/icon_paused.png")},b=!1,c(a,h))}catch(f){b=!1,console.error(f.message)}"chromeStorage"!=n.DB.USE||n.DB.NO_WARNING||window.setTimeout(function(){p.isWorking().fail(function(){confirm("Tampermonkey detected that your Chrome profile is broken!\n\nUnfortunately all extension data including your settings and userscripts is stored at the profile.\n\nDo you want to visit the FAQ entry that explains how to recover from that?")&&
chrome.tabs.create({url:"http://tampermonkey.net/faq#Q206"},function(){});var a={path:chrome.extension.getURL("images/icon_paused.png")};c(["Tampermonkey detected that your Chrome profile is broken!"],a,!0)})},1E3);return b},pause:c,setWarning:function(b,c,f){a.push({text:b,description:c,url:f})},getWarnings:function(){return a}}}();if(ka.run()){var y=n.WEBREQUEST;D&&console.debug("Starting background fred @"+ta);var u=Registry.get("helper"),X=Registry.get("cache"),Z=Registry.get("statistics"),p=
Registry.get("storage"),U=Registry.get("notify"),da=Registry.get("asker"),O=Registry.get("native"),V=Registry.get("permission"),Da=Registry.get("icon");perm=V;dast=p;var ta=u.createUUID(),P={},ea={};X.create("rundata").setOptions({timeout:180,check_interval:120,retimeout_on_get:!0}).init();X.create("resources").setOptions({timeout:1800,check_interval:300}).init();var Q=function(a,b){for(var c=function(a){return a?u.filter(a.replace(/-/g,"."),/[\.0-9]/g):""},d=c(a),c=c(b),d=d.split("."),c=c.split("."),
h=d.length<c.length?d.length:c.length,f=0;f<h;f++){d.length<h&&(d[f]=0);c.length<h&&(c[f]=0);if(Number(d[f])>Number(c[f]))return 1;if(Number(d[f])<Number(c[f]))return-1}return c.length<d.length?1:0};chrome.extension.manifest=function(){var a=chrome.extension.getURL("manifest.json"),b;try{if(a&&-1!=a.search("{"))b=JSON.parse(a);else{var c=new XMLHttpRequest;c.open("GET",a,!1);c.send(null);b=JSON.parse(c.responseText)}}catch(d){console.log("getVersion"+d.message),b={version:"0.0.0.0",name:"Tampermonkey"}}return b}();
chrome.extension.getVersion=function(){return chrome.extension.manifest.version};chrome.extension.getName=function(){return chrome.extension.manifest.name};var Fa=function(){var a=x(),b=chrome.extension.getVersion(),c=p.getSchemaVersion(),d=c;p.isWiped().then(function(a){a&&(a=["Tampermonkey detected inconsistencies that indicate that Chrome wiped the extension database!","You can continue to use Tampermonkey normally, but your settings and scripts might be lost. Click here to get more information.",
"http://tampermonkey.net/faq.php#Q207"],console.warn(a.join("\n")),ka.setWarning.apply(this,a));return p.getVersion("0.0.0.0")}).always(function(h){var f=1==Q(b,h),e=[],m=0,s=function(){if(m<e.length){var b=e[m].schema;e[m].cond(b)?e[m].fn().done(function(){b&&(console.log("Converted database from",d,"to",b),d=b);window.setTimeout(s,n.MISC.TIMEOUT)}).fail(function(){a.reject()}):window.setTimeout(s,n.MISC.TIMEOUT);m++}},g=function(){console.warn("Incognito mode detected. Database conversion can only be done in non-incognito mode! Stopping now...");
var a={path:chrome.extension.getURL("images/icon_paused.png")};ka.pause(["Tampermonkey needs to convert its database but this can't be done in incogonito mode!","Please open a non-incognito mode window and/or restart your browser."],a)},e=[{cond:function(){return f&&"chromeStorage"==n.DB.USE&&!p.getValue(n.CONSTANTS.STORAGE.LEGACY_VERSION)&&1==Q("3.5.3603",h)},fn:function(){var a=x();chrome.extension.inIncognitoContext?(g(),a.reject()):(console.log("Update database..."),d="3.5.3603",p.migrate("sql",
"chromeStorage").done(function(){console.log("Copied config for default usage of chrome.storage");a.resolve()}));return a.promise()}},{cond:function(){return f&&1==Q("3.6.3650",d)&&1==Q("3.5.3650",h)},fn:function(){var a=x();if(chrome.extension.inIncognitoContext)g(),a.reject();else{d="3.6.3650";var e=[];[{o:"TM_config",n:n.CONSTANTS.STORAGE.CONFIG},{o:"TM_update_check",n:n.CONSTANTS.STORAGE.UPDATE},{o:"TM_version"},{o:"TM_unload_ts"}].forEach(function(a){if(a.n){var b=p.getValue(a.o);void 0!==b&&
e.push(p.setValue(a.n,b))}e.push(p.deleteValue(a.o))});var b=/@re$/,f=[];p.listValues().forEach(function(a){-1!=a.search(b)&&(a=a.replace(b,""),f.push(a))});f.forEach(function(a){var b=p.getValue(a+"@st"),f=p.getValue(a),c=p.getValue(a+"@re"),d=p.getValue(a+"@source"),m=B.getUidByName(a)||u.createUUID();e.push(p.deleteValue(a+"@st"));e.push(p.deleteValue(a));e.push(p.deleteValue(a+"@re"));e.push(p.deleteValue(a+"@source"));f&&c&&d?(e.push(p.setValue(n.CONSTANTS.PREFIX.SCRIPT_UID+m,a)),e.push(p.setValue(n.CONSTANTS.PREFIX.COND+
m,c)),e.push(p.setValue(n.CONSTANTS.PREFIX.STORE+m,b)),e.push(p.setValue(n.CONSTANTS.PREFIX.SCRIPT+m,d)),e.push(p.setValue(n.CONSTANTS.PREFIX.META+m,f))):console.warn("invalid script entry",{source:d,meta:f,cond:c})});b=/@st$/;p.listValues().forEach(function(a){-1!=a.search(b)&&e.push(p.deleteValue(a))});$.when.apply($,e).done(function(){console.log("Converted database from",h,"to",d);a.resolve()})}return a.promise()}},{schema:"3.7.0",cond:function(a){return 1==Q(a,d)},fn:function(){var a=x();if(chrome.extension.inIncognitoContext)g(),
a.reject();else{var e=[],b=RegExp("^"+n.CONSTANTS.PREFIX.META);p.listValues().forEach(function(a){if(-1!=a.search(b)){var f=p.getValue(a);f.options&&f.options.override&&!f.options.override.orig_run_at&&(f.options.override.orig_run_at=f.options.run_at||"document-end",f.options.run_at=null,e.push(p.setValue(a,f)))}});$.when.apply($,e).done(function(){a.resolve()})}return a.promise()}},{schema:"4010",cond:function(a){return 1==Q(a,d)},fn:function(){var a=x();chrome.extension.inIncognitoContext?(g(),
a.reject()):a.resolve();return a.promise()}},{cond:function(){return f||1==Q(d,c)},fn:function(){var a=x();p.setVersion(b,d).done(function(){a.resolve()});return a.promise()}},{cond:function(){return f},fn:function(){console.log("First run of version "+b+"!");Ea.scheduleNotification(h,"0.0.0.0"==h);return K()}},{cond:function(){return!0},fn:function(){var e=x();a.resolve();window.setTimeout(e.resolve,n.MISC.TIMEOUT);return e.promise()}}];s()});return a.promise()},ua=function(){var a={get:function(a,
c){var d=(0==a)+"#"+c,h=X.items.rundata.getj(d);if(h)h.oldret.user_agent[a]=h.oldret.user_agent[h.frameId],h=h.oldret;else{for(var h=r.determineScriptsToRun(c),f=[],e=0,m={},s={},g=0;g<h.length;g++){var k=h[g];if(!k.enabled)e++;else if(0==a||!0!==k.options.noframes&&(null!==k.options.noframes||!0!==k.options.override.orig_noframes))k.options.user_agent&&(s[a]=k.options.user_agent),m[k.name]=!0,f.push(k)}h={runners:f,disabled:e,script_map:m,user_agent:s};X.items.rundata.setj(d,{frameId:a,oldret:h})}return h},
getUserAgent:function(b,c){return a.get(b,c).user_agent}};return a}(),v=function(){var a={},b=1,c=b++,d=b++,h=b++,f=b++,e=b++,m=b++,s=b++,g=b++,z=b++,C=function(){var a={frames:{0:{state:c}},tabs:{reset_ts:(new Date).getTime()},scripts:{},urls:{},maps:{},contexts:{onUnload:{}},stats:{running:0,disabled:0},extra:{}};Object.defineProperties(a.urls,{length:{value:0,enumerable:!1,writable:!0,configurable:!0}});return a},q={_info:function(){return a},listeners:{_onReset:[],_onCommited:[],_onCompleted:[],
add:{onReset:function(a){q.listeners._onReset.push(a);return q.listeners._onReset.length-1},onCommited:function(a){q.listeners._onCommited.push(a);return q.listeners._onCommited.length-1},onCompleted:function(a){q.listeners._onCompleted.push(a);return q.listeners._onCompleted.length-1}},remove:{onReset:function(a){q.listeners._onReset[a]=null},onCommited:function(a){q.listeners._onCommited[a]=null},onCompleted:function(a){q.listeners._onCompleted[a]=null}}},events:{reset:function(e,b){a[e]=C();a[e].frames[0].state=
c;u.each(q.listeners._onReset,function(a,f){a&&a(e,b)})},request:function(e,b,f){k.values.enabled&&(a[e]=a[e]||C(),a[e].frames[b]=a[e].frames[b]||{},a[e].frames[b].state=d,f=F.woHash(f),f=ua.getUserAgent(b,f),f[b]&&q.set.extra(e,b,"user_agent",f[b]))},response:function(e,b,f){if(k.values.enabled){a[e]=a[e]||C();a[e].frames[b]=a[e].frames[b]||{};var d=a[e].frames[b].state||c;a[e].frames[b].state=h;0===b&&(a[e].tabs.response_ts=(new Date).getTime());d<h&&(f=F.woHash(f),q.scripts.determine(e,b,f))}},
commited:function(e,b,d){if(k.values.enabled){var m=F.parse(d);if("http:"===m.protocol||"https:"===m.protocol||"file:"===m.protocol)a[e]=a[e]||C(),a[e].frames[b]=a[e].frames[b]||{},m=a[e].frames[b].state||c,a[e].frames[b].state=f,m<h&&(d=F.woHash(d),q.scripts.determine(e,b,d)),u.each(q.listeners._onCommited,function(a,b){a&&a(e)})}},loading:function(b,f,d){if(k.values.enabled){var m=F.parse(d);"http:"!==m.protocol&&"https:"!==m.protocol&&"file:"!==m.protocol||0!==f||"file:"!==m.protocol||(a[b]=a[b]||
C(),a[b].frames[f]=a[b].frames[f]||{},m=a[b].frames[f].state||c,a[b].frames[f].state=e,m<h&&(d=F.woHash(d),q.scripts.determine(b,f,d)))}},prepare:function(e,b,f,c){if(k.values.enabled){var d=0===b?b:f;a[e]=a[e]||C();a[e].frames[d]=a[e].frames[d]||{};c=F.woHash(c);a[e].frames[d].state=m;d=a[e].scripts[c];d||(q.scripts.determine(e,b,c),d=a[e].scripts[c]);b=d.runners.length;q.scripts.updateMaps(e,f,d.script_map);q.scripts.updateUrls(e,f,c);return b}},run:function(e,b,f,c,d){if(k.values.enabled){var m=
0===b?b:f;a[e]=a[e]||C();a[e].frames[m]=a[e].frames[m]||{};a[e].frames[m].state=s;var h=F.woHash(c);if(c=a[e].scripts[h])q.scripts.updateStats(e,f,c.runners.length,c.disabled),q.scripts.run(e,b,f,h,c.runners,function(){a[e]&&delete a[e].scripts[h];d&&d()});else{var g;D&&(g=a[e].scripts);console.warn("tv: no script run info for tab "+e+" @ "+h,g)}}},complete:function(e,b,f){f=F.parse(f);if(k.values.enabled&&("http:"===f.protocol||"https:"===f.protocol||"file:"===f.protocol)){if(0===b){a[e]=a[e]||C();
a[e].frames[b]=a[e].frames[b]||{};var d=a[e].frames[b].state||c;a[e].frames[b].state=g;if(!v.get.empty(e)&&v.get.stats(e).running){if(d<s){console.warn("tv: no script run info!");return}"file:"===f.protocol?window.setTimeout(function(){chrome.tabs.sendMessage(e,{method:"onLoad",frameId:b},function(a){})},500):(chrome.tabs.sendMessage(e,{method:"onLoad",frameId:b},function(a){}),L.runCheck&&chrome.contentSettings.javascript.clear({}))}}u.each(q.listeners._onCompleted,function(a,b){a&&a(e)})}},unload:function(e,
b,f){b=0===b?b:f;a[e]=a[e]||C();a[e].frames[b]=a[e].frames[b]||{};a[e].frames[b].state=z;if(a[e]&&a[e].contexts.onUnload[f]){for(b=0;b<a[e].contexts.onUnload[f].length;b++)a[e].contexts.onUnload[f][b]();a[e].contexts.onUnload[f]=[]}},remove:function(e){delete a[e]}},scripts:{updateStats:function(e,b,f,c){a[e].stats.running+=f;a[e].stats.disabled+=c;a[e].contexts.onUnload[b]=a[e].contexts.onUnload[b]||[];a[e].contexts.onUnload[b].push(function(){a[e].stats.running-=f;a[e].stats.disabled-=c});a[e].tabs.ts=
(new Date).getTime()},updateMaps:function(e,b,f){var c=1,d=function(b,f){void 0===a[e].maps[f]&&1===c&&(a[e].maps[f]=0);a[e].maps[f]+=c};u.each(f,d);a[e].contexts.onUnload[b]=a[e].contexts.onUnload[b]||[];a[e].contexts.onUnload[b].push(function(){a[e]&&(c=-1,u.each(f,d))})},updateUrls:function(e,b,f){var c=1,d=function(){void 0===a[e].urls[f]&&1===c&&(a[e].urls[f]=0);a[e].urls[f]+=c;a[e].urls.length=-1};d();a[e].contexts.onUnload[b]=a[e].contexts.onUnload[b]||[];a[e].contexts.onUnload[b].push(function(){a[e]&&
(c=-1,d())})},determine:function(e,b,f){b=ua.get(b,f);a[e].scripts[f]=b;return b.runners.length},run:function(a,e,b,f,c,d){for(var m=[],s=n.RUNTIME.ALLOWS_FAST_DOCUMENT_START&&k.values.runtime_fastDocumentStart,h=0;h<c.length;h++){var g=c[h];g.options.user_agent||g.evilness&&!(g.evilness<k.values.script_blacklist_severity)||m.push(Ga.inject({tabId:a,frameId:e,contextId:b,url:f},g,s&&("document-start"===g.options.run_at||!g.options.run_at&&"document-start"===g.options.override.orig_run_at)))}$.when.apply($,
m).always(function(){d&&d()})}},set:{extra:function(e,b,f,c){a[e]=a[e]||C();null===b?a[e].extra[f]=c:(a[e].extra[f]=a[e].extra[f]||{},a[e].extra[f][b]=c)},blocker:function(a,e){q.set.extra(a,null,"blocker",!0)},forbidden:function(a,e,b){0===e&&q.set.extra(a,null,"forbidden",!0)},fire:{count:function(a,e){q.set.extra(a,null,"fire_count",e)}}},get:{extra:function(e,b,f,c){void 0===c&&(c=null);var d=null,d=(a[e]?a[e].extra:{})[f];null!==b&&d&&(d=d[b]);return d||c},empty:function(e){var b=!0;if(a[e]&&
0!=a[e].urls.length){if(-1==a[e].urls.length)return a[e].urls.length=0,u.each(a[e].urls,function(b,f){"length"!==f&&0<b&&a[e].urls.length++}),q.get.empty(e);b=!1}return b},fire:{count:function(a){return q.get.extra(a,null,"fire_count")}},urls:function(e){return a[e]?a[e].urls:{}},stats:function(e,b){var f={};if(a[e]&&(f.running=a[e].stats.running,f.disabled=a[e].stats.disabled,b)){f.unique=0;for(var c in a[e].maps)a[e].maps.hasOwnProperty(c)&&0<a[e].maps[c]&&f.unique++}return f},tabs:function(){var e=
{};u.each(a,function(a,b){e[b]={ts:a.response_ts}});return e},blocker:function(a){return q.get.extra(a,null,"blocker")},forbidden:function(a,e,b){return q.get.extra(a,null,"forbidden")},user_agent:function(a,e){return q.get.extra(a,e,"user_agent")}}};return q}(),va=function(){return{isScriptUrl:function(a){if(!a||-1!=a.search(/\#bypass=true/)||-1!=a.search(n.REQUESTS.GET_INTERNAL_PAGE_REGEXP()))return!1;a=a.split(/[\?#$]/)[0];var b=-1!=a.search(/\.user\.(js\#|js\?|js$)/)||-1!=a.search(/\.tamper\.(js\#|js\?|js$)/);
return b?!(-1!=a.search(/^htt[ps]{1,2}:\/\/code\.google\.com/)||-1!=a.search(/^htt[ps]{1,2}:\/\/github\.com/)&&-1==a.search(/^htt[ps]{1,2}:\/\/github\.com\/[a-zA-Z0-9%-]\/[a-zA-Z0-9%-]\/raw\//)):b}}}(),wa=function(){var a=function(a){var c=x(),d=(new Date).getTime();a.url+=-1!=a.url.search("\\?")?"&":"?";a.url+="ts="+d;var d=function(e){if(4==e.readyState&&(200==e.status||0==e.status))if("arraybuffer"==h.responseType){if(e.response){c.resolve({decoded:!0,encoding:a.encoding,content:R.arrbuf2str(e.response,
a.encoding)});return}}else if(null!==e.response&&void 0!==e.response){c.resolve({decoded:!0,encoding:a.encoding,content:e.response});return}c.reject({content:""})},h={method:"GET",retries:0,responseType:"arraybuffer",url:a.url};if(a.sync){var f=W(h,{});4==f.readyState&&403==f.status&&(delete h.responseType,f=W(h,{}));d(f)}else W(h,{ondone:d});return c.promise()};return{getSource:function(b){"string"===typeof b&&(b={url:b});return a(b)}}}();lfgs=wa;var la=function(){return{isAllowed:function(a){var b=
!1,c=!1,d=0!=k.values.forbiddenPages.length,h=0!=k.values.page_whitelist.length;switch(k.values.page_filter_mode){case "black":c=d;break;case "off":break;case "white":b=h;break;default:b=h,c=d}d={inc:b?k.values.page_whitelist:void 0,exc:c?k.values.forbiddenPages:void 0};return!c&&!b||r.validUrl(a,d)}}}(),fa=function(){var a={init:function(){var b=x(),c=function(){"server"===k.values.script_blacklist_type&&window.setTimeout(a.checkUpdate,2E4)};c();k.addChangeListener("script_blacklist_type",c);b.resolve();
return b.promise()},getEvilnessOf:function(a){if("off"===k.values.script_blacklist_type)return!1;if(!a)return 0;var c=!1,d=0,h=function(f){var e=!1;if(f.length)return(e="/"==f.substr(0,1)?r.matchUrl(a,f):-1!=a.search(f))&&console.debug('black: entry "'+f+'" matched'),c|=e,!0!=c};u.each(k.values.require_blacklist,h);c?d=11:"server"===k.values.script_blacklist_type&&u.each(k.values.script_blacklist_server,function(a){if(a&&(u.each(a.rules,function(a){h(a);return!0!=c}),c))return d=a.severity,!1});return Number(d)},
checkUpdate:function(a){var c=x(),d=S.getConfig(),h;if(a||864E5<(new Date).getTime()-d.black.last){var f=function(a){var b=x();W({method:"GET",url:a,retries:n.XMLHTTPREQUEST.RETRIES,overrideMimeType:"text/plain; charset=x-user-defined"},{ondone:function(a){b.resolve(a)}});return b.promise()};f("http://blacklist.tampermonkey.net/get.php?version=get").then(function(e){if(4==e.readyState&&200==e.status){try{h=JSON.parse(e.responseText).version}catch(c){console.log("black: unable to parse version response! "+
e.responseText)}console.log("black: local version: "+d.black.version+" remote: "+h);if(h>d.black.version||a)return f("http://blacklist.tampermonkey.net/get.php")}}).then(function(a){if(a&&4==a.readyState&&200==a.status)try{var b=JSON.parse(a.responseText);b&&b.blacklist&&1==b.version&&(k.values.script_blacklist_server=b.blacklist);console.log("black: updated blacklist to ",b)}catch(f){console.log("black: blacklist update failed! ",a.responseText)}}).always(function(){d=S.getConfig();d.black.last=
(new Date).getTime();d.black.version=h||d.black.version;S.setConfig(d);c.resolve()})}else c.resolve();return c.promise()}};return a}();blak=fa;var I=function(){var a={fireDB:null,status:{initialized:!1,action:"Initializing"},resetStatus:function(b){void 0===b&&(b=!!a.fireDB);a.status={initialized:b,update:!1,download:!1,action:"",error:"",progress:{n:0,of:0}}},isReady:function(){return a.status.initialized&&!a.status.update&&!a.status.download},checkUpdate:function(b,c,d,h){var f=b||c;if(f||0!=k.values.fire_updatePeriod&&
k.values.fire_enabled){var e=S.getConfig(),m=function(){h&&h(""==a.status.error)};if(a.status.update||a.status.download){d&&d(!0);var s=function(){a.isReady()?m():window.setTimeout(s,1E3)};h&&s()}else if(f||(new Date).getTime()-e.fire.last>k.values.fire_updatePeriod){var g=0,z=function(){a.update(b,function(b){""==a.status.error&&(e=S.getConfig(),e.fire.last=(new Date).getTime(),e.fire.db_version=g,e.fire.entries=b,S.setConfig(e));m()})},f={method:"GET",url:a.updateURL()+"&db_version=get",retries:n.XMLHTTPREQUEST.RETRIES,
overrideMimeType:"text/plain; charset=x-user-defined"};W(f,{onload:function(a){if(4==a.readyState){if(200==a.status){try{g=JSON.parse(a.responseText).db_version}catch(b){console.log("bg: fire: unable to parse DB version response! "+a.responseText)}console.log("bg: fire: local DB version: "+e.fire.db_version+" remote: "+g);a=g>e.fire.db_version||c;d&&d(a);if(a){z();return}}m()}},onerror:function(){a.status.error="Update check request failed!";m()}})}else m()}},updateURL:function(){return k.values.fire_getURL+
"?ts=0"},update:function(b,c){var d=null,h=2,f=null,e=1,m=null,s=0,k={},z=function(){d&&window.clearTimeout(d);d=null},C=function(){z();d=window.setTimeout(f,12E4)},q=function(e){return{method:"GET",url:a.updateURL()+"&part="+e,retries:n.XMLHTTPREQUEST.RETRIES,overrideMimeType:"text/plain; charset=x-user-defined"}},aa=function(b){z();a.resetStatus();a.status.error=b;c&&c();console.log(g.getMessage("TamperFire_update_failed___")+" Error: "+b+" @ file:"+q(e).url);U.show("TamperFire",g.getMessage("TamperFire_update_failed___"),
chrome.extension.getURL("images/icon128.png"),3E4)},E=function(b){C();if(b.progress&&-1!=b.progress.totalSize){null==m&&(m=b.progress.totalSize);var f=60*m,c=b.progress.done+6*m*(e-1);c>f&&(c=f);a.status.progress={n:c,of:f};D&&0==++s%50&&console.log("bg: fire download: "+b.progress.done+" bytes "+c+"/"+f)}},A=function(b){C();if(4==b.readyState)if(200==b.status){z();var d={};b=b.responseText;try{d=JSON.parse(b)}catch(m){if(-1!=b.search("<body>")){var s=b.indexOf("<body>"),q=b.lastIndexOf("</body>");
-1!=s&&-1!=q&&(b=b.substr(s+6,q-(s+6)))}try{d=JSON.parse(b)}catch(E){aa("Parse Error! Update URL: ",a.updateURL(),E);return}}b=null;if(d.scripts){for(var A in d.scripts)k[A]=d.scripts[A];d=null;if(10>e)D&&console.log("bg: fire: download of file "+e+" succced"),e++,h=2,f();else{a.resetStatus();a.status.update=!0;a.status.action=g.getMessage("Update_in_progress");var l=function(e){!1===e?a.resetStatus(!1):(a.status.update=!0,a.insertValuesFromJSON({scripts:k},function(e){a.resetStatus();console.log(g.getMessage("TamperFire_is_up_to_date"));
U.show("TamperFire",g.getMessage("TamperFire_is_up_to_date"),chrome.extension.getURL("images/icon128.png"),3E4);c&&c(e)}),k=null)};a.clean(function(){a.initTables(l)})}}else aa("Invalid Content! Update URL: "+a.updateURL())}else aa("Update URL: "+b.status);else console.log(b)},f=function(){0<h?(a.status.action=g.getMessage("Downloading"),a.status.download=!0,C(),W(q(e),{ondone:A,onreadychange:E}),h--):aa("Download failed!")};console.log(g.getMessage("TamperFire_update_started"));U.show("TamperFire",
g.getMessage("TamperFire_update_started"),chrome.extension.getURL("images/icon128.png"),3E4);b||chrome.tabs.create({url:chrome.extension.getURL("fire.html")},function(){});f()},init:function(b){a.resetStatus(!1);a.initTables(function(c){c=!1!==c;b&&b(c);c&&window.setTimeout(a.checkUpdate,2E4)})},clean:function(b){var c=function(){b&&b()},d=function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE scripts",[],c,c)})},h=function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE excludes",
[],d,d)})},f=function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE includes",[],h,h)})},e=function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE scriptexcludes",[],f,f)})};(function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE scriptincludes",[],e,e)})})()},initTables:function(b){var c=function(){a.status.initialized=!0;b&&b()},d=null;try{d=window.openDatabase("tmFire","1.0","TamperFire",41943040)}catch(h){console.warn("Unable to open TamperFire database! ",
h.message);b&&b(!1);return}a.fireDB={db:d,onSuccess:function(a,e){},onError:function(a,e,b,f){console.error("fireDB Error "+JSON.stringify(e));b&&console.warn(" @ statement "+b);f&&console.warn("        with "+JSON.stringify(f))},createScriptTable:function(e){var f=function(e,f){a.fireDB.onError(e,f);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS scripts(sid INTEGER PRIMARY KEY ASC, value TEXT)",[],e,f)})},createScriptIncludesTable:function(e){var f=function(e,
f){a.fireDB.onError(e,f);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS scriptincludes(iid INTEGER, sid INTEGER, FOREIGN KEY(sid) REFERENCES scripts(sid),FOREIGN KEY(iid) REFERENCES includes(iid))",[],e,f)})},createIncludesTable:function(e){var f=function(e,f){a.fireDB.onError(e,f);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS includes(iid INTEGER PRIMARY KEY ASC, generic BOOLEAN, regex TEXT)",[],e,f)})},createScriptExcludesTable:function(e){var f=
function(e,f){a.fireDB.onError(e,f);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS scriptexcludes(eid INTEGER, sid INTEGER, FOREIGN KEY(sid) REFERENCES scripts(sid),FOREIGN KEY(eid) REFERENCES excludes(eid))",[],e,f)})},createExcludesTable:function(e){var f=function(e,f){a.fireDB.onError(e,f);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS excludes(eid INTEGER PRIMARY KEY ASC, regex TEXT)",[],e,f)})}};var f=function(){a.fireDB.createScriptExcludesTable(c)},
e=function(){a.fireDB.createScriptIncludesTable(f)},m=function(){a.fireDB.createExcludesTable(e)};a.fireDB.createScriptTable(function(){a.fireDB.createIncludesTable(m)})},insertValuesFromJSON:function(b,c){var d=[],h=[],f={},e={},m=[],s=[],t=[],z=[],C=0,q=0;console.log(g.getMessage("TamperFire_import_started"));for(var aa in b.scripts)b.scripts.hasOwnProperty(aa)&&d.push(aa);a.status.action=g.getMessage("Processing_scripts");a.status.progress={n:0,of:d.length};var E=0,A,l=0,n=function(){for(var a in f){var e=
C++;m.push([a,f[a].generic,e]);for(var b in f[a].sids)t.push([e,f[a].sids[b]])}},p=function(){for(var a in e){var b=q++;s.push([a,b]);for(var f in e[a].sids)z.push([b,e[a].sids[f]])}},r=function(e,b,f,c){if(f.length){a.resetStatus();a.status.update=!0;a.status.action=g.getMessage("Writing_scripts");a.status.progress={n:e,of:m.length+s.length+t.length+z.length};var d=function(){r(e,b,f,c)},h=f.length-1;1E4<h-A&&(h=A+1E4);D&&console.log("bg: write TF "+h);b(f.slice(A,h),function(){A>=f.length-1?c&&
c():window.setTimeout(d,0)});A=h;a.status.progress.n=e+A}else c&&c()},v=function(e){h.length?(a.scripts.setValues(h,e),h=[]):e&&e()},w=function(){var e=function(){c&&c(d.length)},b=function(){A=0;r(l,a.scriptExcludes.setValues,z,e);l+=z.length},f=function(){A=0;r(l,a.scriptIncludes.setValues,t,b);l+=t.length},h=function(){A=0;r(l,a.excludes.setValues,s,f);l+=s.length};n();p();v(function(){A=0;r(l,a.includes.setValues,m,h);l+=m.length})},x=function(){1E4<h.length?v(x):(E++,0==E%96?window.setTimeout(y,
0):y())},y=function(){D&&0==E%2048&&console.log("bg: import TF script "+d[E]);a.status.progress.n=E;if(E<d.length){var c=b.scripts[d[E]];h.push([d[E],JSON.stringify(c)]);for(var m=0;m<c.excludes.length;m++){var s=F.getRegExpFromInclude(c.excludes[m],{safe:!0,tryToFixUrl:k.values.tryToFixUrl,safeUrls:k.values.safeUrls});e[s]||(e[s]={sids:[]});e[s].sids.push(d[E])}for(m=0;m<c.includes.length;m++){var g=c.includes[m].trim(),s=F.getRegExpFromInclude(g,{safe:!0,tryToFixUrl:k.values.tryToFixUrl,safeUrls:k.values.safeUrls});
if(!f[s]){var C=0;if(-1!=g.search("^(https?)?(://)?[w.]{0,4}[*|.]+[/]?$")||-1!=g.search("^[.*/]+$")||-1!=g.search("^"+u.escapeForRegExp("*://*[$|/]"))||""==g.replace(/(https|http|\*).:\/\/\*/,"")||"*"==g)C=1;f[s]={sids:[],generic:C.toString()}}f[s].sids.push(d[E])}x()}else w()};y()},count:function(b,c,d,h){a.getValues(b,c,[d],function(a){h(a.length)})},setValue:function(b,c,d,h,f,e){a.setValues(b,[c,h],[h,f],e)},setValues:function(b,c,d,h){for(var f=0,e=[],m=[],s=0;s<c.length;s++)e.push(c[s]),m.push("?");
var g=function(c){if(f<d.length){var s="INSERT INTO "+b+"("+e.join(", ")+") VALUES ("+m.join(", ")+");";c.executeSql(s,d[f],g,function(e,b){a.fireDB.onError(e,b,s,d[f]);g(e)});f++}else h&&h()};a.fireDB.db.transaction(g)},getValues:function(b,c,d,h){var f=0,e=null,m=[],s=function(a,e){if(e.rows)for(var b=0;b<e.rows.length;b++)m.push(e.rows.item(b));f<d.length?g():h(m)},g=function(m){e||(e=m);var h=[];m=[];for(var g=f;g<d.length&&20>g-f;g++)m.push(c+"=?"),h.push(d[g]);e.executeSql("SELECT * FROM "+
b+" WHERE "+m.join(" OR "),h,s,a.fireDB.onError);f+=20};a.fireDB.db.transaction(g)},getMax:function(b,c,d){var h='MAX("'+c+'")',f=function(a,b){var f=0;b.rows&&b.rows.length&&(f=b.rows.item(0)[h]);d(f)};a.fireDB.db.transaction(function(e){e.executeSql("SELECT "+h+' FROM "'+b+'"',[],f,a.fireDB.onError)})},tab:{getItems:function(b,c){var d={},h=[],f=1,e=function(){for(var a in d)d.hasOwnProperty(a)&&h.push(d[a]);0==f&&c&&window.setTimeout(function(){c(h)},1)},m=function(a){for(var b=0;b<a.length;b++)d[a[b]["uso:script"]]=
a[b];0==--f&&e()};v.get.empty(b)||u.each(v.get.urls(b),function(e,b){la.isAllowed(b)&&(f++,a.url.getItems(b,m))});f--;e()},getCountCallbacks:{},resetFireCnt:function(b){a.tab.getCountCallbacks[b]=[];v.set.fire.count(b,null)},getCount:function(b,c){var d=v.get.fire.count(b);d?c(d):(d=function(c){v.set.fire.count(b,c.length);c=c.length;if(a.tab.getCountCallbacks[b])for(;0<a.tab.getCountCallbacks[b].length;){var f=a.tab.getCountCallbacks[b].pop();f&&f(c)}},a.tab.getCountCallbacks[b]||(a.tab.getCountCallbacks[b]=
[]),0==a.tab.getCountCallbacks[b].length&&a.tab.getItems(b,d),a.tab.getCountCallbacks[b].push(c))}},url:{getCount:function(b,c){D&&console.log("bg: TF: get count for URL "+b);var d=function(a,e){var b=0;e.rows&&e.rows.length&&(b=e.rows.item(0)["count(*)"]);c(b)},h="",h=h+"SELECT count(*) FROM scripts WHERE sid IN ",h=h+"    (SELECT sid FROM scriptincludes WHERE iid IN (SELECT iid FROM includes WHERE generic=0 AND ? REGEXP regex)) ",h=h+"AND NOT sid IN ",h=h+"    (SELECT sid FROM scriptexcludes WHERE eid IN (SELECT eid FROM excludes WHERE ? REGEXP regex)) ";
a.fireDB.db.transaction(function(f){f.executeSql(h,[b,b],d,a.fireDB.onError)})},getItems:function(b,c){D&&console.log("bg: TF: get scripts for URL "+b);var d=[],h,f=0,e=0;h="SELECT * FROM scripts T1 WHERE T1.sid IN     (SELECT sid FROM scriptincludes WHERE iid IN (SELECT iid FROM includes WHERE generic=0 AND ? REGEXP regex)) ";h+="AND NOT T1.sid IN ";h+="    (SELECT sid FROM scriptexcludes WHERE eid IN (SELECT eid FROM excludes WHERE ? REGEXP regex)) ";var m="*"==b,s=m?"SELECT DISTINCT t1.value, t1.sid FROM scripts T1 JOIN scriptincludes T2 ON T1.sid=T2.sid WHERE T2.iid IN (SELECT iid FROM includes WHERE generic=0)":
h,g=function(a,b){e=(new Date).getTime();D&&console.log("bg: TF db access: 1 -> "+(e-f)+"ms");if(b.rows&&b.rows.length)for(var m=0;m<b.rows.length;m++)try{var h=b.rows.item(m).value;d.push(JSON.parse(h))}catch(s){console.error("bg: error parsing TamperFire entry ",b.rows.item(m))}else console.warn("bg: warn: no scripts entry");c(d)};a.fireDB.db.transaction(function(e){f=(new Date).getTime();e.executeSql(s,m?[]:[b,b],g,a.fireDB.onError)})}},ids:{getItems:function(b,c){var d=[],h=function(a){if(a&&
a.length)for(var e=0;e<a.length;e++)try{d.push(JSON.parse(a[e]))}catch(b){console.error("bg: error parsing TamperFire entry "+a)}else console.warn("bg: warn: no scripts entry");c(d)};b.length?a.scripts.getValues(b,null,h):c(d)}},includes:{setValues:function(b,c){a.setValues("includes",["regex","generic","iid"],b,c)}},scriptIncludes:{setValues:function(b,c){a.setValues("scriptincludes",["iid","sid"],b,c)}},excludes:{setValues:function(b,c){a.setValues("excludes",["regex","eid"],b,c)}},scriptExcludes:{setValues:function(b,
c){a.setValues("scriptexcludes",["eid","sid"],b,c)}},scripts:{getValues:function(b,c,d){a.getValues("scripts","sid",b,function(a){for(var b=[],e=0;e<a.length;e++)b.push(a[e].value);d(b)})},setValue:function(b,c,d){a.setValue("scripts","sid",b,"value",c,d)},setValues:function(b,c){a.setValues("scripts",["sid","value"],b,c)}}};return a}();fire=I;var Ha=function(){for(var a=[],b=[],c=0;c<a.length;c++){var d=Registry.getRaw("system/"+a[c]+".tamper.js");d&&b.push(d)}return b},l={initialized:!1,listenerRegistered:!1,
enabled:!1,syncing:0,period:null,syncDoneListener:[],scheduled:{to:null,force:null,t:0},SYNCED:{comment:!0},createTeslaData:function(a){for(var b=[],c=l.getLocalScriptList(),d=0;d<c.length;d++)if(c[d].url){var h=JSON.stringify(c[d].options),h=c[d].name.replace(/\|/g,"!")+"|"+h+"|"+c[d].url.replace(/\|/g,"%7C");b.push(h)}a&&a(b)},enable:function(a){l.enabled?D&&l.initialized&&l.listenerRegistered&&console.log("sync: reenable?"):l.enabled=0==k.values.sync_type?!1:J.init(k.values.sync_type,k.values.sync_id);
l.listenerRegistered||(J.addChangeListener(l.remoteChangeCb),l.listenerRegistered=!0);l.initialized||(l.initialized=!0);a&&a(l.enabled)},finalize:function(){},reset:function(a){J.reset().always(a)},addSyncDoneListener:function(a){l.syncDoneListener.push(a)},runAllSyncDoneListeners:function(a){for(;l.syncDoneListener.length;)l.syncDoneListener.shift()(a)},scheduleSync:function(a,b){var c=(new Date).getTime();b=l.scheduled.force||b;l.scheduled.to?(window.clearTimeout(l.scheduled.to),l.scheduled.ts<
c+a&&(a=l.scheduled.ts-c,1>a&&(a=1))):D&&console.debug("sync: schedule sync for run in "+a+" ms");var d=function(){l.sync(l.scheduled.force);l.scheduled.to=null;l.scheduled.force=null};l.scheduled.to=window.setTimeout(function(){k.values.sync_type==J.types.eCHROMESYNC?l.listenerRegistered?d():l.enable(d):d()},a);l.scheduled.force=b;l.scheduled.ts=c+a},schedulePeriodicalCheck:function(){l.period||(D&&console.debug("sync: schedule sync for periodical run every 18000000 ms"),l.period=window.setInterval(l.sync,
18E6))},disablePeriodicalCheck:function(){l.period&&(D&&console.debug("sync: disable periodical sync"),window.clearInterval(l.period),l.period=null)},getLocalObjFromScript:function(a){var b=a.downloadURL?a.downloadURL.split("#")[0]:null,c=a.fileURL?a.fileURL.split("#")[0]:null,d=u.select([c,b],function(a){if(!a||"file:"!==F.parse(a).protocol)return a})[0],b={uuid:a.uuid,name:a.name,options:{},durl:b,furl:c,url:d},h;for(h in l.SYNCED)!0===l.SYNCED[h]&&null!==a.options[h]&&(b.options[h]=a.options[h]);
return b},getLocalScriptList:function(){var a=[];B.getUidList().forEach(function(b){b=B.getByUid(b);b.script&&b.cond&&a.push(l.getLocalObjFromScript(b.script))});return a},getRemoteScriptList:function(a){J.list().done(a).fail(function(){a([])})},checkSyncAccount:function(a,b,c){var d=null;b=function(a){null==d&&(d=window.setTimeout(function(){l.enable(function(){l.scheduleSync(3E3,a)});d=null},200))};"sync_enabled"==a?c?(k.values.sync_type==J.types.ePASTEBIN&&l.schedulePeriodicalCheck(),b()):(l.enabled=
!1,l.disablePeriodicalCheck()):"sync_type"==a?(c==J.types.ePASTEBIN?l.schedulePeriodicalCheck():c==J.types.eCHROMESYNC&&l.disablePeriodicalCheck(),b()):"sync_id"==a&&k.values.sync_type==J.types.ePASTEBIN&&b()},sync:function(a){if(0<l.syncing)a&&l.addSyncDoneListener(function(e){e&&l.scheduleSync(50,a)});else if(l.enabled){l.syncing++;var b=null,c=null,d=[],h=!0,f={},e=function(){if(0<d.length){var a=d.shift();window.setTimeout(a,1)}},m=function(a){(c=a)?e():(D&&console.error("sync: unable to get remotelist!"),
h=!1,z())};d.push(function(){l.getRemoteScriptList(m);b=l.getLocalScriptList()});var s=function(a){if(a){(a=a.split("#")[0])&&(a=a.toLowerCase());for(var e=0;e<b.length;e++){var f=b[e].furl?b[e].furl.toLowerCase():null,c=b[e].durl?b[e].durl.toLowerCase():null;if(f==a||c==a)return b[e]}}return null},t=function(a){if(a){a=a.split("#")[0];for(var e=0;e<c.length;e++)if(c[e].url==a)return c[e]}return null};d.push(function(){for(var a=1,b=function(b){0==--a&&e()},d=0;d<c.length;d++){var m=c[d],h=!1,k=!1,
t=s(m.url);if(t){h=!0;f[m.url]=!0;for(var z in l.SYNCED)if(!0===l.SYNCED[z]&&t.options[z]!=m.options[z]){k=!0;break}}if(h)if(m.options.removed)D&&console.debug("sync: remove local script "+(m.name||m.url)),r.doRemove(t.uuid,!1);else if(k)if(D&&console.debug("sync: update local script "+(m.name||m.url)),k=B.getByUid(t.uuid),k.script&&k.cond){for(z in l.SYNCED)!0===l.SYNCED[z]&&(k.script.options[z]=m.options[z]);r.doModify(k.script.uuid,k.script,!1)}else console.log(g.getMessage("fatal_error")+"("+
t.name+")!!!");h||m.options.removed||(a++,l.importScript(m,b))}b()});k.values.sync_type!=J.types.ePASTEBIN&&d.push(function(){for(var a=1,c=function(b){0==--a&&e()},d=0;d<b.length;d++){var m=!1,h=b[d],s=h.url;s&&!f[s]&&(t(s)&&(m=!0),m||(a++,l.exportScript(h,c)))}c()});var z=function(){D&&console.debug("sync: finished");0==--l.syncing&&l.runAllSyncDoneListeners(h)};d.push(z);e()}},importScript:function(a,b){D&&console.debug("sync: import "+(a.name||a.url));var c={imported:k.values.sync_type},d={},
h;for(h in l.SYNCED)!0===l.SYNCED[h]&&(d[h]=a.options[h]);r.installFromUrl(a.url,{ask:!1,internal:!0,sync:c,force_options:d},{silent_fail:!0}).always(function(a){b&&b(a)})},exportScript:function(a,b){D&&console.debug("sync: export "+(a.name||a.url));J.add(a).done(function(){b&&b(!0)}).fail(function(){b&&b(!1)})},removeScript:function(a,b){D&&console.debug("sync: remove "+(a.name||a.url));J.remove(a).always(b)},remoteChangeCb:function(a,b){l.enabled&&k.values.sync_type==J.types.eCHROMESYNC&&l.scheduleSync(500,
!0)},scriptAddedCb:function(a,b){if(l.enabled){var c=l.getLocalObjFromScript(b);c.url&&F.parse(c.url).protocol.match(/https?:/)&&l.exportScript(c)}},scriptChangedCb:function(a,b,c){if(l.enabled&&(a=l.getLocalObjFromScript(b),a.url))for(var d in l.SYNCED)if(!0===l.SYNCED[d]&&b.options[d]!=c.options[d]){l.exportScript(a);break}},scriptRemovedCb:function(a,b){if(l.enabled){var c=l.getLocalObjFromScript(b);c.url&&l.removeScript(c)}}};sycl=l;var Ia=function(a){k.addChangeListener("scriptblocker_overwrite",
L.init);k.addChangeListener("sync_enabled",l.checkSyncAccount);k.addChangeListener("sync_type",l.checkSyncAccount);k.addChangeListener("sync_id",l.checkSyncAccount);k.addChangeListener("fire_enabled",function(a,c,d){d&&!I.status.initialized&&I.init()});k.addChangeListener("logLevel",function(){sa(k.values.logLevel)});k.addChangeListener("i18n",function(){g.setLocale(k.values.i18n);da.setLocale(k.values.i18n)});k.addChangeListener("native_import_path",function(){O.setPath(k.values.native_import_path)});
k.addChangeListener("incognito_mode",function(){xa()});k.addChangeListener("require_blacklist",r.blackCheckAll);k.addChangeListener("script_blacklist_server",r.blackCheckAll);k.addChangeListener("script_blacklist_type",r.blackCheckAll);k.addChangeListener("downloads_extension_whitelist",M.config_changed_listener);k.addChangeListener("downloads_mode",M.config_changed_listener)},k=function(){var a;a="// ==UserScript==\n// @name       My Fancy New Userscript\n";a+="// @namespace  http://use.i.E.your.homepage/\n";
a+="// @version    0.1\n";a+="// @description  enter something useful\n";a+="// @match      <$URL$>\n";a+="// @copyright  2012+, You\n";a+="// ==/UserScript==\n\n";var b={},c={enabled:!0,configMode:0,safeUrls:!0,tryToFixUrl:!0,debug:!1,logLevel:0,showFixedSrc:!1,webrequest_modHeaders:"yes",webrequest_fixCSP:"yes",scriptblocker_overwrite:"no",notification_showUpdate:"changelog",notification_silentScriptUpdate:!0,scriptTemplate:a,scriptUpdateCheckPeriod:864E5,scriptUpdateHideNotificationAfter:15E3,
scriptUpdateCheckDisabled:!1,runtime_fastDocumentStart:!0,runtime_unsafeWindow:"auto",autoReload:!1,appearance_badges:"running",fire_enabled:!1,fire_sort_cache_enabled:!0,fire_getURL:"http://fire.tampermonkey.net/get.php",fire_updatePeriod:12096E5,fire_topOnly:!0,editor_enabled:!0,editor_keyMap:"windows",editor_indentUnit:4,editor_indentWithTabs:!1,editor_tabMode:"smart",editor_enterMode:"indent",editor_electricChars:!0,editor_autoSave:!1,editor_easySave:!0,native_import:!0,native_import_path:null,
native_import_post_action:"disable",i18n:null,incognito_mode:"temporary",layout:"default",sync_enabled:!1,sync_type:2,sync_id:"",statistics_enabled:!0,downloads_mode:"default",downloads_extension_whitelist:"/^[^\\.]*$/ /\\.mp[34]$/ .wav /\\.(avi|mkv|flv|divx|mpe?g)$/ /\\.(ico|gif|png|jpe?g)/ .txt .iso .zip /\\.r(ar|[0-9]{2,2})$/".split(" "),require_timeout:2E4,require_blacklist:["/^https?:\\/\\/example.com\\/.*/"],script_blacklist_server:[],script_blacklist_type:"server",script_blacklist_severity:4,
page_filter_mode:"black",page_whitelist:["/https?:\\/\\/userscripts\\.org\\/.*/","http://xkcd.com/970/"],forbiddenPages:"*.paypal.tld/* https://*deutsche-bank-24.tld/* https://*bankamerica.tld/* *://apis.google.com/_/+1/*button* *://www.facebook.com/plugins/* *://platform.twitter.com/widgets/*".split(" ")},d=function(a,e){var d=p.getValue(n.CONSTANTS.STORAGE.CONFIG,{}),h=void 0===d[a]?c[a]:d[a];b[a]&&JSON.stringify(h)!=JSON.stringify(e)&&b[a].forEach(function(b){window.setTimeout(function(){b(a,h,
e)},1)});d[a]=e;p.setValue(n.CONSTANTS.STORAGE.CONFIG,d)},h={init:function(){var a=x();h.values={};for(var e in c)c.hasOwnProperty(e)&&function(){var a=e;h.values.__defineGetter__(a,function(){var e=p.getValue(n.CONSTANTS.STORAGE.CONFIG,{});return void 0===e[a]?c[a]:e[a]});h.values.__defineSetter__(a,function(e){d(a,e)})}();h.images={};h.images.icon="images/icon.png";h.initialized=!0;var b=Ha(),s;for(s in b){var g=b[s];window.setTimeout(function(){r.doSave({url:null,src:g,ask:!1,replace:!0,internal:!0})},
1)}a.resolve();return a.promise()},addChangeListener:function(a,e){b[a]||(b[a]=[]);b[a].push(e)}};return h}(),W=function(a,b){return ia(a,b,{internal:!0})},T=function(){var a={key:function(a,b){return n.CONSTANTS.PREFIX.EXTERNAL+u.select([a,b?R.MD5(b):null],function(a){return a}).join(":")},list:function(a){var b=RegExp("^"+a);return u.select(p.listValues(),function(a){return-1!=a.search(b)})},set:function(e,b,f){var c=a.key(e,b),d={};u.each(f,function(a,e){"content"==e&&(e="base",a=R.encodeS(a));
d[e]=a});p.setValue(c,{ts:(new Date).getTime(),url:b,resource:d});console.log("externals: storage.set ->",e,b,d)},get:function(e,b){var f=a.key(e,b),f=p.getValue(f),c;if(f&&f.resource){var d={};u.each(f.resource,function(a,e){"base"==e&&(e="content",a=R.decodeS(a));d[e]=a});c={ts:f.ts,url:f.url,data:d}}console.log("externals: storage.get ->",e,b,c);return c},clean:function(e,b){var f=a.key(e,b);console.debug("externals: storage.clean",b,f);p.deleteValue(f)},cleanAll:function(e,b){console.log("externals: storage.cleanAll",
e,b);var f,c=a.list(a.key(e));if(b){var d={};u.each(b,function(b){b=a.key(e,b);d[b]=!0});f=[];u.each(c,function(a){d[a]||(console.debug("externals: storage.clean.drop ",a),f.push(a))})}else f=c;f.forEach(function(a){p.deleteValue(a)})}},b=function(a,b){var f=x();console.log("externals: loadAndDecode",a,b);var c={method:"GET",url:a,retries:n.XMLHTTPREQUEST.RETRIES,responseType:b.via_arraybuffer?"arraybuffer":void 0},d=function(c){var d={content:""};if(4!=c.readyState||200!=c.status&&0!=c.status)console.log("externals: loadAndDecode failed ->",
a,d),f.reject(d);else{var h,g=c.responseHeaders?c.responseHeaders.split("\n"):null,k;for(k in g){var t=g[k].split(":"),C=t.shift()||"",t=t.join(":")||"";if("content-type"==C.trim().toLowerCase()&&-1!=t.search("image")){h=t.trim();break}}h||(-1!=a.search(".ico$")||-1!=a.search(".jpg$")?h="image/x-icon":-1!=a.search(".gif$")?h="image/gif":-1!=a.search(".png$")?h="image/png":u.isLocalImage(a)&&(h="image/x-icon"));d.meta=h;d.content=b.via_arraybuffer?R.arrbuf2str(c.response):c.responseText;console.log("externals: loadAndDecode ->",
a,d);f.resolve(d)}},h=function(a){f.reject({})};b.sync?d(W(c,{})):(c.timeout=k.values.require_timeout,W(c,{onload:d,onerror:h,ontimeout:h}));return f.promise()},c=u.getDebouncer(9E3),d=function(e,b,f){console.log("externals: update",e,b,f);f.no_storage=!0;h(e,b,f).done(function(f){console.log("externals: update.done",e,b,f);a.set(e,b,f.resource)}).fail(function(a){console.log("externals: update.failed :(",e,b)}).always(function(f){(f=a.get(e,b))&&f.data?a.set(e,b,f.data):console.warn("externals: should never happen!")})},
h=function(e,f,h){console.log("externals: get",e,f,h);var g=x(),z=F.parse(f),C={sync:h.sync},q;if(f)if(fa.getEvilnessOf(f)>=k.values.script_blacklist_severity)C.resource={blacklisted:!0,content:""},g.reject(C);else if(!h.no_storage&&"file:"!==z.protocol&&(q=a.get(e,f))){var l=a.key(e,f),E=(new Date).getTime();2592E5<E-q.ts&&(c.is(l)?console.log("externals: de-bounced resource update",e,f):(c.add(l),console.log("externals: resource needs update",f,(new Date(q.ts)).toISOString(),(new Date(E)).toISOString()),
window.setTimeout(function(){d(e,f,h)},3E3)));C.resource=q.data;g.resolve(C)}else C.sync=!1,"file:"==z.protocol?(n.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS||console.warn("externals: Access to local files is forbidden! Loading the following @resource may fail:",f,"-> more info:","http://tampermonkey.net/faq.php#Q204"),q=wa.getSource({url:f,encoding:h.encoding})):q=b(f,{via_arraybuffer:h.via_arraybuffer}),q.done(function(b){console.log("externals: get.done",e,f,b);h.no_storage||"file:"===z.protocol||a.set(e,
f,b);C.resource=b;g.resolve(C)}).fail(function(a){console.log("externals: get.failed",e,f,a);C.resource={failed:!0,content:""};g.reject(C)});else C.resource={forbidden:!0,content:""},g.reject(C);return g.promise()},f={getElement:function(e,b){return a.get(e,b)},cleanElement:function(e,b){return a.clean(e,b)},dropAll:function(e){a.cleanAll(e);return K()},dropAllBut:function(e,b){a.cleanAll(e,b);return K()},loadResources:function(a,b){var c=x();f.getResources(a,b).always(function(){c.resolve()});return c.promise()},
loadRequires:function(a,b){var c=x();f.getRequires(a,b).always(function(){c.resolve()});return c.promise()},getResources:function(a,b){var f={elements:[]},c=x(),d=[],g={via_arraybuffer:!0,sync:!0};b.forEach(function(b){var c={name:b.name},m=h(a,b.url,g),k=x();m.done(function(f){f=f.resource;var d=[b.url,f.content.length].join(),h=X.items.resources.get(d)||{};try{c.resText=h.resText?h.resText:R.UTF8.decode(f.content)}catch(g){c.resText=""}try{c.resURL=h.resUrl?h.resURL:f.meta?"data:"+f.meta+";base64,"+
R.Base64.encode(f.content):R.Base64.encode(f.content)}catch(m){c.resURL=b.url}X.items.resources.set(d,{resText:c.resText,resURL:c.resURL});console.log("externals: getResources -> ",a,b,c)}).fail(function(a){a.resource&&a.resource.forbidden?console.warn("externals: can't load @resource",b.name,"from forbidden URL",b.unsafe_url):a.resource&&a.resource.blacklisted?console.warn("externals: can't load @resource",b.name,"from blacklisted URL",b.unsafe_url):console.warn("externals: can't load @resource",
b.name,"from URL",b.unsafe_url);c.resText="";c.resURL=""}).always(function(a){g.sync&=a.sync;f.elements.push(c);k.resolve()});d.push(k)});$.when.apply($,d).always(function(){c.resolve(f)});return c.promise()},getRequires:function(a,b){var f={elements:[]},c=x(),d=[],g={encoding:"UTF-8",sync:!0};b.forEach(function(b){var c={},m=h(a,b.url,g),k=x();m.done(function(a){c.textContent=a.resource.content||""}).fail(function(a){a.resource&&a.resource.forbidden?(c.textContent='// this @require ("'+encodeURIComponent(b.unsafe_url)+
'") is not allowed!\n',console.warn("externals: can't load @require from forbidden URL",b.unsafe_url)):a.resource&&a.resource.blacklisted?(c.textContent='// this @require ("'+encodeURIComponent(b.unsafe_url)+'") is blacklisted!\n',console.warn("externals: can't load @require from blacklisted URL",b.unsafe_url)):(c.textContent='// this @require ("'+encodeURIComponent(b.unsafe_url)+'") could not be loaded!\n',console.warn("externals: can't load @require from URL",b.unsafe_url))}).always(function(a){g.sync&=
a.sync;f.elements.push(c);k.resolve()});d.push(k)});$.when.apply($,d).always(function(){c.resolve(f)});return c.promise()}};return f}();exts=T;var Ga=function(){var a=function(a,c,d){var h=x(),f=[];d.forEach(function(e){e=e.textContent||"";e=ma.mkCompat(e,a.options.compatopts_for_requires?a:null,!1);f.push(e)});d="\n"+f.join("\n")+"\n";var e=B.getStorageByUid(a.uuid);c=ma.mkCompat(c,a,!1);k.values.debug&&(c="debugger;\n"+c);c={method:"executeScript",header:a.header,code:c,requires:d,version:chrome.extension.getVersion(),
storage:e,script:a};h.resolve(c);return h.promise()};return{inject:function(b,c,d){var h={},f;for(f in c)"includes"!=f&&"matches"!=f&&"requires"!=f&&"resources"!=f&&"excludes"!=f&&"textContent"!=f&&("options"==f?(h[f]=JSON.parse(JSON.stringify(c[f])),h[f].run_at=h[f].run_at||c.options.override.orig_run_at||"document-end"):h[f]=c[f]);return T.getResources(h.uuid,c.resources).then(function(a){d&&!a.sync&&(D&&console.warn("ri: uncached @external detected -> fast script start disabled"),d=a.sync);h.resources=
a.elements;return T.getRequires(h.uuid,c.requires)}).then(function(e){d&&!e.sync&&(D&&console.warn("ri: uncached @external detected -> fast script start disabled"),d=e.sync);e=e.elements;console.log("run script "+h.name+" @ "+b.url);return a(h,c.textContent,e)}).then(function(a){var f=x();a.id=b.contextId;chrome.tabs.sendMessage(b.tabId,a,f.resolve);return f.promise()})}}}(),ya=function(a){a&&(a+=(-1==a.search("\\?")?"?":"&")+"ts="+(new Date).getTime());return a},za=function(){var a=chrome.extension.getViews({type:"popup"});
a&&a.length&&chrome.extension.sendMessage({method:"updateActions"},function(a){})},S=function(){return{getConfig:function(){var a={db_version:0,last:0,entries:0},b={version:0,last:0},c={scripts:0,fire:a},d=p.getValue(n.CONSTANTS.STORAGE.UPDATE,c);"object"!==typeof d&&(d=c);d||(d=c);void 0==d.fire&&(d.fire=a);void 0==d.black&&(d.black=b);void 0==d.scripts&&(d.scripts=0);return d},setConfig:function(a){a&&p.setValue(n.CONSTANTS.STORAGE.UPDATE,a)}}}(),ba={check:function(a,b,c,d){if(a||0!=k.values.scriptUpdateCheckPeriod){var h=
function(a){if(b){a=g.getMessage("Script_Update");var e=g.getMessage("Check_for_userscripts_updates")+"...";U.show(a,e,chrome.extension.getURL("images/icon128.png"),1E4)}console.log("update: check for script updates "+(c?" for "+c:""));ba.updateUserscripts(0,b,c,function(a,b){if(a)try{var e=c||b.uuid,f=function(a){a.clicked&&r.doSave({url:b.url,uuid:e,replace:!e,src:b.code,ask:!k.values.notification_silentScriptUpdate,hash:b.newhash})},h=g.getMessage("There_is_an_update_for_0name0_avaiable_",b.name)+
"\n"+g.getMessage("Click_here_to_install_it_"),q=g.getMessage("Just_another_service_provided_by_your_friendly_script_updater_")+":";k.values.notification_silentScriptUpdate?f({clicked:!0}):U.show(q,h,chrome.extension.getURL("images/icon128.png"),k.values.scriptUpdateHideNotificationAfter,f)}catch(l){console.error("update: notification error "+l.message)}d&&d(a)})};(function(){var b=S.getConfig();if(a||(new Date).getTime()-b.scripts>k.values.scriptUpdateCheckPeriod){var e=function(){h();b=S.getConfig();
b.scripts=(new Date).getTime();S.setConfig(b)};l.enabled?(l.addSyncDoneListener(e),l.scheduleSync(50,!1)):e()}else d&&(console.warn("update: check -> no force but callback"),window.setTimeout(d,1))})();window.setTimeout(ba.check,3E5)}},srcCmp:function(a,b){var c=Y.createScriptFromSrc(b);if(!c.name||""==c.name||void 0===c.version)return-2;var d=B.getMetaByUid(a);return d&&d.system?null:c.options.compat_uW_gmonkey?-2:-1!=c.name.search("@")?-2:d&&c.version==d.version?0:d&&-1==Q(c.version,d.version)?
-1:1},updateUserscripts:function(a,b,c,d){var h=1,f=0,e=function(){0==--h&&0==f&&(b&&(D&&console.debug("No update found"),U.show("Narf!",g.getMessage("No_update_found__sry_"),chrome.extension.getURL("images/icon128.png"),1E4)),d&&window.setTimeout(d,1))},m=function(a){var b={method:"GET",retries:n.XMLHTTPREQUEST.RETRIES,url:r.determineSourceURL(a.script,!0)};h++;(function(){var c=r.determineSourceURL(a.script);ia(b,{ondone:function(b){if(4==b.readyState&&200==b.status){var h=ba.srcCmp(a.script.uuid,
b.responseText);if(1==h||a.hash_different){f++;d&&d(!0,{name:a.script.name,url:c,uuid:a.script.uuid,code:b.responseText,newhash:a.meta?a.meta["uso:hash"]:null});return}0==h&&a.meta&&(a.script.hash=a.meta["uso:hash"],r.doModify(a.script.uuid,a.script,!1))}else console.log(g.getMessage("UpdateCheck_of_0name0_Url_0url0_failed_",[a.script.name,c]));e()}})})()},s=function(a,b){var e=r.determineMetaURL(a,!0);e?ia({method:"GET",retries:0,url:e,headers:{Accept:"text/x-userscript-meta"}},{ondone:function(f){a.meta=
null;if(4==f.readyState&&200==f.status){var c=Y.processMetaHeader(f.responseText);a.meta=c;a.metasrc=f.responseText}else console.log("update: unable to find meta data @ "+e+" req.status = "+f.status);b(a)}}):(a.meta=null,b(a))},t=function(a){h++;s(a.script,function(b){var f=!!b.meta,c=f&&!!b.meta.version,d=c&&(!a.script.version||1==Q(b.meta.version,a.script.version)),h=f&&(a.script.hash||!c)&&!!b.meta["uso:hash"]&&b.meta["uso:hash"]!=a.script.hash;if(!f||h||!c||d)a.meta=b.meta,a.metasrc=b.metasrc,
a.hash_different=h,m(a);e()})},z=!1;B.getUidList().forEach(function(a){var b=B.getByUid(a);b.script&&b.cond?(a=!k.values.scriptUpdateCheckDisabled&&!b.script.enabled&&!c,c&&b.script.uuid!==c||a||!r.determineSourceURL(b.script)||(z=!0,t(b))):console.warn("update: inconsistent script entry",a,b)});!z&&c&&d&&window.setTimeout(d,1);e()}};trup=ba;var r=function(){var a=function(a){a.sort(function(a,b){return a.position-b.position});return a},b=function(a){void 0===a.ask&&(a.ask=!0);if(void 0===a.url||
null==a.url)a.url="";void 0===a.hash&&(a.hash="");""===a.force_url&&(a.force_url=null);var b=Y.createScriptFromSrc(a.src),c,d={heading:null,errors:[],info:[],warnings:[],flags:{}},t=x(),z=(new Date).getTime(),l=a.save&&!a.ask&&k.values.editor_easySave,q=a.uuid,n;b.name&&void 0!=b.version?n=K():(d.errors.push(g.getMessage("Invalid_UserScript__Sry_")+"\n\n"),a.name&&d.errors.push(g.getMessage("Script_name_0url0",a.name)+"\n\n"),a.url&&d.errors.push(g.getMessage("Downloaded_from_0url0",a.url)),console.warn("scriptman: invalid userscript",
d,b),n=N());n.then(function(){a.replace&&!q&&(q=B.getUidsByName(b.name,b.namespace)[0]);c=q?B.getMetaByUid(q):null;if(!q)if(a.replace)q=u.createUUID();else return console.error("scriptman: neither UUID nor replace option set"),N();return""!==q.replace(/[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89aAbB][a-f0-9]{3}-[a-f0-9]{12}/,"")?(console.error("scriptman: invalid UUID",q),N()):!a.clean&&!a.defaultscript&&c&&c.system?N():K()}).then(function(){return a.clean&&a.name&&a.name!=b.name||-1!=b.name.search("\n")?
(d.errors.push(g.getMessage("Invalid_UserScript_name__Sry_")),N()):K()}).then(function(){return b.options.compat_uW_gmonkey?(d.errors.push(g.getMessage("This_script_uses_uW_gm_api_")),N()):K()}).then(function(){if(c){c.name!=b.name&&(d.flags.renamed=!0);if(c.lastModified&&void 0!==a.lastModified&&c.lastModified!==a.lastModified){var h=g.getMessage("some_secs");try{var k=Math.max(1,Math.floor((z-c.lastModified)/1E3));isNaN(k)||(h=k)}catch(t){}d.warnings.push(g.getMessage("CONFLICT__This_script_was_modified_0t0_seconds_ago_",
h));d.flags.forceAsk=!0}d.flags.hashChanged=a.hash&&c.hash!=a.hash;b.version!=c.version||d.flags.hashChanged||(a.save?d.flags.modification=!0:d.flags.reset=!0);a.clean&&(d.flags.factory=!0)}else d.flags.first_install=!0;b.includes.length||b.matches.length||(h="/"+F.staticVars.urlAllHttp_+"/",l||a.internal||d.warnings.push(g.getMessage("This_script_does_not_provide_any__include_information_")+"\n"+g.getMessage("Tampermonkey_assumes_0urlAllHttp0_in_order_to_continue_",h)),b.includes.push(h));d.flags.internal=
a.internal;d.flags.ask=a.ask;return K()}).then(function(){b.uuid=q;b.hash=a.hash;b.lastUpdated=z;b.system=a.defaultscript;b.evilness=r.getEvilness(b);b.position=r.determineLastPosition()+1;d.flags.factory||d.flags.reset||(a.force_url&&(b.updateURL=null,b.downloadURL=a.force_url),c&&(b.options.override=c.options.override,b.options.comment=c.options.comment));b.options.override.orig_includes=b.includes;b.options.override.orig_excludes=b.excludes;b.options.override.orig_matches=b.matches;b=r.mergeCludes(b);
b.options.override.orig_noframes=b.options.noframes;b.options.override.orig_run_at=b.options.run_at||"document-end";b.options.noframes=null;b.options.run_at=null;return K()}).then(function(){if(c&&(b.fileURL=c.fileURL,b.hash=c.hash,b.position=c.position,c.sync&&(b.sync=c.sync),!d.flags.factory&&!d.flags.reset)){b.enabled=c.enabled;b.options.noframes=c.options.noframes;b.options.run_at=c.options.run_at;b.options.awareOfChrome||(b.options.compat_forvarin=c.options.compat_forvarin);a.save&&!a.force_url&&
(b.downloadURL=c.downloadURL||b.downloadURL);var k=h.determineMetaURL(c),t=h.determineMetaURL(b);k==t||l||a.internal||d.warnings.push(g.getMessage("The_update_url_has_changed_from_0oldurl0_to__0newurl0",[k,t]))}return K()}).then(function(){return!c||d.flags.factory||b.version!=c.version||d.flags.hashChanged||!a.defaultscript&&!a.noreinstall?K():N()}).then(function(){c?(d.flags.factory||d.flags.reset?(d.flags.reset?(d.heading=g.getMessage("You_are_about_to_reinstall_a_UserScript_"),d.flags.reinstall=
!0):(d.heading=g.getMessage("You_are_about_to_install_a_UserScript_"),d.flags.install=!0),a.internal||d.warnings.splice(0,0,g.getMessage("All_script_settings_will_be_reset_"))):d.flags.modification?d.heading=g.getMessage("You_are_about_to_modify_a_UserScript_"):-1==Q(b.version,c.version)?(d.heading=g.getMessage("You_are_about_to_downgrade_a_UserScript"),d.flags.downgrade=!0,l||a.internal||d.warnings.splice(0,0,g.getMessage("The_downgraded_script_might_have_problems_to_read_its_stored_data_"))):(d.heading=
g.getMessage("You_are_about_to_update_a_UserScript_"),d.flags.update=!0),d.info.push({label:g.getMessage("Installed_Version_"),value:"v"+c.version})):(d.heading=g.getMessage("You_are_about_to_install_a_UserScript_"),l||a.internal||d.warnings.splice(0,0,g.getMessage("Malicious_scripts_can_violate_your_privacy_")),d.flags.install=!0);d.flags.install?d.action=g.getMessage("Install"):d.flags.reinstall?d.action=g.getMessage("Reinstall"):d.flags.modification?d.action=g.getMessage("Modify"):d.flags.downgrade?
d.action=g.getMessage("Downgrade"):d.flags.update&&(d.action=g.getMessage("Update"));return K()}).then(function(){a.url&&(b.fileURL=a.url);a.sync&&(b.sync=a.sync);a.force_options&&u.copy(a.force_options,b.options,(new Y.Script).options,!0);a.force_settings&&u.copy(a.force_settings,b,["enabled","position"]);return K()}).then(function(){var a=!1,c;for(c in b.options)if(-1!=c.search("compat_")&&!0===b.options[c]){a=!0;break}a&&d.info.push({label:g.getMessage("Note"),value:g.getMessage("A_recheck_of_the_GreaseMonkey_FF_compatibility_options_may_be_required_in_order_to_run_this_script_")});
return K()}).then(function(){["requires","resources"].forEach(function(a){b[a]=u.map(b[a],function(a){a.unsafe_url=a.url;a.url=F.sanitize(a.unsafe_url,b.fileURL);return a})});return K()}).done(function(){t.resolve({script:b,messages:d,short_info:[{label:g.getMessage("Author"),prop:"author"},{label:g.getMessage("Description"),prop:"description"},{label:g.getMessage("Source"),prop:"fileURL"}]})}).fail(function(){t.reject({messages:d})});return t.promise()},c=function(a){var b=x(),c=a.messages,d=a.script,
g=function(){var a=h.doModify(d.uuid,d)||{};(c.flags.first_install||c.flags.factory)&&B.setStorageByUid(d.uuid,{ts:(new Date).getTime()});return a},k={},l={lastModified:k.lastModified,installed:!0,renamed:c.flags.renamed};c.warnings.length||c.flags.ask?da.install(a).done(function(a){a.ok&&(k=g());l.installed=a.ok;l.aborted=a.aborted;b.resolve(l)}).fail(function(a){b.reject(a)}):(k=g(),b.resolve(l));return b.promise()},d=u.getDebouncer(1E3),h={determineSourceURL:function(a,b){if(!a)return null;var c=
u.select([a.downloadURL,a.fileURL],function(a){if(!a||"file:"!==F.parse(a).protocol)return a})[0];return c&&b?ya(c):c},determineMetaURL:function(a,b){if(!a)return null;var c;a.fileURL&&(c=a.fileURL.replace(".user.js",".meta.js"),a.fileURL==c&&(c=a.fileURL.replace(".tamper.js",".meta.js")),a.fileURL==c&&(c=null));return(c=u.select([a.updateURL,a.downloadURL,c],function(a){if(!a||"file:"!==F.parse(a).protocol)return a})[0])&&b?ya(c):c},mergeCludes:function(a){var b,c,d=a.options.override;a.includes=
d.merge_includes&&d.orig_includes?d.orig_includes.slice():[];a.excludes=d.merge_excludes&&d.orig_excludes?d.orig_excludes.slice():[];a.matches=d.merge_matches&&d.orig_matches?d.orig_matches.slice():[];for(b=0;b<d.use_includes.length;b++)c=a.excludes.indexOf(d.use_includes[b]),0<=c&&a.excludes.splice(c,1),a.includes.push(d.use_includes[b]);if("undefined"!==typeof d.use_matches)for(b=0;b<d.use_matches.length;b++)c=a.excludes.indexOf(d.use_matches[b]),0<=c&&a.excludes.splice(c,1),a.matches.push(d.use_matches[b]);
for(b=0;b<d.use_excludes.length;b++)a.excludes.push(d.use_excludes[b]);return a},doSave:function(a){return b(a).then(c)},doRemove:function(a,b){B.removeByUid(a,b);B.setStorageByUid(a,null);T.dropAll(a);return K()},doModify:function(a,b,c){void 0===c&&(c=!0);B.setByUid(a,b,c);return c?T.loadResources(a,b.resources).then(function(){return T.loadRequires(a,b.requires)}).then(function(){return T.dropAllBut(a,u.map([].concat(b.resources).concat(b.requires),function(a){return a.url}))}):K()},exportToJson:function(a,
b){var c=x(),d=r.determineScriptsToRun(null);a&&(d=u.select(d,function(b,e){return a[b.uuid]}));d=qa(d,!0);b&&!b.storage||d.forEach(function(a){a.storage=B.getStorageByUid(a.uuid)});c.resolve({scripts:d});return c.promise()},importFromJson:function(a){if(!a||!a.scripts||!a.scripts.length)return N();for(var e=x(),d={},h=[],g={},k=0,l;l=a.scripts[k];k++)try{var q=x();"new-user-script"!=l.uuid&&(l.storage&&(g[l.uuid]=l.storage),b({uuid:l.uuid,name:l.name,src:l.source,force_settings:{enabled:l.enabled,
position:l.position},force_options:l.options,replace:!0,url:l.file_url||l.update_url,ask:!1}).done(function(a){d[u.createUUID()]=a;q.resolve()}).fail(function(a){console.warn("import: Error @ script",l.name,a);q.resolve()}),h.push(q.promise()))}catch(n){console.log("import: Error while importing script",l.name,n)}$.when.apply($,h).always(function(){da["import"](d).done(function(a){var b=[];if(a.ok)for(var f=0,h;h=a.import_ids[f];f++)(function(){var a=h;if(d[a]){d[a].messages.warnings=[];var e=c(d[a]).done(function(){var b;
(b=d[a].script.uuid)&&g[b]&&B.setStorageByUid(b,{data:g[b].data||{},ts:(new Date).getTime()})});b.push(e)}})();$.when.apply($,b).always(function(){r.reorderScripts();e.resolve()})}).fail(function(a){e.reject(a)})});return e.promise()},installFromUrl:function(a,b,c){var k=x(),l=F.parse(a);b=b||{};c=c||{};var z=[a,JSON.stringify(b)].join("_");if(d.is(z))return D&&console.log("scriptman: de-bounced installFromUrl",a),N();d.add(z);if(!l.protocol.match(/(https?|file):/))return console.warn("scriptman: can't install from ",
a),N();"file:"!=l.protocol||n.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS||console.warn("scriptman: Access to local files is forbidden! Loading the following script for installation may fail:",a,"-> more info:","http://tampermonkey.net/faq.php#Q204");var p=function(b,e){if(!b)if(e)b={messages:{errors:[g.getMessage("Unable_to_load_script_from_url_0url0",a)],warnings:[]}},"file:"!=l.protocol||n.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS||b.messages.warnings.unshift(g.getMessage("Tampermonkey_has_no_file_access_permission_"));
else{k.reject();return}b.heading=g.getMessage("You_are_about_to_install_a_UserScript_");c.silent_fail?k.reject(b):da.installError(b).always(function(a){k.reject(a)})};W({method:"GET",retries:n.XMLHTTPREQUEST.RETRIES,url:a},{onload:function(c){if(4==c.readyState)if(200==c.status||0==c.status){c={url:a,src:c.responseText,ask:!0,replace:!0};if(b)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);h.doSave(c).done(function(a){k.resolve(a.installed)}).fail(p)}else k.reject()},onerror:function(a){p(null,a)}});
return k.promise()},determineLastPosition:function(){var a=0;B.getUidList().forEach(function(b){var e=B.getByUid(b);e.script&&e.cond?e.script.position&&e.script.position>a&&(a=e.script.position):console.warn("scriptman: inconsistent script entry",b)});var b=new Y.Script;b.position>a&&(a=b.position);return a},matchUrl:function(a,b,c){var d,h;try{!c&&1<b.length&&"/"==b.substr(0,1)?d=RegExp(".*"+b.replace(/^\//g,"").replace(/\/$/g,"")+".*","i"):c?(h=F.getRegExpFromMatch(b),d=RegExp(h)):(h=F.getRegExpFromInclude(b,
{tryToFixUrl:k.values.tryToFixUrl,safeUrls:k.values.safeUrls}),d=RegExp(h,"i"))}catch(g){return console.warn("scriptman: invalid regexp ",b),!1}return""===a.replace(d,"")},validUrl:function(a,b,c){var d,g=!1;if(b.inc||b.match){for(d in b.inc)if("string"!==typeof b.inc[d])console.warn("scriptman: include["+d+"] '"+b.inc[d]+"' "+(c?"@"+c+" ":"")+"can't be compared to '"+a+"'");else if(h.matchUrl(a,b.inc[d])){D&&console.log("scriptman: @include '"+b.inc[d]+"' matched"+(c?" ("+c+")":""));g=!0;break}if(b.match)for(d in b.match)if("string"!==
typeof b.match[d])console.warn("scriptman: match["+d+"] '"+b.match[d]+"' "+(c?"@"+c+" ":"")+"can't be compared to '"+a+"'");else if(h.matchUrl(a,b.match[d],!0)){D&&console.log("scriptman: @match '"+b.match[d]+"' matched"+(c?" ("+c+")":""));g=!0;break}if(!g)return g}else g=!0;for(d in b.exc)if(h.matchUrl(a,b.exc[d])){D&&console.log("scriptman: @exclude '"+b.exc[d]+"' matched"+(c?" ("+c+")":""));g=!1;break}return g},getEvilness:function(a){var b=0;return a.fileURL&&(b=fa.getEvilnessOf(a.fileURL))||
a.downloadURL&&(b=fa.getEvilnessOf(a.downloadURL))||a.updateURL&&(b=fa.getEvilnessOf(a.updateURL))?(D&&console.log("scriptman: found blacklisted script",a),b):0},blackCheckAll:function(){B.getUidList().forEach(function(a){var b=B.getByUid(a);if(b.script&&b.cond){var c=r.getEvilness(b.script);if(c!==b.script.evilness){if(c||void 0!==b.script.evilness)D&&console.log("scriptman: write blacklist state of ",b.script.name,c),c&&k.values.statistics_enabled&&Z.tS(b.script.name,c,"b");b.script.evilness=c;
h.doModify(a,b.script,!1)}}})},reorderScripts:function(b,c){var d=h.determineScriptsToRun();if(b)for(var g=0;g<d.length;g++){var k=d[g];k.uuid==b&&(k.position=Number(c)+(k.position<c?0.5:-0.5))}for(var d=a(d),l=1,g=0;g<d.length;g++)k=d[g],k.position=l++,h.doModify(k.uuid,k,!1)},determineScriptsToRun:function(b){var c=[];D&&console.log("scriptman: determineScriptsToRun @"+b);B.getUidList().forEach(function(a){if(b){var d=p.getValue(n.CONSTANTS.PREFIX.COND+a,null);if(!d||!h.validUrl(b,d,a))return}d=
B.getByUid(a);d.script&&d.cond?c.push(d.script):console.warn("scriptman: inconsistent script entry",a,d)});return a(c)},determineOrigin:function(a){if(a=a.fileURL||a.downloadURL||a.updateURL){var b=a.match(/https?:\/\/userscripts\.org\/scripts\/(source|version)\/([0-9]{1,9})\.user\.js/);if(b&&3==b.length)return{id:b[2],token:"uso",url:"http://userscripts.org/scripts/show/"+b[2],issue_url:"http://userscripts.org/scripts/issues/"+b[2]};if((b=a.match(/https?:\/\/greasyfork\.org\/scripts\/([^/]+)\/code\/.*\.user\.js/))&&
2==b.length)return{id:b[1],token:"gf",url:"https://greasyfork.org/scripts/"+b[1],issue_url:"https://greasyfork.org/scripts/"+b[1]+"/feedback"};if((b=a.match(/https?:\/\/openuserjs\.org\/install\/([^/]+)\/([^/]+)\/(.*)\.user\.js/))&&4==b.length)return b.shift(),{id:b.join("/"),token:"ouj",url:"https://openuserjs.org/scripts/"+b[0]+"/"+b[1]+"/"+b[2]};if((a=a.match(/https?:\/\/monkeyguts\.com\/(codepages\/)?([0-9]{1,9})\.user\.js/))&&3==a.length)return{id:a[2],token:"mog",url:"https://monkeyguts.com/code.php?id="+
a[2],issue_url:"https://monkeyguts.com/code.php?nav=rev&id="+a[2]}}}};return h}(),B=function(){var a={getUidList:function(){var a=RegExp("^"+n.CONSTANTS.PREFIX.SCRIPT_UID),c=[];p.listValues().forEach(function(d){-1!=d.search(a)&&c.push(d.replace(a,""))});return c},getUidsByName:function(b,c){var d=[];a.getUidList().forEach(function(h){var f=a.getMetaByUid(h);!f||f.name!=b||c&&c!=f.namespace||d.push(h)});return d},getUidByName:function(b){console.warn("sb: deprecated fn");return a.getUidsByName(b)[0]},
getStorageByUid:function(a){a=p.getValue(n.CONSTANTS.PREFIX.STORE+a,{ts:0,data:{}});"undefined"===typeof a.ts&&(a.ts=0);"undefined"===typeof a.data&&(a.data={});return a},setStorageByUid:function(a,c){c?p.setValue(n.CONSTANTS.PREFIX.STORE+a,c):p.deleteValue(n.CONSTANTS.PREFIX.STORE+a)},getMetaByUid:function(a){return p.getValue(n.CONSTANTS.PREFIX.META+a,null)},getByUid:function(a){if(!a)return console.error("sb: no UUID set"),{};var c,d=p.getValue(n.CONSTANTS.PREFIX.META+a,null);if(d){var h=function(a){if(a)for(var b=
0,c=null;c=a[b];b++)delete c.loaded,delete c.textContent,delete c.resURL,delete c.resText};h(d.requires);h(d.resources);d.uuid=a;d.textContent=p.getValue(n.CONSTANTS.PREFIX.SCRIPT+a,d.textContent);d.textContent&&(c=d)}return{script:c,cond:p.getValue(n.CONSTANTS.PREFIX.COND+a,null)}},setByUid:function(a,c,d){var h={};if(!a)return console.error("sb: no UUID set",c),h;var f=p.getValue(n.CONSTANTS.PREFIX.META+a),e=!f;p.setValue(n.CONSTANTS.PREFIX.SCRIPT_UID+a,c.name);p.setValue(n.CONSTANTS.PREFIX.COND+
a,{inc:c.includes,match:c.matches,exc:c.excludes});p.setValue(n.CONSTANTS.PREFIX.SCRIPT+a,c.textContent);c.textContent=null;d&&(h.lastModified=(new Date).getTime(),c.lastModified=h.lastModified);p.setValue(n.CONSTANTS.PREFIX.META+a,c);d&&(e?l.scriptAddedCb(c.name,c):l.scriptChangedCb(c.name,c,f),k.values&&k.values.statistics_enabled&&(a=null,e&&c.fileURL&&(a=F.parse(c.fileURL),d=a.hostname&&5<a.hostname.length?a.hostname.substr(0,1)+"***"+a.hostname.substr(a.hostname.length-3,3):"*",a=a.protocol+
"//"+d+(a.port?":"+a.port:"")+a.pathname+(a.search?"?***":"")),Z.tS(c.name,a,e?"i":"u")));X.items.rundata.removeAll();return h},removeByUid:function(b,c){void 0===c&&(c=!0);var d=a.getByUid(b);p.deleteValue(n.CONSTANTS.PREFIX.SCRIPT_UID+b);p.deleteValue(n.CONSTANTS.PREFIX.COND+b);p.deleteValue(n.CONSTANTS.PREFIX.SCRIPT+b);p.deleteValue(n.CONSTANTS.PREFIX.META+b);p.deleteValue(n.CONSTANTS.PREFIX.STORE+b);c&&(d.script&&d.cond&&l.scriptRemovedCb(d.script.name,d.script),k.values&&k.values.statistics_enabled&&
Z.tS(d.script.name,null,"r"));X.items.rundata.removeAll();return{}}};return a}();scbr=B;var Aa=function(){var a=function(a,c){var d=null,h=a.sender,f=this,e=function(c){try{a.postMessage(c)}catch(d){console.error("bg: Error sending port ("+a.name+") message: "+JSON.stringify(c))}};if("xhr"==c.method){var h=function(a){e({error:!0,data:a})},k=function(a){e({success:!0,data:a})},l=function(a){e({progress:!0,data:a})},t=function(a){e({timeout:!0,data:a})};ia(c.details,{onload:k,onreadychange:function(a){e({change:!0,
data:a})},onprogress:l,onerror:h,ontimeout:t,ondone:function(){a.disconnect()}})}else if("download"==c.method)h=function(a){e({error:!0,data:a})},k=function(a){e({success:!0,data:a})},l=function(a){e({progress:!0,data:a})},t=function(a){e({timeout:!0,data:a})},M.start(c.details,{onload:k,onprogress:l,onerror:h,ontimeout:t,ondone:function(){a.disconnect()}});else if("addStorageListener"==c.method)"undefined"!=typeof h.tab?(p.addClientListener(h.tab.id,c.id,c.uuid,(new Date).getTime(),e),d=function(){p.removeClientListeners(c.uuid,
c.id,!1)}):(console.log(g.getMessage("Unable_to_load_storage_due_to_empty_tabID_")),e({error:!0}));else if("removeStorageListener"==c.method)"undefined"!=typeof h.tab?(p.removeClientListeners(c.uuid,c.id),e({error:!1})):(console.warn("Unable to remove storage listener due to empty tabID!"),e({error:!0}));else if("saveStorageKey"==c.method)"undefined"!=typeof h.tab?c.uuid&&(k=B.getStorageByUid(c.uuid),k.data[c.key]=c.value,k.ts=c.ts,B.setStorageByUid(c.uuid,k),p.notifyClientListeners(c.uuid,null,function(a){var b=
{data:{},ts:0},d=B.getStorageByUid(c.uuid);b.data[c.key]=d.data[c.key];b.ts=d.ts;b={storage:b};void 0===d.data[c.key]&&(b.removed=c.key);a(b)})):console.log(g.getMessage("Unable_to_save_storage_due_to_empty_tabID_")),e({});else if("openInTab"==c.method){k=["active"];l={url:c.details.url};if(c.details.options){for(d=0;d<k.length;d++)void 0!==c.details.options[k[d]]&&(l[k[d]]=c.details.options[k[d]]);c.details.options.insert&&(l.index=h.tab.index+1)}d=function(){f.disconnected=!0;f.tabId&&delete ea[f.tabId]};
chrome.tabs.create(l,function(a){f.tabId=a.id;ea[a.id]={onClose:function(){e({close:!0})}};e({success:!0,tabId:a.id})})}else"closeTab"==c.method&&(f.tabId&&ea[f.tabId]&&chrome.tabs.remove(f.tabId),e({}),window.setTimeout(function(){try{f.disconnected||a.disconnect()}catch(c){}f.disconnected=!0},1E3));d&&a.onDisconnect.addListener(d)};return function(b){if(G.late){var c={};b.onMessage.addListener(function(d){a.apply(c,[b,d])})}else G.registerLateCallback(function(){Aa(b)})}}(),na={ping:{allow:{insecure:!0},
exec:function(a,b,c){c({pong:!0,instanceID:ta,config:{layout:k.values.layout}})}},newTab:{allow:{extpage:!0},exec:function(a,b,c){chrome.tabs.create({url:a.url},function(a){c({tabId:a.id})})}},getTab:{allow:{script:!0},exec:function(a,b,c){b.tab&&a.uid?(P[b.tab.id]||(P[b.tab.id]={}),P[b.tab.id][a.uid]||(P[b.tab.id][a.uid]={}),c({data:P[b.tab.id][a.uid]})):(console.log("bg: unable to process request",b,a),c({data:null}))}},getTabs:{allow:{script:!0},exec:function(a,b,c){if(a.uid){b={};for(var d in P)b[d]=
{},b[d]=P[d][a.uid];c({data:b})}else console.log("bg: unable to process request",b,a),c({data:null})}},setTab:{allow:{script:!0},exec:function(a,b,c){if(b.tab&&a.uid){P[b.tab.id]||(P[b.tab.id]={});var d={},h;for(h in a.tab)d[h]=a.tab[h];P[b.tab.id][a.uid]=d}else console.log("bg: unable to process request",b,a);c({})}},copyToClipboard:{allow:{script:!0,extpage:!0},exec:function(a,b,c){"undefined"!=typeof b.tab?ra.copy(a.data):console.log("bg: unable to process request",b,a);c({})}},setOption:{allow:{extpage:!0},
exec:function(a,b,c){b="options"==b.extpage||"options"==a.origin;k.values[a.name]=a.value;b?ga(function(a){c({items:a,options:k.values})}):c({})}},reportAnIssue:{allow:{extpage:!0},exec:function(a,b,c){var d,h,f;a.uuid&&(d=B.getByUid(a.uuid))&&d.script&&d.cond&&(b=r.determineOrigin(d.script),"author"==a.to&&d.script.supportURL?(h={url:d.script.supportURL},f=b?[a.to,b.token,b.id].join(":"):[a.to,h.url].join(":")):b&&(h=b,f=[h.token,h.id].join(":")),h&&(k.values.statistics_enabled&&Z.tS(d.script.name,
f,"m"),chrome.tabs.create({url:h.issue_url||h.url,active:!0},function(){})));c({})}},buttonPress:{allow:{extpage:!0},exec:function(a,b,c){var d=function(){c({})};"reset_simple"==a.name?ha.reset(d):"reset_factory"==a.name?ha.factoryReset(d):"create_tesla_data"==a.name?l.createTeslaData(function(a){ra.copy({content:R.UTF8.encode(a.join("<br>")),type:"html"});d()}):"reset_chrome_sync"==a.name?l.reset(d):"install_tests"==a.name?(b=ja.framework.prepare(r.doSave,d))&&console.error(b):"enabled"==a.name?
(k.values[a.name]=!k.values[a.name],c({})):"externals_delete"==a.name?(T.cleanElement(a.scriptuid,a.url),ga(function(a){c({items:a,options:k.values})})):"run_script_updates"==a.name?a.scriptuid?(d=function(b){c({scriptuid:a.scriptuid,updatable:b})},ba.check(!0,!1,a.scriptuid,d)):(ba.check(!0,!0),c({})):(console.log("bg: Warning: unknown button "+a.name),c({}))}},modifyScriptOptions:{allow:{extpage:!0},exec:function(a,b,c){var d="options"==b.extpage||"options"==a.origin,h=void 0==a.reload||!0==a.reload,
f=function(){h?(a.uuid&&void 0!==a.position&&r.reorderScripts(a.uuid,a.position),d?ga(function(a){c({items:a,i18n:k.values.i18n,options:k.values})}):chrome.tabs.getSelected(null,function(b){var d=Ja(b);c({items:d,i18n:k.values.i18n,options:{enabled:k.values.enabled,layout:k.values.layout}});a.uuid&&k.values.autoReload&&chrome.tabs.sendMessage(b.id,{method:"reload",frameId:0},function(a){})})):c({})};if(a.uuid&&"modifyScriptOptions"==a.method){var e=B.getByUid(a.uuid);if(e.script&&e.cond){var m=!1,
l=new Y.Script,t;for(t in l.options)l.options.hasOwnProperty(t)&&"undefined"!==typeof a[t]&&(e.script.options[t]=a[t]);for(t in l.options.override)l.options.override.hasOwnProperty(t)&&-1!=t.search("merge_")&&"undefined"!==typeof a[t]&&(e.script.options.override[t]=a[t],m=!0);"undefined"!==typeof a.enabled&&(e.script.enabled=a.enabled);"undefined"!==typeof a.includes&&(e.script.options.override.use_includes=a.includes,e.script.options.override.use_excludes=a.excludes,e.script.options.override.use_matches=
a.matches,m=!0);m&&(e.script=r.mergeCludes(e.script));r.doModify(e.script.uuid,e.script)}}else if(a.nid&&"modifyNativeScript"==a.method)return O.getUserscriptById(a.nid).done(function(d){if(d){if("installed"==a.actionid)"false"==a.value&&O.uninstall(d).always(f);else if("enabled"==a.actionid)O.setEnabled(d,a.value).always(f);else if("imported"==a.actionid&&"true"==a.value){var e=O.getUserscriptSource(d);e?r.doSave({src:e,ask:!0,replace:!0}).done(function(a){if(a.installed){if("disable"==k.values.native_import_post_action){O.setEnabled(d,
!1).always(f);return}if("uninstall"==k.values.native_import_post_action){O.uninstall(d).always(f);return}}f()}).fail(f):chrome.tabs.sendMessage(b.tab.id,{method:"showMsg",msg:g.getMessage("Please_double_check_the_native_script_import_settings__")},function(a){})}f()}else c({})}).fail(f),!0;f()}},modifyNativeScript:{allow:{extpage:!0},exec:function(a,b,c){return na.modifyScriptOptions.exec(a,b,c)}},saveScript:{allow:{extpage:!0},exec:function(a,b,c){var d=void 0===a.reload||!!a.reload,h=function(a){d?
ga(function(b){a.items=b;a.options=k.values;c(a)}):c({})};if(a.clean){D&&console.debug("bg: clean userscript "+a.uuid);b=B.getByUid(a.uuid);var f=function(b){ga(function(d){c({cleaned:b.installed,items:d,options:k.values});b.installed&&p.notifyClientListeners(a.uuid,null,function(b){b({storage:B.getStorageByUid(a.uuid)})})})};b.script&&b.cond?r.doSave({name:a.name,uuid:a.uuid,src:b.script.textContent,clean:!0,ask:!0,save:!0}).always(function(a){f(a||{installed:!1})}):(console.error(g.getMessage("fatal_error")+
" ("+a.uuid+")!!!"),f({installed:!1}))}else a.code?(f=c,d&&(f=function(a){r.reorderScripts();h(a)}),a.new_script&&(a.uuid=u.createUUID()),r.doSave({name:a.name,uuid:a.uuid,force_url:a.force_url,src:a.code,ask:!k.values.editor_easySave,lastModified:a.lastModified,save:!0}).always(function(a){f(a||{installed:!1})})):(r.doRemove(a.uuid),r.reorderScripts(),h({}))}},exportToJson:{allow:{extpage:!0},exec:function(a,b,c){r.exportToJson(a.ids,a.options).done(function(a){c({json:a})}).fail(function(a){c({})})}},
importFromJson:{allow:{extpage:!0},exec:function(a,b,c){var d=void 0===a.reload||!!a.reload,h=null;r.importFromJson(a.json).fail(function(a){h=a||g.getMessage("An_error_occured_during_import_")}).always(function(){var a={};h?(a.err=h,c(a)):d?ga(function(b){a.items=b;a.options=k.values;c(a)}):c(a)})}},askCom:{allow:{extpage:!0},exec:function(a,b,c){da.onMessage(a.data).always(function(a){c(a)})}},installScript:{allow:{insecure:!0},exec:function(a,b,c){if("undefined"!=typeof b.tab){var d={};r.installFromUrl(a.url).done(function(a){d=
{data:null,found:!0,installed:a}}).always(function(){c(d)})}else console.log(g.getMessage("Unable_to_install_script_due_to_empty_tabID_"))}},registerMenuCmd:{allow:{script:!0},exec:function(a,b,c){"undefined"!=typeof b.tab?(H.add({tabId:b.tab.id,url:b.tab.url,name:a.name,accessKey:a.accessKey,id:a.menuId,response:c}),za()):(console.log("Unable to register menu cmd due to empty tabID!"),c({run:!1}))}},unRegisterMenuCmd:{allow:{script:!0},exec:function(a,b,c){H.clearById(a.id);c({});za()}},execMenuCmd:{allow:{extpage:!0},
exec:function(a,b,c){(a=H.getById(a.id))?a.response({run:!0,menuId:a.id}):console.error("bg: Error: unable to find MC id "+a.id);c({})}},getWebRequestInfo:{allow:{script:!0},exec:function(a,b,c){"undefined"!=typeof b.tab?c({webRequest:y}):(console.log("Unable to run scripts due to empty tab id"),c({}))}},unLoad:{allow:{script:!0},exec:function(a,b,c){a.topframe||a.id&&v.events.unload(b.tab.id,b.tab.frameId,a.id)}},prepare:{allow:{script:!0},exec:function(a,b,c){if("undefined"!=typeof b.tab&&0<=b.tab.index){var d=
a.topframe?0:null,h=a.url+a.params,f=v.events.prepare(b.tab.id,d,a.id,h);if(la.isAllowed(h)){if(f){f={enabledScriptsCount:f,raw:{},webRequest:y,logLevel:k.values.logLevel,unsafeWindow:k.values.runtime_unsafeWindow};if(a.raw)for(var e=0;e<a.raw.length;e++)f.raw[a.raw[e]]=Registry.getRaw(a.raw[e]);c(f)}else c({logLevel:k.values.logLevel});v.events.run(b.tab.id,d,a.id,h,function(){ca.setIcon(b.tab.id);ca.setBadge(b.tab.id)});I.tab.resetFireCnt(b.tab.id)}else D&&console.log("This URL is filtered by the security settings:",
h,"-> Do nothing!"),a.id&&v.set.forbidden(b.tab.id,d,a.id),c({})}else c({});return!1}},scriptBlockerDetected:{allow:{script:!0},exec:function(a,b,c){a.xml_style_detected||-1!=a.url.search("\\.xml$")?console.warn("blocker: unable to get unsafeWindow..."):L.requestPermissionEx(function(a,b){var f=a&&b?g.getMessage("Please_reload_this_page_in_order_to_run_your_userscripts_"):null;c({alert:f})});v.set.blocker(b.tab.id);ca.setIcon(b.tab.id)}},startFireUpdate:{allow:{extpage:!0},exec:function(a,b,c){I.checkUpdate(!0,
a.force,function(a){c({suc:a})})}},getFireItems:{allow:{extpage:!0},exec:function(a,b,c){var d=function(b,d,h){void 0==d&&(d=null);var g=function(a){try{c({image:a,cnt:b,scripts:d,progress:h,options:{fire_sort_cache_enabled:k.values.fire_sort_cache_enabled}}),d=[]}catch(g){console.warn("bg: warn: action menu closed? "+JSON.stringify(g))}};a.countonly?g(null):Da.createIconEx(b).done(g)};if(!I.isReady())return d(0,[],{action:I.status.action,state:I.status.progress}),!0;var h=function(b){var c=Ka(a,
b);d(b.length,c)};a.tabid?a.countonly?I.tab.getCount(a.tabid,d):I.tab.getItems(a.tabid,h):a.url?"*"==a.url?I.getMax("scripts","sid",function(a){for(var b=[],c=0;1E3>c;c++)b.push(Math.floor(Math.random()*a+1).toString());I.ids.getItems(b,h)}):a.countonly?I.url.getCount(a.url,d):I.url.getItems(a.url,h):d([],[])}},notification:{allow:{script:!0,extpage:!0},exec:function(a,b,c){b=a.image&&""!=a.image?a.image:chrome.extension.getURL("images/icon128.png");U.show(a.title,a.msg,b,a.delay,function(a){c({clicked:a.clicked})})}},
handler:function(a,b,c){if(!G.late)return G.registerLateCallback(function(){na.handler(a,b,c)}),!0;var d=na[a.method];if(d)if(d.allow&&d.exec){var h=n.SELF.ID,h=!n.REQUESTS.HAS_SENDER_ID&&b.tab||b.id===h,f=null,e=n.REQUESTS.INTERNAL_PAGE_URL,g=n.REQUESTS.GET_INTERNAL_PAGE_REGEXP(),e=h&&(!b.tab||0==b.tab.url.search(e));h&&e&&(b.tab?(g=b.tab.url.match(g))&&2==g.length&&(f=g[1]):f="*",b.extpage=f);if("background"==f||d.allow.insecure||d.allow.extpage&&e||d.allow.options&&"options"==f||d.allow.script&&
h&&!e){if(d=d.exec(a,b,c),void 0!==d)return d}else return D&&console.warn("back: this context doesn't have the permission to call '"+a.method+"' "),!1}else return console.log("b: invalid implementation of "+a.method),!1;else return console.log("back: unknown method "+a.method),!1;return!0}},La=function(){var a=[],b=["test"],c=!1;return{getLayouts:function(){c||(a.push({name:g.getMessage("Default"),value:"default"}),b.forEach(function(b){Registry.getRaw("layout/"+b+"/options.js")&&a.push({name:b.charAt(0).toUpperCase()+
b.slice(1),value:b})}),c=!0);return a}}}(),H={commands:[],add:function(a){H.commands.push(a)},list:function(){var a=[],b;for(b in H.commands)H.commands.hasOwnProperty(b)&&a.push(H.commands[b]);return a},listByTabId:function(a){var b=[],c;for(c in H.commands)if(H.commands.hasOwnProperty(c)){var d=H.commands[c];if(d.tabId==a){for(var h=!1,f=0;f<b.length;f++)if(b[f].name==d.name){h=!0;break}h||b.push(d)}}return b},clearByTabId:function(a){H.getByTabId(a)},getByTabId:function(a){var b=[],c=H.commands;
H.commands=[];for(var d in c)if(c.hasOwnProperty(d)){var h=c[d];h.tabId!=a?H.commands.push(h):b.push(h)}return b},clearById:function(a){H.getById(a)},getById:function(a){var b=null,c=H.commands;H.commands=[];for(var d in c)if(c.hasOwnProperty(d)){var h=c[d];h.id!=a?H.commands.push(h):b=h}return b}},Ka=function(a,b){var c=[],d="http://...";a.tabid&&!v.get.empty(a.tabid)?u.each(v.get.urls(a.tabid),function(a,b){d=b;return!0}):a.url&&(d=a.url);var h=b.length?" ("+b.length+")":"",h={name:g.getMessage("Available_Userscripts")+
h,main_menu_item:!0,scriptTab:!0};h.items=qa(b,!1,!0);c.push(h);var h={name:g.getMessage("Settings"),main_menu_item:!0},f={name:g.getMessage("General"),sub_menu_item:!0},e="",k="",l,n=S.getConfig();0==n.fire.db_version?k="?":(l=1E3*n.fire.db_version,k=(new Date(l)).toString());e+=g.getMessage("Current_Index_")+":<br><br>";e+=g.getMessage("Date_")+": "+k+"<br>";e+=g.getMessage("Entries_")+": "+(n.fire.entries?n.fire.entries:"?")+"<br><br><br>";f.items=[{name:"TamperFire DB",fire:!0,fireInfo:!0,value:e,
versionDB:l},{name:g.getMessage("Check_for_Updates"),fname:g.getMessage("Force_Update"),fire:!0,fireUpdate:!0}];h.items=[f];c.push(h);c.push({name:"Search by URL",id:"searchByURL",search:!0,value:d,desc:""});return c},Ja=function(a){var b=a?a.url:null,c=b&&4<b.length&&""==b.substr(0,4).replace(/file|http/,"")?b:"",d=[],h={name:"enabled",sub_menu_item:!0,pos:"top",items:[]};h.items.push({name:g.getMessage("Enabled"),display:k.values.enabled?null:"greyed",id:"enabled",button:!0,reload:!0,enabler:!0});
d.push(h);if(k.values.fire_enabled){var h={name:"fire",sub_menu_item:!0,pos:"top",items:[]},f=null,f=k.values.fire_topOnly?chrome.extension.getURL("fire.html?url="+encodeURIComponent(b)):chrome.extension.getURL("fire.html?tab="+a.id);h.items.push({name:g.getMessage("_0_scripts_found"),image:"download",doneImage:"fire",tabid:a.id,tamperfire:!0,url:f,newtab:!0});d.push(h)}h={name:"scripts",sub_menu_item:!0,pos:"right",items:[]};f=Ba(a);h.items=h.items.concat(f);k.values.enabled&&!f.length&&b&&(la.isAllowed(b)?
h.items.push({name:g.getMessage("No_script_is_running"),image:"info"}):h.items.push({name:g.getMessage("This_page_is_blacklisted_at_the_security_settings"),image:"critical"}));k.values.enabled&&(100>k.values.configMode||!f.length)&&(h.items.push({name:g.getMessage("Get_new_scripts___"),image:"script_download",url:"http://tampermonkey.net/scripts.php",newtab:!0}),h.items.push({name:g.getMessage("Add_new_script___"),image:"script_add",url:chrome.extension.getURL("options.html")+"?url="+encodeURIComponent(c)+
"#open=new-user-script",newtab:!0}));d.push(h);b={name:"commands",id:"commands",sub_menu_item:!0,pos:"left",items:[]};h=a.id;a=[];var h=null==h||void 0==h?H.list():H.listByTabId(h),e;for(e in h)h.hasOwnProperty(e)&&(f=h[e],a.push({name:f.name,id:f.id,accessKey:f.accessKey,image:"menu_cmd",menucmd:!0}));a.length&&(b.items=a);b.items.push({name:g.getMessage("Check_for_userscripts_updates"),id:"run_script_updates",button:!0,image:"update"});b.items.push({name:g.getMessage("Report_a_bug"),image:"bug",
url:"http://tampermonkey.net/bug",newtab:!0});b.items.push({name:g.getMessage("Please_consider_a_donation"),image:"donation",url:"http://tampermonkey.net/donate.html",newtab:!0});d.push(b);e={name:"about",sub_menu_item:!0,pos:"bottom",items:[]};e.items.push({name:g.getMessage("Dashboard"),image:"utilities",url:chrome.extension.getURL("options.html")+"?"+["url="+encodeURIComponent(c),"selected=dashboard"].join("&"),newtab:!0});c="version="+chrome.extension.getVersion()+"&ext="+n.SELF.ID.substr(0,4);
e.items.push({image:"info",urls:[{name:" "+g.getMessage("Help"),url:"http://tampermonkey.net/faq.php?"+c,newtab:!0},{name:" "+g.getMessage("Changelog"),url:"http://tampermonkey.net/changelog.php?"+c,newtab:!0}]});d.push(e);return d},ga=function(a){var b=[],c;b.push({name:"Version",id:null,version:!0,value:chrome.extension.getVersion()});chrome.extension.inIncognitoContext&&"temporary"==k.values.incognito_mode&&b.push({globalhint:!0,image:"critical",value:g.getMessage("All_modifications_are_only_kept_until_this_incognito_session_is_closed_")});
ka.getWarnings().forEach(function(a){b.push({globalhint:!0,image:"critical",value:a.text,description:a.description,info_url:a.url})});var d={name:g.getMessage("Installed_userscripts"),main_menu_item:!0,scriptTab:!0,id:"dashboard"};O.getAllUserscripts().always(function(h){h=h||[];var f=Ba(null,!0);c=f.length;h.forEach(function(a){f.push({name:a.name,uuid:a.id,icon:a.icon,code:null,position:0,positionof:c,enabled:a.enabled,version:a.version,description:a.description,nativeScript:!0})});f.push({name:g.getMessage("No_script_is_installed"),
image:"info",visible:!c});f.push({name:g.getMessage("Get_some_scripts___"),image:"edit_add",url:"http://tampermonkey.net/scripts.php",newtab:!0,visible:!c});f.push({name:g.getMessage("New_userscript"),id:null,image:"script_add",icon:chrome.extension.getURL("images/txt.png"),code:k.values.scriptTemplate,nnew:!0,uuid:"new-user-script",position:-1,positionof:c,enabled:!0,userscript:!0});d.items=f;b.push(d);h={name:g.getMessage("Settings"),main_menu_item:!0,id:"settings",selected_default:!0};var e,m,
l,t,p,r,q,v,E,A,w,x,y;A=null;e={name:g.getMessage("General"),sub_menu_item:!0,items:[]};e.items.push({name:g.getMessage("Config_Mode"),id:"configMode",level:0,option:!0,select:[{name:g.getMessage("Novice"),value:0},{name:g.getMessage("Beginner"),value:50},{name:g.getMessage("Advanced"),value:100}],value:k.values.configMode,desc:g.getMessage("Changes_the_number_of_visible_config_options")});e.items.push({name:"Language",id:"i18n",level:0,option:!0,reload:!0,warning:{msg:g.getMessage("A_reload_is_required")},
select:[{name:"Browser Default",value:null},{name:g.getOriginalMessage("English"),value:"en"},{name:g.getOriginalMessage("German"),value:"de"},{name:g.getOriginalMessage("French"),value:"fr"},{name:g.getOriginalMessage("Italian"),value:"it"},{name:g.getOriginalMessage("Russian"),value:"ru"},{name:g.getOriginalMessage("Spanish"),value:"es"},{name:g.getOriginalMessage("Polish"),value:"pl"},{name:g.getOriginalMessage("Portuguese_Brazil"),value:"pt-br"},{name:g.getOriginalMessage("Chinese__Simplified_"),
value:"zh_CN"},{name:g.getOriginalMessage("Chinese__Traditional_"),value:"zh_TW"},{name:g.getOriginalMessage("Japanese"),value:"ja"}],value:k.values.i18n,validation:{image:"info",opacity:0.9,msg:g.getMessage("Your_language_is_not_supported__Click_here_to_get_intructions_how_to_translate_TM_"),url:"http://tampermonkey.net/faq.php#Q500"}});e.items.push({name:g.getMessage("Make_includes_more_safe"),id:"safeUrls",level:60,option:!0,checkbox:!0,enabled:k.values.safeUrls,desc:g.getMessage("Includes_more_safe_example")});
e.items.push({name:g.getMessage("Fix_includes"),id:"tryToFixUrl",level:60,option:!0,checkbox:!0,enabled:k.values.tryToFixUrl,desc:g.getMessage("Fix_includes_example")});e.items.push({name:g.getMessage("Auto_reload_on_script_enabled"),level:20,id:"autoReload",option:!0,checkbox:!0,enabled:k.values.autoReload,desc:g.getMessage("Auto_reload_on_script_enabled_desc")});e.items.push({name:g.getMessage("Anonymous_statistics"),level:0,id:"statistics_enabled",option:!0,checkbox:!0,enabled:k.values.statistics_enabled,
desc:g.getMessage("Allow_Tampermonkey_to_collect_anonymous_statistics_via_Google_Analytics")});e.items.push({name:g.getMessage("Debug_scripts"),level:100,id:"debug",option:!0,checkbox:!0,enabled:k.values.debug,desc:""});e.items.push({name:g.getMessage("Show_fixed_source"),level:100,id:"showFixedSrc",option:!0,checkbox:!0,enabled:k.values.showFixedSrc,desc:""});e.items.push({name:g.getMessage("LogLevel"),id:"logLevel",level:0,option:!0,select:[{name:g.getMessage("Debug"),value:60},{name:g.getMessage("Error"),
value:0}],value:k.values.logLevel,desc:""});m={name:g.getMessage("Native_Script_Import"),sub_menu_item:!0,need_save:!0,items:[]};A={};k.values.native_import&&(A=!0===n.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS?{image:"button_ok",msg:g.getMessage("TM_has_access_to_file_URIs")}:{image:"critical",msg:g.getMessage("Tampermonkey_needs_access_to_file_URIs__Visit_the_FAQ_"),url:"http://tampermonkey.net/faq.php#Q204"});m.items.push({name:g.getMessage("Enable_Native_Script_Import"),id:"native_import",level:0,option:!0,
checkbox:!0,enabled:k.values.native_import,validation:A});m.items.push({name:g.getMessage("Post_Import_Action"),id:"native_import_post_action",level:0,option:!0,select:[{name:g.getMessage("None"),value:"none"},{name:g.getMessage("Disable_Extension"),value:"disable"},{name:g.getMessage("Uninstall_Extension"),value:"uninstall"}],value:k.values.native_import_post_action,desc:g.getMessage("What_action_should_be_done_after_a_native_userscript_was_imported_sucessfully_")});A={};k.values.native_import&&
(A=O.isPathValid()?{image:"button_ok",msg:g.getMessage("Everything_is_setup_correctly_")}:{image:"critical",msg:g.getMessage("Tampermonkey_needs_to_know_the_absolute_path_to_your_browser_profile_folder_Visit_the_FAQ_"),url:"http://tampermonkey.net/faq.php#Q205"});m.items.push({name:g.getMessage("Browser_Profile_Path"),id:"native_import_path",level:0,option:!0,text:!0,width:2,value:k.values.native_import_path,validation:A});n.OPTIONS.HAS_TESLA&&(w={name:g.getMessage("TESLA")+" BETA",sub_menu_item:!0,
level:50,need_save:!0,items:[]},w.items.push({name:g.getMessage("Enable_TESLA"),id:"sync_enabled",level:50,option:!0,checkbox:!0,enabled:k.values.sync_enabled,desc:g.getMessage("Tampermonkey_External_Script_List_Access")}),w.items.push({name:g.getMessage("Sync_Type"),id:"sync_type",enabler:!0,level:50,option:!0,select:[{name:"pastebin.com",value:J.types.ePASTEBIN},{name:"Chrome Sync (Beta)",value:J.types.eCHROMESYNC,enable:{sync_id:0,create_tesla_data:0}}],value:k.values.sync_type}),w.items.push({name:g.getMessage("Sync_Id"),
id:"sync_id",enabledBy:"sync_type",level:50,text:!0,value:k.values.sync_id,option:!0}),w.items.push({name:g.getMessage("Create_Exportable_Data"),id:"create_tesla_data",enabledBy:"sync_type",button:!0,ignore:!0,level:60,warning:{msg:g.getMessage("Copy_exportable_data_to_clipboard_Ok_")}}));p={name:g.getMessage("Appearance"),sub_menu_item:!0,items:[]};p.items.push({name:g.getMessage("Layout"),id:"layout",level:0,option:!0,select:La.getLayouts(),value:k.values.layout,desc:""});A={};"off"==k.values.notification_showUpdate&&
(A={image:"critical",msg:g.getMessage("Are_you_sure_that_you_don_t_want_to_be_notified_of_updates_")});p.items.push({name:g.getMessage("Update_Notification"),id:"notification_showUpdate",level:50,option:!0,select:[{name:g.getMessage("Off"),value:"off"},{name:g.getMessage("Show_notification"),value:"notification"},{name:g.getMessage("Open_changelog"),value:"changelog"}],value:k.values.notification_showUpdate,validation:A});p.items.push({name:g.getMessage("Icon_badge_info"),id:"appearance_badges",level:50,
option:!0,select:[{name:g.getMessage("Off"),value:"off"},{name:g.getMessage("Running_scripts"),value:"running"},{name:g.getMessage("Unique_running_scripts"),value:"running_unique"},{name:g.getMessage("Disabled_scripts"),value:"disabled"},{name:"TamperFire",value:"tamperfire"}],value:k.values.appearance_badges});n.OPTIONS.HAS_TAMPERFIRE&&(E={name:g.getMessage("TamperFire"),sub_menu_item:!0,items:[]},E.items.push({name:g.getMessage("Enable_TamperFire"),id:"fire_enabled",level:0,option:!0,checkbox:!0,
enabled:k.values.fire_enabled,desc:g.getMessage("Searches_for_scripts_that_can_be_used_on_the_current_page_")}),E.items.push({name:g.getMessage("Use_top_frame_URL_only"),id:"fire_topOnly",level:0,option:!0,checkbox:!0,enabled:k.values.fire_topOnly,desc:""}),E.items.push({name:g.getMessage("Enable_Sort_Cache"),id:"fire_sort_cache_enabled",level:100,checkbox:!0,option:!0,enabled:k.values.fire_sort_cache_enabled,desc:""}),E.items.push({name:g.getMessage("Update_interval"),id:"fire_updatePeriod",level:50,
option:!0,select:[{name:g.getMessage("Never"),value:0},{name:g.getMessage("Every_Day"),value:864E5},{name:g.getMessage("Every_Week"),value:6048E5},{name:g.getMessage("Every_2_Weeks"),value:12096E5},{name:g.getMessage("Every_Month"),value:2592E6}],value:k.values.fire_updatePeriod,desc:""}));l={name:g.getMessage("Editor"),sub_menu_item:!0,level:20,items:[]};l.items.push({name:g.getMessage("Enable_Editor"),id:"editor_enabled",level:100,option:!0,checkbox:!0,enabled:k.values.editor_enabled,reload:!0,
warning:{msg:g.getMessage("A_reload_is_required")},desc:""});l.items.push({name:g.getMessage("Key_Mapping"),id:"editor_keyMap",level:50,option:!0,reload:!0,warning:{msg:g.getMessage("A_reload_is_required")},select:[{name:g.getMessage("Windows"),value:"windows"},{name:g.getMessage("Emacs"),value:"emacs"},{name:g.getMessage("Vim"),value:"vim"}],value:k.values.editor_keyMap});l.items.push({name:g.getMessage("Indentation_Width"),id:"editor_indentUnit",level:50,option:!0,select:[{name:g.getMessage("1"),
value:1},{name:g.getMessage("2"),value:2},{name:g.getMessage("3"),value:3},{name:g.getMessage("4"),value:4},{name:g.getMessage("5"),value:5},{name:g.getMessage("6"),value:6},{name:g.getMessage("7"),value:7},{name:g.getMessage("8"),value:8},{name:g.getMessage("9"),value:9},{name:g.getMessage("10"),value:10},{name:g.getMessage("11"),value:11}],value:k.values.editor_indentUnit,desc:""});l.items.push({name:g.getMessage("Indent_with"),id:"editor_indentWithTabs",level:50,option:!0,select:[{name:g.getMessage("Tabs"),
value:"tabs"},{name:g.getMessage("Spaces"),value:"spaces"}],value:k.values.editor_indentWithTabs,desc:""});l.items.push({name:g.getMessage("TabMode"),id:"editor_tabMode",level:50,option:!0,select:[{name:g.getMessage("Classic"),value:"classic"},{name:g.getMessage("Smart"),value:"smart"}],value:k.values.editor_tabMode,desc:""});l.items.push({name:g.getMessage("Reindent_on_typing"),id:"editor_electricChars",level:50,option:!0,checkbox:!0,enabled:k.values.editor_electricChars,desc:""});l.items.push({name:g.getMessage("Enable_autoSave"),
id:"editor_autoSave",level:20,option:!0,checkbox:!0,enabled:k.values.editor_autoSave,desc:""});l.items.push({name:g.getMessage("Enable_easySave"),id:"editor_easySave",level:20,option:!0,checkbox:!0,enabled:k.values.editor_easySave,desc:""});t={name:g.getMessage("Script_Update"),sub_menu_item:!0,level:0,items:[]};t.items.push({name:g.getMessage("Check_disabled_scripts"),id:"scriptUpdateCheckDisabled",level:0,option:!0,checkbox:!0,enabled:k.values.scriptUpdateCheckDisabled,desc:""});t.items.push({name:g.getMessage("Check_interval"),
id:"scriptUpdateCheckPeriod",level:0,option:!0,select:[{name:g.getMessage("Never"),value:0},{name:g.getMessage("Every_Hour"),value:36E5},{name:g.getMessage("Every_6_Hours"),value:216E5},{name:g.getMessage("Every_12_Hour"),value:432E5},{name:g.getMessage("Every_Day"),value:864E5},{name:g.getMessage("Every_Week"),value:6048E5}],value:k.values.scriptUpdateCheckPeriod,desc:""});t.items.push({name:g.getMessage("Dont_ask_me_for_simple_script_updates"),id:"notification_silentScriptUpdate",level:80,option:!0,
checkbox:!0,enabled:k.values.notification_silentScriptUpdate,desc:""});t.items.push({name:g.getMessage("Hide_notification_after"),id:"scriptUpdateHideNotificationAfter",level:50,option:!0,select:[{name:g.getMessage("Never"),value:0},{name:g.getMessage("15_Seconds"),value:15E3},{name:g.getMessage("30_Seconds"),value:3E4},{name:g.getMessage("1_Minute"),value:6E4},{name:g.getMessage("5_Minutes"),value:3E5},{name:g.getMessage("1_Hour"),value:36E5}],value:k.values.scriptUpdateHideNotificationAfter,desc:""});
n.RUNTIME.NEED_UNSAFEWINDOW_PROXY&&(A="auto"==k.values.runtime_unsafeWindow?{}:{image:"critical",msg:g.getMessage("This_option_is_essential_for_many_userscripts_to_work__Visit_the_FAQ_"),url:"http://tampermonkey.net/faq.php#Q404"},v={name:g.getMessage("Runtime"),sub_menu_item:!0,level:80,items:[]},v.items.push({name:g.getMessage("UnsafeWindow_retrieval_method"),id:"runtime_unsafeWindow",level:80,option:!0,select:[{name:g.getMessage("Auto"),value:"auto"},{name:g.getMessage("Native"),value:"native"},
{name:g.getMessage("Sandbox"),value:"sandbox"}],value:k.values.runtime_unsafeWindow,desc:g.getMessage("A_lot_of_userscripts_require_the_unsafeWindow_object_to_interact_with_the_pages_javascript_"),validation:A}));r={name:g.getMessage("Security"),sub_menu_item:!0,level:50,items:[]};n.OPTIONS.HAS_CSP&&(r.items.push({name:g.getMessage("Allow_overwrite_javascript_settings"),id:"scriptblocker_overwrite",level:80,option:!0,select:[{name:g.getMessage("Yes"),value:"yes"},{name:g.getMessage("No"),value:"no"}],
value:k.values.scriptblocker_overwrite,desc:g.getMessage("Tampermonkey_can_not_work_when_javascript_is_disabled")}),r.items.push({name:g.getMessage("Add_TM_to_CSP"),id:"webrequest_fixCSP",level:80,option:!0,select:[{name:g.getMessage("Yes"),value:"yes"},{name:g.getMessage("No"),value:"no"}],value:k.values.webrequest_fixCSP,desc:g.getMessage("Tampermonkey_might_not_be_able_to_provide_access_to_the_unsafe_context_when_this_is_disabled")}),r.items.push({name:g.getMessage("Allow_headers_to_be_modified_by_scripts"),
id:"webrequest_modHeaders",level:80,option:!0,select:[{name:g.getMessage("Yes"),value:"yes"},{name:g.getMessage("Auto"),value:"auto"},{name:g.getMessage("No"),value:"no"}],value:k.values.webrequest_modHeaders,desc:""}));chrome.extension.inIncognitoContext||(A="temporary"==k.values.incognito_mode?{}:{image:"critical",msg:"Permanent mode is still a BETA feature!"},r.items.push({name:g.getMessage("Store_data_in_incognito_mode"),id:"incognito_mode",level:50,option:!0,select:[{name:g.getMessage("Temporary"),
value:"temporary"},{name:g.getMessage("Permanent"),value:"permanent"}],value:k.values.incognito_mode,validation:A}));r.items.push({name:g.getMessage("Page_Filter_Mode"),id:"page_filter_mode",level:50,option:!0,select:[{name:g.getMessage("Off"),value:"off"},{name:g.getMessage("Blacklist"),value:"black"},{name:g.getMessage("Whitelist"),value:"white"},{name:g.getMessage("Both"),value:"black+white"}],value:k.values.page_filter_mode,desc:""});r.items.push({name:g.getMessage("Whitelisted_Pages"),id:"page_whitelist",
level:50,option:!0,input:!0,array:!0,value:k.values.page_whitelist,desc:""});r.items.push({name:g.getMessage("Blacklisted_Pages"),id:"forbiddenPages",level:50,option:!0,input:!0,array:!0,value:k.values.forbiddenPages,desc:""});q={name:g.getMessage("BlackCheck"),sub_menu_item:!0,level:50,items:[]};q.items.push({name:g.getMessage("Script_Blacklist_Source"),id:"script_blacklist_type",level:50,option:!0,select:[{name:g.getMessage("Off"),value:"off"},{name:g.getMessage("Server_And_Manual"),value:"server"},
{name:g.getMessage("Only_Manual"),value:"only_manual"}],value:k.values.script_blacklist_type});q.items.push({name:g.getMessage("Blacklist_Severity"),id:"script_blacklist_severity",level:50,option:!0,select:[{name:g.getMessage("severity_1"),value:1},{name:g.getMessage("severity_2"),value:2},{name:g.getMessage("severity_3"),value:3},{name:g.getMessage("severity_4"),value:4},{name:g.getMessage("severity_5"),value:5},{name:g.getMessage("severity_6"),value:6},{name:g.getMessage("severity_7"),value:7},
{name:g.getMessage("severity_8"),value:8},{name:g.getMessage("severity_9"),value:9},{name:g.getMessage("severity_10"),value:10}],value:k.values.script_blacklist_severity});q.items.push({name:g.getMessage("Manual_Script_Blacklist"),id:"require_blacklist",level:50,option:!0,input:!0,array:!0,value:k.values.require_blacklist,desc:""});var B=!1;A={};u.map("exe sh crx com bat scr".split(" "),function(a){return"name."+a}).forEach(function(a){B|=M.is_whitelisted(a)});B&&(A={image:"critical",msg:g.getMessage("Your_whitelist_seems_to_include_executable_files_This_means_your_userscripts_may_download_malware_or_spyware_to_your_harddisk_")});
y={name:g.getMessage("Downloads")+" BETA",sub_menu_item:!0,level:50,items:[]};y.items.push({name:g.getMessage("Download_Mode"),id:"downloads_mode",level:50,option:!0,select:u.select([{name:g.getMessage("Default"),value:M.staticVars.DEFAULT},{name:g.getMessage("Off"),value:M.staticVars.OFF},{name:g.getMessage("Native"),value:M.staticVars.NATIVE},{name:g.getMessage("Browser_API"),value:n.DOWNLOAD.SUPPORTED?M.staticVars.CHROME:null}],function(a){return a.value}),value:k.values.downloads_mode,desc:g.getMessage("The_Browser_API_mode_requires_a_special_permission_")+
"\n'Default' means 'off' at the moment."});y.items.push({name:g.getMessage("Whitelisted_File_Extensions"),id:"downloads_extension_whitelist",level:50,option:!0,input:!0,array:!0,value:k.values.downloads_extension_whitelist,desc:g.getMessage("Only_files_with_these_extensions_can_be_saved_to_the_harddisk_Be_careful_to_not_allow_file_extensions_that_represent_executables_at_your_operating_system_"),validation:A});A={name:g.getMessage("Userscripts"),sub_menu_item:!0,level:80,items:[]};A.items.push({name:g.getMessage("New_script_template_"),
id:"scriptTemplate",level:80,option:!0,input:!0,value:k.values.scriptTemplate});x={name:g.getMessage("Reset_Section"),sub_menu_item:!0,level:50,items:[]};x.items.push({name:g.getMessage("Restart_Tampermonkey"),id:"reset_simple",level:50,button:!0,reload:!0,value:0,warning:{msg:g.getMessage("This_will_restart_Tampermonkey_Ok_")}});x.items.push({name:g.getMessage("Factory_Reset"),id:"reset_factory",level:80,button:!0,reload:!0,value:0,warning:{msg:g.getMessage("This_will_remove_all_scripts_and_reset_all_settings_Ok_")}});
n.OPTIONS.HAS_TESLA&&x.items.push({name:g.getMessage("Chrome_Sync_Reset"),id:"reset_chrome_sync",level:80,button:!0,reload:!0,value:0,warning:{msg:g.getMessage("This_will_remove_all_stored_data_from_google_sync_Ok_")}});ja&&x.items.push({name:"Install Tests",id:"install_tests",level:80,button:!0,reload:!1,ignore:!0,value:0,warning:{msg:"This will install a lot of test scripts!"}});h.items=u.select([e,p,t,v,w,m,E,l,r,q,y,A,x],function(a){return!!a});b.push(h);a&&a(b)})},qa=function(a,b,c){var d=[],
g=new Y.Script,f;for(f in a){var e=a[f],l;if(b){l={};for(var s in g)g.hasOwnProperty(s)&&"textContent"!=s&&"requires"!=s&&"resources"!=s&&(u.toType(g[s]),l[s]=e[s]);l.code=k.values.showFixedSrc?ma.mkCompat(e.textContent,e,!1):e.textContent;l.requires=u.map(e.requires,function(a){return T.getElement(e.uuid,a.url)||{url:a.url}});l.resources=u.map(e.resources,function(a){return T.getElement(e.uuid,a.url)||{url:a.url}})}else l=c?e:{name:e.name,uuid:e.uuid,system:e.system,support:!!e.supportURL,origin:!!r.determineOrigin(e),
enabled:e.enabled,position:e.position};l.blacklisted=e.evilness>=k.values.script_blacklist_severity;l.file_url=e.downloadURL||e.fileURL;l.positionof=a.length;l.userscript=e.options.user_agent?!1:!0;l.user_agent=e.options.user_agent;b&&(l.origin=r.determineOrigin(e));e.icon64||e.icon||(l.icon64=chrome.extension.getURL(l.user_agent?"images/user_agent.png":"images/txt.png"));if(e.options)for(s in g.options)g.options.hasOwnProperty(s)&&(l[s]=e.options[s]);d.push(l)}return d},Ba=function(a,b){void 0==
b&&(b=!1);var c=[];a?v.get.empty(a.id)?console.warn("bg: WARN: Tabs.get.urls["+a.id+"] is empty!"):u.each(v.get.urls(a.id),function(a,b){if(la.isAllowed(b))for(var f=r.determineScriptsToRun(b),e=0;e<f.length;e++){for(var g=!1,k=0;k<c.length;k++)if(c[k].uuid==f[e].uuid){g=!0;break}g||c.push(f[e])}}):c=r.determineScriptsToRun(null);return qa(c,b)},ra={copy:function(a){var b=document.createElement("iframe");document.body.appendChild(b);try{b.contentDocument.designMode="on","html"==a.type?(b.setAttribute("sandbox",
"allow-same-origin"),b.contentDocument.documentElement.innerHTML=a.content,b.contentDocument.execCommand("selectAll",!1,null)):b.contentDocument.oncopy=function(b){b.clipboardData.setData(a.mimetype||"text/plain",a.content);b.preventDefault()},b.contentDocument.execCommand("copy",!1,null),b.contentDocument.designMode="off"}catch(c){console.error("bg: clipboard Error: "+c.message)}b.parentNode.removeChild(b);b=null}};clip=ra;var L={asked:!1,runCheck:!1,hasPermission:!1,init:function(){V.has(V.permContentSettings).done(function(a){L.hasPermission=
a;L.runCheck=L.hasPermission&&"yes"==k.values.scriptblocker_overwrite;D&&console.log("bg: contentSettings: runCheck = "+L.runCheck+" hasPerm = "+L.hasPermission)})},askForPermission:function(a){V.ask(V.permContentSettings,g.getMessage("A_script_blocker_was_detected_"),g.getMessage("Click_here_to_allow_TM_to_override_the_script_blocker")).done(a)},requestPermissionEx:function(a){"yes"!=k.values.scriptblocker_overwrite?a&&a():V.has(V.permContentSettings).done(function(b){L.asked?a&&a(b,!1):b?a(b,!1):
L.askForPermission(function(b){a&&a(b,!0);b&&!L.runCheck&&(L.runCheck=!0,ha.reset())});L.asked=!0})},remove:function(a){V.remove(V.permContentSettings).done(a)}},ha={run:function(a,b){var c=1,d=function(){0==--c&&(b&&b(),window.location.reload())};if("config"==a){var g=p.listValues(),f;for(f in g){var e=g[f];-1!=e.search(n.CONSTANTS.PREFIX.SCRIPT)&&-1!=e.search(n.CONSTANTS.PREFIX.COND)&&-1!=e.search(n.CONSTANTS.PREFIX.STORE)&&-1!=e.search(n.CONSTANTS.PREFIX.META)&&(c++,p.deleteValue(e).always(d))}}else"factory"==
a&&(I.isReady()&&(c++,I.clean(d)),L.hasPermission&&(c++,L.remove(d)),c++,M.remove_permission().done(d),c++,p.factoryReset().always(d));d()},reset:function(a){ha.run(null,a)},factoryReset:function(a){ha.run("factory",a)},configReset:function(a){ha.run("config",a)}},ca=function(){var a=function(){chrome.runtime&&chrome.runtime.lastError&&void 0},b={},c={},d=function(a){var b=0,c=function(){D&&console.log("badge: set "+b);0==b?chrome.browserAction.setBadgeText({text:"",tabId:a}):chrome.browserAction.setBadgeText({text:b.toString(),
tabId:a})};if("off"==k.values.appearance_badges)b=0;else if("running"==k.values.appearance_badges)a&&!v.get.empty(a)&&(b=v.get.stats(a).running);else if("running_unique"==k.values.appearance_badges)a&&!v.get.empty(a)&&(b=v.get.stats(a,!0).unique);else if("disabled"==k.values.appearance_badges)a&&!v.get.empty(a)&&(b=v.get.stats(a).disabled);else if("tamperfire"==k.values.appearance_badges){var d=function(a){b=a;c()};if(!I.isReady()){d("?");return}I.tab.getCount(a,d);return}c()},h={init:function(){h.setIcon();
chrome.browserAction.setBadgeBackgroundColor&&"gcal"===n.SELF.ID.substr(0,4)&&chrome.browserAction.setBadgeBackgroundColor({color:"#444"})},setIcon:function(b,d){c[b]&&window.clearTimeout(c[b]);c[b]=window.setTimeout(function(){var h=d;void 0==h&&(h=k);var l;l=null;var n=!1,p=!1,r=!!v.get.empty(b);b&&!r&&(n=v.get.blocker(b),p=v.get.forbidden(b));p?(h.images.icon="images/icon_forbidden.png",l=g.getMessage("At_least_one_part_of_this_page_is_listed_at_the_forbidden_pages_setting_")):n?(h.images.icon=
"images/icon_blocker.png",l=g.getMessage("Some_scripts_might_be_blocked_by_the_javascript_settings_for_this_page_or_a_script_blocker_")):h.images.icon=k.values.enabled&&!r?"images/icon.png":"images/icon_grey.png";h={path:chrome.extension.getURL(h.images.icon)};l={title:l?l:chrome.extension.manifest.name};null!=b&&(h.tabId=b,l.tabId=b);try{chrome.browserAction.setIcon(h,a),chrome.browserAction.setTitle(l)}catch(q){console.warn("bg: ERROR while setIcon! "+q.message)}delete c[b]},500)},setBadge:function(a){b[a]&&
window.clearTimeout(b[a]);b[a]=window.setTimeout(function(){d(a);delete b[a]},500)}};return h}(),w={infoChanged:[],redirects:{},addInfoChangedListener:function(a){w.infoChanged.push(a)},runInfoChangedListener:function(){for(var a=0;a<w.infoChanged.length;a++)w.infoChanged[a](y)},headerCheck:function(a){if(0<=a.tabId&&!1==y.verified){D&&console.log("bg: verify that webRequest is working at "+a.type+" to "+a.url);for(var b=!1,c=RegExp("^"+y.testprefix),d=0;d<a.requestHeaders.length;d++){var g=a.requestHeaders[d];
0==g.name.search(c)&&(D&&console.log("bg: found "+g.name+" @webRequest :)"),b=!0)}if(b||!(0<y.verifyCnt--)){y.headers=b;y.verified=!0;w.runInfoChangedListener();D&&console.debug("bg: verified webRequest "+(y.headers?"":"not ")+"being working");try{chrome.webRequest.onSendHeaders.removeListener(w.headerCheck)}catch(f){y.headers=!1,y.verified=!0,w.runInfoChangedListener()}}}},detectRedirectToCache:function(a){G.registerLateCallback(function(){w.detectRedirect(a)})},detectRedirect:function(a){var b=
a.responseHeaders,c=a.requestId,d=!1,g=!1,f=!1,e="xmlhttprequest"==a.type,l="main_frame"==a.type||"sub_frame"==a.type;if(!e&&!l&&"no"==k.values.webrequest_fixCSP)return{};e&&w.redirects[c]&&(d=!0);for(var p=0;p<b.length;p++){var t=b[p],r=t.name.toLowerCase();if("location"==r)if(l)g=!0;else{if(e){(function(){d&&window.clearTimeout(w.redirects[c].to);w.redirects[c]={url:t.value,to:window.setTimeout(function(){delete w.redirects[c]},1E4)}})();break}}else"yes"!=k.values.webrequest_fixCSP||"x-webkit-csp"!=
r&&"x-content-security-policy"!=r&&"content-security-policy"!=r||(f=t.value.replace(/script-src /,"script-src "+n.REQUESTS.INTERNAL_PAGE_URL+n.SELF.ID+" 'unsafe-inline' 'unsafe-eval' "),D&&console.log('csp: replace "'+t.value+'" with "'+f+'"'),t.value=f,b[p]=t,f=!0)}!g&&l&&v.events.response(a.tabId,a.frameId,a.url);e&&d&&(b.push({name:"TM-finalURL",value:w.redirects[c].url}),f=!0);return f?{responseHeaders:b}:{}},headerFix:function(a){var b="main_frame"==a.type,c=L.runCheck;(b||"sub_frame"==a.type)&&
c&&(c=F.parse(a.url).origin+"/*",chrome.contentSettings.javascript.set({primaryPattern:c,setting:"allow"}));var c=b&&v.get.user_agent(a.tabId,a.frameId),d=y.headers&&"xmlhttprequest"==a.type;if(!c&&!d)return{};var g=!1,b={},f=[],e=RegExp("^"+y.prefix),k;c&&(k=v.get.user_agent(a.tabId,a.frameId));for(var l=0;l<a.requestHeaders.length;l++){var n=a.requestHeaders[l];d&&0==n.name.search(e)?f.push(n):c&&"user-agent"==n.name.toLowerCase()?(g=!0,b[n.name]=k):b[n.name]=n.value}if(d){for(l=0;l<f.length;l++)n=
f[l],g=!0,b[n.name.replace(e,"")]=n.value;y.verified||(g=!0,b[y.testprefix]="true")}if(g){a=[];for(var p in b)b.hasOwnProperty(p)&&""!=p&&a.push({name:p,value:b[p]});return{requestHeaders:a}}return{}},sucRequest:function(a){0<a.tabId&&console.log("bg: "+a.requestId+" print "+a.type+" request of tabId "+a.tabId+" to "+a.url)},checkRequestForUserscript:function(a){if(0<a.tabId&&"POST"!=a.method&&va.isScriptUrl(a.url))return r.installFromUrl(a.url,{},{silent_fail:!0}).fail(function(){chrome.tabs.update(a.tabId,
{url:a.url+"#bypass=true"},function(){})}),{redirectUrl:"javascript:history.back()"};v.events.reset(a.tabId,!0);v.events.request(a.tabId,a.frameId,a.url);return{}},removeWebRequestListeners:function(){if(y.use)try{w.preCleanup(),chrome.webRequest.onBeforeRequest.removeListener(w.checkRequestForUserscript),chrome.webRequest.onBeforeSendHeaders.removeListener(w.headerFix),chrome.webRequest.onHeadersReceived.removeListener(w.detectRedirect),y.headers&&!1==y.verified&&chrome.webRequest.onSendHeaders.removeListener(w.headerCheck)}catch(a){}y.headers=
!1;y.verified=!0;w.runInfoChangedListener()},preInit:function(){y.use&&(w.tmp_cache=!0,chrome.webRequest.onHeadersReceived.addListener(w.detectRedirectToCache,{urls:["http://*/*","https://*/*"]},["responseHeaders","blocking"]),chrome.webRequest.handlerBehaviorChanged())},preCleanup:function(){y.use&&w.tmp_cache&&(chrome.webRequest.onHeadersReceived.removeListener(w.detectRedirectToCache),delete w.tmp_cache)},init:function(a,b){if(y.use)try{w.preCleanup();var c={urls:["http://*/*","https://*/*"],types:["xmlhttprequest"]};
chrome.webRequest.onBeforeRequest.addListener(w.checkRequestForUserscript,{urls:["http://*/*","https://*/*","file://*/*"],types:["main_frame"]},["blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(w.headerFix,{urls:["http://*/*","https://*/*","file://*/*"]},["requestHeaders","blocking"]);chrome.webRequest.onHeadersReceived.addListener(w.detectRedirect,{urls:["http://*/*","https://*/*"]},["responseHeaders","blocking"]);b&&(a||chrome.webRequest.onSendHeaders.addListener(w.headerCheck,c,["requestHeaders"]));
chrome.webRequest.handlerBehaviorChanged();y.verified=a;y.headers=b;y.id=u.createUUID();y.testprefix=y.prefix+u.createUUID();y.prefix=y.prefix+y.id+"_";w.runInfoChangedListener()}catch(d){D&&console.error("bg: error initializing webRequests "+d.message),w.removeWebRequestListeners()}},finalize:function(){w.removeWebRequestListeners()}},oa={retries:5,onCommitedListener:function(a){v.events.commited(a.tabId,a.frameId,a.url)},wait:function(){chrome.webNavigation&&chrome.webNavigation.onCommitted?chrome.webNavigation.onCommitted.addListener(oa.onCommitedListener):
n.RUNTIME.OPERA||0==oa.retries--||(D&&console.log("bg: waitForWebNav()"),window.setTimeout(oa.wait,300))}},G={late:!1,callbacks:[],init:function(){},registerLateCallback:function(a){D&&console.log("toea: register callback");G.callbacks.push(a)},setReady:function(){D&&console.debug("toea: run "+G.callbacks.length+" callbacks");G.late=!0;for(var a=0;a<G.callbacks.length;a++)G.callbacks[a]();G.callbacks=[]}},Ma=function(){var a=!1,b=null,c=function(){a||(D&&console.debug("Unloader.onbeforeunload()"),
b&&b(),a=!0)};return{init:function(a){b=a;window.addEventListener("beforeunload",c,!1)}}}(),Ea=function(){var a=chrome.extension.getVersion(),b=null,c=!1,d=!1,h=function(){if(G.late){var e="version="+a+"&ext="+n.SELF.ID.substr(0,4)+"&updated=true",f;c?(f="http://tampermonkey.net/installed.php?"+e,d=!0):(e+="&old="+b,f="http://tampermonkey.net/changelog.php?"+e);"off"!=k.values.notification_showUpdate&&("notification"==k.values.notification_showUpdate?U.showUpdate(g.getMessage("Updated_to__0version0",
a),g.getMessage("Click_here_to_see_the_recent_changes"),chrome.extension.getURL("images/icon128.png"),function(a){a.clicked&&chrome.tabs.create({url:f},function(){})}):"changelog"==k.values.notification_showUpdate&&(d||(f+="&intr=true"),d=!0,chrome.tabs.create({url:f,active:d},function(){})))}else G.registerLateCallback(h)},f=function(){var a=null,b,c=x(),d=function(d){b&&(d||null!==a)&&(d||window.clearTimeout(b),b=null,c.resolve(!!a))};chrome.idle.queryState(n.MISC.IDLE_TIMEOUT,function(b){a="active"==
b;d()});b=window.setTimeout(function(){d(!0)},300);return c.promise()},e=function(a){G.late?(D&&console.log("upd: onInstalled",a),a||(a={reason:"mandatory_argument_is_not_set"}),"chrome_update"==a.reason?k.values.statistics_enabled&&Z.tB({updated:!0}):"install"!=a.reason&&"update"!=a.reason||v.scheduleNotification(a.previousVersion,"install"==a.reason)):G.registerLateCallback(function(){e(a)})},l=function(){var a=x(),b=function(){var b=(new Date).getTime(),c=p.getValue(n.CONSTANTS.STORAGE.LAST_START,
0),b=Math.round((b-c)/1E3),c=b<=n.MISC.DISTURBANCE_ALLOWED;D&&console.log("upd: restart?",c,"(",b,"seconds ago)");a.resolve(c)};G.late?b():G.registerLateCallback(b);return a.promise()}(),s=function(){var a=!1,b=!1;f().then(function(a){b=a;return l}).then(function(b){a=b}).always(function(){d=!b||a;h();u=!0})},r=null,u=!1,v={scheduleNotification:function(a,d){u||(b=a,c|=d,r&&window.clearTimeout(r),r=window.setTimeout(s,1E3))}},q=function(a){console.log("An update to version",a.version,"is available")};
chrome.runtime&&chrome.runtime.onInstalled&&chrome.runtime.onInstalled.addListener(e);chrome.runtime&&chrome.runtime.onUpdateAvailable&&chrome.runtime.onUpdateAvailable.addListener(q);(function(){G.registerLateCallback(function(){p.setValue(n.CONSTANTS.STORAGE.LAST_START,(new Date).getTime())})})();return v}(),Ca=function(a,b,c){G.late?(va.isScriptUrl(c.url)&&r.installFromUrl(c.url),"loading"==b.status?v.events.loading(c.id,0,c.url):"complete"==b.status&&v.events.complete(c.id,0,c.url)):window.setTimeout(function(){Ca(a,
b,c)},100)},Na=function(a,b){ea[a]&&(ea[a].onClose(),delete ea[a]);v.events.remove(a)},xa=function(){var a="temporary"==k.values.incognito_mode&&chrome.extension.inIncognitoContext;p.setTemporary(a);a&&(k.values.native_import=!1,k.values.sync_enabled=!1,k.values.fire_updatePeriod=0,k.values.scriptUpdateCheckPeriod=0,k.values.sync_type=0,k.values.statistics_enabled=!1)},Oa=function(){sa(k.values.logLevel);g.setLocale(k.values.i18n);da.setLocale(k.values.i18n);O.setPath(k.values.native_import_path);
k.values.statistics_enabled&&(Z.init(),window.onerror=function(a,c,d){Z.tE(a,chrome.extension.manifest.version+" bg@"+c,d)});L.init();v.listeners.add.onReset(function(a,c){H.clearByTabId(a);p.notifyClientListeners(null,a);c||ca.setIcon(a)});var a=function(a){ca.setIcon(a);ca.setBadge(a)};v.listeners.add.onCommited(a);v.listeners.add.onCompleted(a);k.values.sync_enabled&&k.values.sync_type&&(l.enable(),l.scheduleSync(1E3,!0),l.schedulePeriodicalCheck());k.values.fire_enabled&&I.init();fa.init();a=
function(){M.set_mode(k.values.downloads_mode);M.set_whitelist(k.values.downloads_extension_whitelist)};a();M.config_changed_listener=a;w.addInfoChangedListener(function(a){pa&&pa.setWebRequest(a)});w.init("auto"!=k.values.webrequest_modHeaders,"no"!=k.values.webrequest_modHeaders)},F=Registry.get("uri"),M=Registry.get("downloads");uris=F;down=M;var R,ia,pa,ma,Y,J,g,ja;init=function(){G.init();w.preInit();chrome.tabs.onUpdated.addListener(Ca);chrome.tabs.onRemoved.addListener(Na);chrome.extension.onMessage.addListener(na.handler);
chrome.extension.onConnect.addListener(Aa);chrome.extension.onConnectExternal.addListener(function(a){a.disconnect()});Ma.init(function(){w.finalize();l.finalize()});R=Registry.get("convert");g=Registry.get("i18n");pa=Registry.get("xmlhttprequest");ia=pa.run;ma=Registry.get("compat",n);Y=Registry.get("parser");J=Registry.get("syncinfo");ja=Registry.get("test");chrome.browserAction.setIcon({path:chrome.extension.getURL("images/icon_grey.png")});chrome.browserAction.setPopup({popup:"action.html"});
chrome.browserAction.setTitle({title:"Tampermonkey"});p.init().then(function(){return Fa()}).then(function(){return k.init()}).then(function(){cfgo=k;xa();Oa();Ia();ca.init();window.setTimeout(ba.check,1E4);oa.wait();D&&console.debug("Listeners registered!");window.setTimeout(G.setReady,1);if(ja&&Registry.isDevVersion("test")){var a=ja.framework.prepare(r.doSave);a&&console.error(a)}})};init()}});
