(function(){function p(c,a,e,d){this.atOccurrence=!1;this.cm=c;null==d&&"string"==typeof a&&(d=!1);e=e?c.clipPos(e):k(0,0);this.pos={from:e,to:e};if("string"!=typeof a)a.global||(a=RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(q,h){if(q){a.lastIndex=0;for(var g=c.getLine(h.line).slice(0,h.ch),f=0,b,d;;){a.lastIndex=f;f=a.exec(g);if(!f)break;b=f;d=b.index;f=b.index+1}}else a.lastIndex=h.ch,g=c.getLine(h.line),d=(b=a.exec(g))&&b.index;if(b&&b[0])return{from:k(h.line,d),to:k(h.line,d+
b[0].length),match:b}};else{d&&(a=a.toLowerCase());var l=d?function(c){return c.toLowerCase()}:function(c){return c},m=a.split("\n");this.matches=1==m.length?a.length?function(d,h){var g=l(c.getLine(h.line)),f=a.length,b;if(d?h.ch>=f&&-1!=(b=g.lastIndexOf(a,h.ch-f)):-1!=(b=g.indexOf(a,h.ch)))return{from:k(h.line,b),to:k(h.line,b+f)}}:function(){}:function(a,d){var g=d.line,f=a?m.length-1:0,b=m[f],e=l(c.getLine(g)),n=a?e.indexOf(b)+b.length:e.lastIndexOf(b);if(!(a?n>=d.ch||n!=b.length:n<=d.ch||n!=
e.length-b.length))for(;a?g:g!=c.lineCount()-1;){e=l(c.getLine(g+=a?-1:1));b=m[a?--f:++f];if(0<f&&f<m.length-1)if(e!=b)break;else continue;f=a?e.lastIndexOf(b):e.indexOf(b)+b.length;if(a?f!=e.length-b.length:f!=b.length)break;b=k(d.line,n);g=k(g,f);return{from:a?g:b,to:a?b:g}}}}}var k=CodeMirror.Pos;p.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(c){function a(a){a=k(a,0);e.pos={from:a,to:a};return e.atOccurrence=!1}for(var e=this,
d=this.cm.clipPos(c?this.pos.from:this.pos.to);;){if(c){if(!d.line)return a(0);d=k(d.line-1,this.cm.getLine(d.line-1).length)}if(this.pos=this.matches(c,d))return this.pos.from&&this.pos.to||console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(!c){var l=this.cm.lineCount();if(d.line==l-1)return a(l);d=k(d.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(c){this.atOccurrence&&(c=
CodeMirror.splitLines(c),this.cm.replaceRange(c,this.pos.from,this.pos.to),this.pos.to=k(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0)))}};CodeMirror.defineExtension("getSearchCursor",function(c,a,e){return new p(this,c,a,e)})})();
