window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem);
Registry.require("layout xmlhttprequest crcrc curtain layout/default/tabview layout/default/htmlutil helper statistics i18n syncinfo uri layout/default/layout_helper porter".split(" "),function(){var ra=Registry.prepare(),r=Registry.get("crcrc").cr,h=Registry.get("crcrc").crc,ka=Registry.get("layout/default/tabview"),m=Registry.get("layout/default/htmlutil"),la=Registry.get("statistics"),ma=Registry.get("syncinfo"),q=Registry.get("curtain"),f=Registry.get("i18n"),u=Registry.get("helper"),sa=Registry.get("uri"),
G=Registry.get("porter"),aa=Registry.get("layout"),ba=Registry.get("layout/default/layout_helper"),I=ba.images,Q=$.Deferred;aa.render(function(){ba.addStyle();ba.addFont();var U=!1,v={},E=[],ca="0.0.0",M={},na={},J=[],N=!0,w={},F=function(a,b){if(w[a]&&w[a][b])return w[a][b].apply(this,Array.prototype.slice.call(arguments,2));console.log("option: WARN: unable to find callback '"+b+"' for id '"+a+"'")},O,oa=function(){O=u.getUrlArgs(!0)};window.onhashchange=oa;oa();(function(){E.push(function(){v.statistics_enabled&&
(la.init(ra.SELF.ID),window.onerror=function(a,b,c){la.tE(a,ca+" opt@"+b,c)})})})();var pa=function(){for(;E.length;){var a=E[0];E=E.slice(1);a()}},aa=function(a){var b=r("input",a.name,a.id,"Save");b.inserted||(b.type="button",b.section=a,b.value=f.getMessage("Save"),b.addEventListener("click",function(){var a=Array.prototype.slice.call(this.section.getElementsByTagName("textarea")),b=function(b){b.each(function(b,d){a.push(d)})};b($("#"+this.section.id).find("input"));b($("#"+this.section.id).find("select"));
for(b=0;b<a.length;b++){var e=null,g=a[b],f=g.key;if("textarea"==g.tagName.toLowerCase())if(g.array)for(var g=g.value.split("\n"),e=[],l=0;l<g.length;l++)g[l]&&""!=g[l].trim()&&e.push(g[l]);else e=g.value;else"checkbox"==g.getAttribute("type")?e=g.checked:"select"==g.getAttribute("type")?(e=0,0<=g.selectedIndex&&g.selectedIndex<g.options.length&&(e=g.selectedIndex),e=g[e]?g[e].value:g.options[0].value):"button"!=g.getAttribute("type")&&(e=g.value);f&&da(f,e)}},!1));return b},ua=function(a){var b,
c,d,e,g;e=r("tbody",a.name,a.id,"body");g=r("thead",a.name,a.id,"head");if(a.scriptTab){var n=ta(a);b=h("table","scripttable",a.name,a.id,"main");var l=h("th","script_sel",a.name,a.id,"thead_sel");l.appendChild(n.selAllm);d=h("tr","multiselect settingstr filler",a.name,a.id,"filler_multi");var k=h("th","",a.name,a.id,"thead_multi");k.setAttribute("colspan","9");k.appendChild(n.actionBox);$(d).hide();d.setAttribute("name","multiselectcol");d.appendChild(l);d.appendChild(k);l=h("th","script_sel",a.name,
a.id,"thead_sel");l.appendChild(n.selAll);n=h("th","",a.name,a.id,"thead_en");k=h("th","settingsth",a.name,a.id,"thead_name");k.textContent=f.getMessage("Name");var s=h("th","settingsth",a.name,a.id,"thead_ver");s.textContent=f.getMessage("Version");var p=h("th","settingsth",a.name,a.id,"thead_type");p.textContent=f.getMessage("Type");var m=h("th","settingsth",a.name,a.id,"thead_sync");m.textContent="";var x=h("th","settingsth",a.name,a.id,"thead_sites");x.width="25%";x.textContent=f.getMessage("Sites");
var z=h("th","settingsth",a.name,a.id,"thead_features");z.textContent=f.getMessage("Features");var V=h("th","settingsth",a.name,a.id,"thead_edit");V.textContent=f.getMessage("Homepage");var K=h("th","settingsth",a.name,a.id,"thead_updated");K.textContent=f.getMessage("Last_Updated");var t=h("th","settingsth",a.name,a.id,"thead_sort");t.textContent=f.getMessage("Sort");var y=h("th","settingsth",a.name,a.id,"thead_del");y.textContent=f.getMessage("Actions");E.push(function(){v.sync_enabled&&(m.textContent=
f.getMessage("Imported"))});c=h("tr","settingstr filler",a.name,a.id,"filler");c.setAttribute("style","height: 36px;");c.setAttribute("name","multiselectcol_hide");u.each([l,n,k,s,p,m,x,z,V,K,t,y],function(a,b){c.appendChild(a)});g.appendChild(d);g.appendChild(c);g.setAttribute("name","multiselectrow");c.inserted||(w.multiselect.checkScroll=function(a){a=$(g).is(":visible")&&$(d).is(":visible")&&$(window).scrollTop()>$(g).offset().top;$(d).toggleClass("multi_scrolling",a)},$(window).scroll(w.multiselect.checkScroll))}else b=
h("table","settingstable",a.name,a.id,"main"),c=h("tr","settingstr filler",a.name,a.id,"filler"),e.appendChild(c);b.appendChild(g);b.appendChild(e);return{table:b,head:g,body:e}},ya=function(a,b,c,d){var e=[],g=function(){[0,1].forEach(function(){e.unshift(null)})};if(b.divider)return null;b.image&&(b.imageURL=I.get(b.image));if(b.checkbox){d=function(){var a=!0;this.warning&&(a=ea(this.warning),a||(this.checked=!this.checked));a&&(da(this.key,this.checked,this.reload),this.reload&&window.location.reload())};
c&&c.need_save&&(d=l=null);var f=m.createCheckbox(b.name,b,d);e.push(f.elem)}else if(b.button)f=m.createButton(b.name,b,function(){var a=!0;this.warning&&(a=ea(this.warning));a&&va(this.key,!0,this.ignore,this.reload)}),e.push(f);else if(b.input)f=m.createTextarea(b.name,b),e.push({element:f.elem,validation:f.label}),c&&(c.need_save=!0);else if(b.text)f=m.createInput(b.name,b),e.push(f.elem),c&&(c.need_save=!0);else if(b.password)f=m.createPassword(b.name,b),e.push(f.elem),c&&(c.need_save=!0);else if(b.select){var l=
function(){var a=!0;this.warning&&(a=ea(this.warning),a||(this.value=this.oldvalue));a&&(da(this.key,this.value,this.reload),this.reload&&window.location.reload())};c&&c.need_save&&(l=null,b.enabler&&(l=function(){var a=document.getElementsByName("enabled_by_"+this.key),b=(this.selectedIndex<this.options.length?this.options[this.selectedIndex]:this.options[0]).getAttribute("enables"),c=b?JSON.parse(b):{};u.each(a,function(a){void 0===c[a.key]||1==c[a.key]?a.setAttribute("style",u.staticVars.visible):
a.setAttribute("style",u.staticVars.invisible)})}));f=m.createDropDown(b.name,b,b.select,l);e.push(f.elem);a&&b.enabler&&function(){var a=l,b=f;E.push(function(){a.apply(b.select,[])})}()}else if(b.url)d=r("a",b.name,b.id),d.href="#",d.url=b.url,d.newtab=b.newtab,d.inserted||(l=function(){fa(this.url,this.newtab)},d.addEventListener("click",l)),d.textContent=b.name,e.push(d),g();else if(b.main_menu_item){g=r("span",b.name,b.id);g.textContent=b.name;c=ua(b);var k=r("div",b.name,b.id,"tab_content");
k.appendChild(c.table);g=d.appendTab(b.id,g,k);!U&&b.selected_default&&g.select();W(c.body,b.items,null,d)}else if(b.sub_menu_item)c=h("div","section",b.name,b.id),g=h("div","section_head",b.name,b.id,"head"),k=h("table","section_content",b.name,b.id,"content"),g.textContent=b.name,c.appendChild(g),b.desc&&m.setHelp(b.desc,g,g,b),c.appendChild(k),W(k,b.items,b,d),b.need_save&&k.appendChild(aa(k)),e.push(c);else if(b.userscript||b.nativeScript||b.user_agent){if(a.setAttribute("class","scripttr"),b.nnew&&
a.setAttribute("style","display: none;"),e=wa(b,a,d),b.userscript||b.user_agent)J[b.uuid]={sort:{dom:a,pos:b.position},script:b}}else b.version?(ca=b.value,h("div","version","version","version").textContent="v"+ca+" by Jan Biniok"):b.globalhint?(d=h("span","global_hint","globalhint","globalhint"),g=r("span","globalhintt","globalhintt"),c=r("span","globalhintt","globalhintt"),c.textContent=b.value,b.description&&(c.title=b.description),c.url=b.info_url,b.image&&g.appendChild(m.createImage(b.imageURL,
"globalhint","icon")),b.info_url&&!c.inserted&&(l=function(){fa(this.url,!0)},c.addEventListener("click",l)),g.appendChild(c),d.appendChild(g),document.body.appendChild(d)):(d=r("span","",b.uuid||b.id+b.name),d.textContent=b.name,e.push(d),g());e.forEach(function(a){if(a){(a.element||a).setAttribute("style",b.level>v.configMode?u.staticVars.invisible:u.staticVars.visible);if(b.hint){var c=r("span","",b.uuid||b.id+b.name,"hint");c.textContent=b.hint;a.appendChild(c)}b.validation&&xa(b,a.validation||
a.element||a);b.width&&a.setAttribute("class","width-172-"+b.width)}});a&&(k=a.getAttribute("class"),g=" hide",!1===b.visible?k=(k||"")+g:k&&(k=k.replace(g,"")),a.setAttribute("class",k));return e},W=function(a,b,c,d){for(var e in b){var g=b[e],f=a?r("tr","",g.uuid||g.id+g.name,"pi"):null,l=ya(f,g,c,d);l&&l.length&&(a.appendChild(f),u.each(l,function(a,b){var c=a,d="";"Object"===u.toType(a)&&(c=a.element,d=a.style);d=h("td",d,"",g.uuid||g.id+g.name,b);a&&d.appendChild(c);f.appendChild(d)}))}},ea=
function(a){if(a.once){if(na[a.msg])return!0;na[a.msg]=!0}var b=confirm(a.msg),c={};b&&a.ok?c=a.ok:!b&&a.cancel&&(c=a.cancel);if(a.ok||a.cancel)b=!0;c.url&&sendMessage({method:"newTab",url:c.url},function(a){});return b},xa=function(a,b){var c;a.validation&&(a.validation.url&&(c=function(){fa(this.url,!0)}),a.validation.image&&(a.validation.imageURL=I.get(a.validation.image)),c=m.createAfterIcon(a,c))&&(c.url=a.validation?a.validation.url:void 0,b.appendChild(c))},za=function(a){return{source:a.code,
meta:{name:a.name,uuid:a.uuid,modified:a.lastModified,file_url:a.file_url&&a.file_url.trim()?a.file_url:void 0},storage:a.storage,options:a.options,settings:{enabled:a.enabled,position:a.position}}},X=function(a,b){var c=Q(),d=[];Aa(a,b).done(function(a){a.scripts.forEach(function(a){!a.uuid||!a.userscript&&!a.user_agent||a.system||a.nnew||(a.code&&""!=a.code.trim()?d.push(za(a)):console.log("options: Strange script: "+a.name))});c.resolve(d)}).fail(function(){c.reject()});return c.promise()},Ba=
function(a){var b=r("div","utils","utils","tab_util_h");b.textContent=f.getMessage("Utilities");var c=r("div","utils","utils","tab_util");a.appendTab("util_tabutils",b,c).show();a=h("div","tv_util","utils","utils","tab_util_cont");var d=function(a){var b=Q(),c=new FileReader;c.onload=function(a){b.resolve(a.target.result)};c.readAsText(a);return b.promise()},e=m.createButton("utils","utils_i_ta",f.getMessage("Import"),function(){G.json.read(p.value).then(function(a){return ga(a,{reload:!0})}).done(function(a){a.err&&
u.alert(a.err)}).fail(function(){u.alert(f.getMessage("Unable_to_parse_this_"))})}),g=m.createFileSelect(f.getMessage("Import"),{name:"zip",id:"utils"},function(a){q.wait();for(var b=0,c;c=a[b];b++)G.zip.read(c).progress(function(a){q.wait(Math.floor(a.item/a.of*100)+"%")}).then(function(a){return ga({scripts:u.map(a,function(a){var b=a.meta||{},c=a.settings||{};return{source:a.source,name:b.name,uuid:b.uuid,file_url:b.file_url,options:a.options,storage:a.storage,lastModified:b.modified,enabled:c.enabled,
position:c.position}})},{reload:!0})}).done(function(a){a.err&&u.alert(a.err)}).fail(function(){u.alert(f.getMessage("Unable_to_parse_this_"))}).always(q.hide)}),b=m.createFileSelect(f.getMessage("Import"),{name:"file",id:"utils"},function(a){for(var b=0,c;c=a[b];b++)d(c).then(function(a){return G.json.read(a)}).then(function(a){return ga(a,{reload:!0})}).done(function(a){a.err&&u.alert(a.err)}).fail(function(){u.alert(f.getMessage("Unable_to_parse_this_"))})}),n=m.createButton("utils","utils_e_ta",
f.getMessage("Export"),function(){X(null,{storage:N}).then(function(a){return G.json.create(a)}).done(function(a){p.value=a})}),l=m.createButton("utils","utils_e_file",f.getMessage("Export"),function(){X(null,{storage:N}).then(function(a){return G.json.download(a)})}),k=m.createButton("utils","utils_e_zip",f.getMessage("Export"),function(){X(null,{storage:N}).then(function(a){q.wait();return G.zip.download(a).progress(function(a){q.wait(Math.floor(a.item/a.of*100)+"%")})}).always(function(){q.hide()})}),
s=m.createCheckbox(f.getMessage("Include_script_storage"),{id:"utils_e_data_zip",enabled:"true"},function(){N=this.checked});s.elem.setAttribute("style","padding-left: 15px; display: inline");s.input.checked=N;var p=h("textarea","importta","utils","utils","ta"),H=h("div","section","utils","utils","ta"),x=h("div","section_head","utils","utils","head_ta"),z=h("div","section_content","utils","utils","content_ta");x.textContent=f.getMessage("General");z.appendChild(s.elem);H.appendChild(x);H.appendChild(z);
s=h("div","section","utils","utils","ta");x=h("div","section_head","utils","utils","head_ta");z=h("div","section_content","utils","utils","content_ta");x.textContent=f.getMessage("TextArea");z.appendChild(n);z.appendChild(e);z.appendChild(p);s.appendChild(x);s.appendChild(z);e=h("div","section","utils","utils","sb");n=h("div","section_head","utils","utils","head_sb");x=h("div","section_content","utils","utils","content_sb");n.textContent=f.getMessage("Zip");e.appendChild(n);e.appendChild(x);x.appendChild(k);
x.appendChild(g.elem);g=h("div","section","utils","utils","fi");k=h("div","section_head","utils","utils","head_fi");n=h("div","section_content","utils","utils","content_fi");k.textContent=f.getMessage("File");g.appendChild(k);g.appendChild(n);n.appendChild(l);n.appendChild(b.elem);a.appendChild(H);a.appendChild(e);a.appendChild(g);a.appendChild(s);u.each([s],function(a){var b=a.getAttribute("class"),b=50>v.configMode?b+" hide":b.replace(" hide","");a.setAttribute("class",b)});c.appendChild(a)},P=
function(a,b,c){var d=b.item,e=d.uuid+b.id,g=(c?"orig_":"use_")+b.id,n=function(a){return"select_"+u.createUniqueId(a,d.uuid)+"_sel1"},l=h("div","cludes",a,e,"cb1");if(document.getElementById(n(g)))return{elem:l};var k=r("span",d.name,e,"cb2");if(c){var s="merge_"+b.id;a=m.createCheckbox(a,{id:s,uuid:d.uuid,enabled:d.options&&d.options.override&&d.options.override[s]?!0:!1},function(){"checkbox"==this.type&&L(this.uuid,this.key,!this.oldvalue)});k.appendChild(a.elem)}else k.textContent=a;a=d.options&&
d.options.override&&d.options.override[g]?d.options.override[g]:[];var p=h("select","cludes",g,d.uuid,"sel1");p.setAttribute("size","6");p.setAttribute("multiple","true");for(g=0;g<a.length;g++)s=document.createElement("option"),s.value=s.text=a[g],p.appendChild(s);l.appendChild(k);d.desc&&m.setHelp(d.desc,l,k,d);l.appendChild(p);var H=function(a){var b=[];a=a&&a.options;for(var c=0,d=a.length;c<d;c++)a[c].selected&&b.push(a[c]);return b};a=function(){var a=n("use_"+("excludes"==b.id?"includes":"excludes")),
c=document.getElementById(a),a=H(p),d=!1,e="matches"==b.id;a.forEach(function(a){var b=e?"/"+sa.getRegExpFromMatch(a.value)+"/":a.value;a&&!c.querySelector('option[value="'+b+'"]')&&(a=a.cloneNode(!0),e&&(a.value=b,a.textContent=b),c.appendChild(a),d=!0)});d&&z()};var s=function(){var a=prompt(f.getMessage("Enter_the_new_rule"));if(a){var b=document.createElement("option");b.value=b.text=a.trim();p.appendChild(b);z()}},g=function(){var a=p.options[p.selectedIndex];if(a){var b=prompt(f.getMessage("Enter_the_new_rule"),
a.value);b&&(a.value=a.text=b.trim(),z())}},k=function(){var a=!1;H(p).forEach(function(b){b&&(b.parentNode.removeChild(b),a=!0)});a&&z()},x=function(a){for(var b=[],c=0;c<a.options.length;c++)b.push(a.options[c].value);return b},z=function(){var a={includes:x(document.getElementById(n("use_includes"))),matches:x(document.getElementById(n("use_matches"))),excludes:x(document.getElementById(n("use_excludes")))};Ca(d.uuid,a);return!0};c?(e=r("button",d.name,e,"btn1"),e.innerHTML=f.getMessage("Add_as_0clude0",
c),e.addEventListener("click",a,!1)):(c=r("button",d.name,e,"btn2"),c.innerHTML=f.getMessage("Add")+"...",c.addEventListener("click",s,!1),l.appendChild(c),c=r("button",d.name,e,"btn3"),c.innerHTML=f.getMessage("Edit")+"...",c.addEventListener("click",g,!1),l.appendChild(c),e=r("button",d.name,e,"btn4"),e.innerHTML=f.getMessage("Remove"),e.addEventListener("click",k,!1));l.appendChild(e);return{elem:l}},Da=function(){var a=function(b,c){return b.tagName==c?b:b.parentNode?a(b.parentNode,c):null},b=
null,c=[],d=0,e;for(e in J){var g=J[e].sort;delete J[e].sort;if(g){var f=a(g.dom,"TR");if(f){var l=a(f,"TBODY");b?l&&b!=l&&console.warn("options: different parents?!?!"):b=l;d++;c.push({tr:f,position:g.pos?g.pos:1E3+d});f.inserted=!1;f.parentNode&&f.parentNode.removeChild(f)}else console.log("options: unable to sort script at pos "+g.pos)}else console.warn("options: something went wrong!",e)}c=function(a){a.sort(function(a,b){return a.position-b.position});return a}(c);for(e=0;e<d;e++)b.appendChild(c[e].tr)},
Ha=function(a,b,c,d,e){var g=h("div","",b.name,b.uuid,"script_tab_head");c=g.inserted;var f=h("div","heading",b.uuid,"heading"),l=h("img","nameNicon64",b.uuid,"heading_icon"),k=b.icon64?b.icon64:b.icon;l.src=k;var s=h("div","nameNname64",b.uuid,"heading_name");s.textContent=b.name;k&&f.appendChild(l);f.appendChild(s);l=h("div","author",b.uuid,"author");b.author?l.textContent="by "+b.author:b.copyright&&(l.innerHTML="&copy; ",l.textContent+=b.copyright);var k=h("table","noborder p100100",b.uuid,"table"),
s=h("tr","script_tab_head",b.uuid,"tr1"),p=h("tr","details",b.uuid,"tr2"),m=h("td","",b.uuid,"td1"),x=h("td","",b.uuid,"td2");f.appendChild(l);g.appendChild(f);m.appendChild(g);s.appendChild(m);p.appendChild(x);k.appendChild(s);k.appendChild(p);d.appendChild(k);d=ka.create("_details"+u.createUniqueId(b.name,b.uuid),x,{tv:"tv tv_alt",tv_table:"tv_table tv_table_alt",tr_tabs:"tr_tabs tr_tabs_alt",tr_content:"tr_content tr_content_alt",td_content:"td_content td_content_alt",td_tabs:"td_tabs td_tabs_alt",
tv_tabs_align:"tv_tabs_align tv_tabs_align_alt",tv_tabs_fill:"tv_tabs_fill tv_tabs_fill_alt",tv_tabs_table:"tv_tabs_table tv_tabs_table_alt",tv_contents:"tv_contents tv_contents_alt",tv_tab_selected:"tv_tab tv_selected tv_tab_alt tv_selected_alt",tv_tab_close:"",tv_tab:"tv_tab tv_tab_alt",tv_content:"tv_content tv_content_alt"});var r=Ea(b,d,e),w=b.nnew||b.system?{}:Fa(b,d),q=b.nnew||b.system||!b.requires.length&&!b.resources.length?{}:Ga(b,d);if(c)return M["tab"+b.uuid];var t=function(b){var c=!1;
if("keydown"==b.type&&(27==b.keyCode&&"windows"==v.editor_keyMap&&(a.isSelected()&&window.setTimeout(e,1),c=!0),c))return b.stopPropagation(),b.preventDefault(),!1};d={onShow:function(){u.each([w,r,q],function(a){if(a.onShow)a.onShow()});window.addEventListener("keydown",t,!0)},onClose:function(a){var b;u.each([w,r,q],function(c){if(c.onClose&&c.onClose(a))return b=!0,!1});b||window.removeEventListener("keydown",t,!0);return b},afterSelect:function(){u.each([w,r,q],function(a){a.afterSelect&&a.afterSelect()})}};
return M["tab"+b.uuid]=d},Fa=function(a,b){var c=r("div",a.name,a.uuid,"script_setting_h"),d=r("div",a.name,a.uuid,"script_settings_c");c.textContent=f.getMessage("Settings");var e=function(){if("checkbox"==this.type||"button"==this.type)L(this.uuid,this.key,!this.oldvalue);else if("text"==this.type||"textarea"==this.type||"select-one"==this.type){var a=this.value;if("native"===this.valtype)if("undefined"===a)a=void 0;else if("null"===a)a=null;else try{a=JSON.parse(a)}catch(b){}L(this.uuid,this.key,
a)}},g=m.createPosition(f.getMessage("Position_")+": ",{id:"position",uuid:a.uuid,name:a.name,pos:a.position,posof:a.positionof},e),n=m.createDropDown(f.getMessage("Run_at"),{id:"run_at",uuid:a.uuid,name:a.name,value:a.run_at},[{name:"document-start",value:"document-start"},{name:"document-body",value:"document-body"},{name:"document-end",value:"document-end"},{name:f.getMessage("Default"),value:null}],e),l=m.createDropDown(f.getMessage("No_frames"),{id:"noframes",uuid:a.uuid,name:a.name,value:a.noframes},
[{name:f.getMessage("Yes"),value:!0},{name:f.getMessage("No"),value:!1},{name:f.getMessage("Default"),value:null}],e),k=P(f.getMessage("Original_includes"),{id:"includes",item:a},f.getMessage("User_excludes")),s=P(f.getMessage("Original_matches"),{id:"matches",item:a},f.getMessage("User_excludes")),p=P(f.getMessage("Original_excludes"),{id:"excludes",item:a},f.getMessage("User_includes")),H=h("div","clear",a.name,a.uuid,"clear"),x=P(f.getMessage("User_includes"),{id:"includes",item:a}),z=P(f.getMessage("User_matches"),
{id:"matches",item:a}),w=P(f.getMessage("User_excludes"),{id:"excludes",item:a}),q=m.createCheckbox(f.getMessage("Apply_compatibility_options_to_required_script_too"),{id:"compatopts_for_requires",uuid:a.uuid,name:a.name,enabled:a.compatopts_for_requires},e),t=m.createCheckbox(f.getMessage("Fix_wrappedJSObject_property_access"),{id:"compat_wrappedjsobject",uuid:a.uuid,name:a.name,enabled:a.compat_wrappedjsobject},e),u=m.createCheckbox(f.getMessage("Convert_CDATA_sections_into_a_chrome_compatible_format"),
{id:"compat_metadata",uuid:a.uuid,name:a.name,enabled:a.compat_metadata},e),v=m.createCheckbox(f.getMessage("Replace_for_each_statements"),{id:"compat_foreach",uuid:a.uuid,name:a.name,enabled:a.compat_foreach},e),C=m.createCheckbox(f.getMessage("Fix_for_var_in_statements"),{id:"compat_forvarin",uuid:a.uuid,name:a.name,enabled:a.compat_forvarin},e),D=m.createCheckbox(f.getMessage("Convert_Array_Assignements"),{id:"compat_arrayleft",uuid:a.uuid,name:a.name,enabled:a.compat_arrayleft},e),B=m.createCheckbox(f.getMessage("Add_toSource_function_to_Object_Prototype"),
{id:"compat_prototypes",uuid:a.uuid,name:a.name,enabled:a.compat_prototypes},e),q=[q,t,u,v,C,D,B],t=h("div","section",a.name,a.uuid,"ta_opt"),v=h("div","section_head",a.name,a.uuid,"head_ta_opt"),u=h("div","section_content",a.name,a.uuid,"content_ta_opt");v.textContent=f.getMessage("Settings");t.appendChild(v);t.appendChild(u);v=h("div","section",a.name,a.uuid,"ta_cludes");C=h("div","section_head",a.name,a.uuid,"head_ta_cludes");B=h("div","section_content",a.name,a.uuid,"content_ta_cludes");C.textContent=
f.getMessage("Includes_Excludes");v.appendChild(C);v.appendChild(B);var C=h("div","section",a.name,a.uuid,"ta_compat"),Y=h("div","section_head",a.name,a.uuid,"head_ta_compat"),D=h("div","section_content",a.name,a.uuid,"content_ta_compat");Y.textContent=f.getMessage("GM_compat_options_");C.appendChild(Y);C.appendChild(D);u.appendChild(g);a.user_agent||u.appendChild(n.elem);u.appendChild(l.elem);B.appendChild(k.elem);B.appendChild(s.elem);B.appendChild(p.elem);B.appendChild(H);B.appendChild(x.elem);
B.appendChild(z.elem);B.appendChild(w.elem);g=r("div",a.name,a.uuid,"tab_content_settings");g.appendChild(t);g.appendChild(v);if(!a.user_agent){for(n=0;n<q.length;n++)D.appendChild(q[n].elem);if(a.awareOfChrome)for(var R in q)q[R].input.setAttribute("disabled","disabled"),q[R].elem.setAttribute("title",f.getMessage("This_script_runs_in_Chrome_mode"));g.appendChild(C)}var ha=m.createTextarea(null,{name:a.name,uuid:a.uuid,id:"comment",value:a.options.comment});ha.elem.setAttribute("class","script_setting_wrapper");
R=r("div",a.name,a.uuid,"save");n=m.createButton(a.name,a.uuid,f.getMessage("Save"),function(){e.apply(ha.textarea,[])});R.appendChild(n);n=h("div","section",a.name,a.uuid,"ta_comment");l=h("div","section_head",a.name,a.uuid,"head_ta_comment");k=h("div","section_content",a.name,a.uuid,"content_ta_comment");l.textContent=f.getMessage("Comment");n.appendChild(l);n.appendChild(k);k.appendChild(ha.elem);k.appendChild(R);g.appendChild(n);d.appendChild(g);b.appendTab("script_settings_tab"+a.uuid,c,d);return{}},
qa=function(a,b){var c=h("table","script_desc",a.name,a.uuid,"outer_req2html"),d=0,e=[{label:f.getMessage("URL"),prop:"url"},{label:f.getMessage("Size"),prop:"data",fn:function(a){return a&&a.content?a.content.length+" Bytes":"?"}},{label:f.getMessage("Last_updated"),prop:"ts",fn:function(a){return a?(new Date(a)).toString():"?"}}];a[b].forEach(function(g){var k=d+b;e.forEach(function(b){var d=h("tr","external_desc",a.uuid,b.prop,"tr"+k),e=h("td","external_desc",a.uuid,b.prop,"td1"+k),f=h("td","",
a.uuid,b.prop,"td2"+k);e.textContent=b.label;f.textContent=(b.fn?b.fn:function(a){return a})(g[b.prop]);d.appendChild(e);d.appendChild(f);c.appendChild(d)});var n=h("tr","external_desc_buttons",a.uuid,g.url,"tr"+k),p=h("td","",a.uuid,"buttons","td"+k);n.appendChild(p);c.appendChild(n);if(g.ts){var n=r("div",a.name,a.uuid,"delete_external"+k),q=m.createButton(a.uuid,"delete_external"+u.createUniqueId(g.url)+k,f.getMessage("Delete"),function(){Ia(a.uuid,g.url);q.parentNode&&q.parentNode.removeChild(q)});
n.appendChild(q);p.appendChild(n)}d++});if(!d){var g=h("tr","script_desc",a.uuid,d,"tr"),n=h("td","script_desc",a.uuid,d,"td1");n.textContent=f.getMessage("No_entry_found");g.appendChild(n);c.appendChild(g)}return c},Ga=function(a,b){var c=r("div","",a.uuid,"script_external_h");c.textContent=f.getMessage("Externals");var d=r("div","",a.uuid,"script_externals_c"),e=h("div","section",a.name,a.uuid,"ta_requires"),g=h("div","section_head",a.name,a.uuid,"head_ta_requires"),n=h("div","section_content",
a.name,a.uuid,"content_ta_requires");g.textContent=f.getMessage("Requires");e.appendChild(g);e.appendChild(n);n.appendChild(qa(a,"requires"));var g=h("div","section",a.name,a.uuid,"ta_resources"),n=h("div","section_head",a.name,a.uuid,"head_ta_resources"),l=h("div","section_content",a.name,a.uuid,"content_ta_resources");n.textContent=f.getMessage("Resources");g.appendChild(n);g.appendChild(l);l.appendChild(qa(a,"resources"));n=r("div","",a.uuid,"tab_content_settings");n.appendChild(e);n.appendChild(g);
d.appendChild(n);b.appendTab("script_externals_tab"+a.uuid,c,d);return{}},Ea=function(a,b,c){var d=h("tr","editor_container p100100",a.name,a.uuid,"container");if(!a.nnew&&F(a.uuid,"lastI"))return[];a.nnew&&(a.code=a.code.replace("<$URL$>",O.url||"http://*/*"));var e=r("div",a.name,a.uuid,"script_editor_h"),g=e.inserted;e.textContent=f.getMessage("Editor");var n=r("div",a.name,a.uuid,"script_editor_c"),l=h("tr","editormenubar",a.name,a.uuid,"container_menu"),k=h("table","editor_container_o p100100 noborder",
a.name,a.uuid,"container_o");k.appendChild(l);k.appendChild(d);n.appendChild(k);var s=function(b){F(a.uuid,"saveEm")},p=function(a,b){c&&c(b)},k=m.createImageButton(a.uuid,"save_to_disk",f.getMessage("Save_to_disk"),chrome.extension.getURL("/layout/default/images/harddrive2.png"),function(b){b=d.editor&&v.editor_enabled?d.editor.mirror.getValue():y.value;q.wait();G.plain.download(a.name,b).always(function(){q.hide()})}),H=m.createImageButton(a.uuid,"save",f.getMessage("Save"),chrome.extension.getURL("/layout/default/images/filesave.png"),
s),x=m.createImageButton(a.uuid,"cancel",f.getMessage("Editor_reset"),chrome.extension.getURL("/layout/default/images/editor_cancel.png"),function(){confirm(f.getMessage("Really_reset_all_changes_"))&&(d.editor&&v.editor_enabled?d.editor.mirror.setValue(a.code):y.textContent=a.code)}),z=m.createImageButton(a.uuid,"reset",f.getMessage("Full_reset"),chrome.extension.getURL("/layout/default/images/script_cancel.png"),function(){ia(a.uuid,null,{old_url:t.input?t.input.oldvalue:"",new_url:t.input?t.input.value:
"",clean:!0,reload:!0}).done(function(a){a.cleaned&&p(null,!0)});w[a.uuid].fullReset()}),V=m.createImageButton(a.uuid,"close_script",f.getMessage("Close"),chrome.extension.getURL("/layout/default/images/exit.png"),p),E=m.createImageButton(a.uuid,"lint_script",f.getMessage("Run_syntax_check"),chrome.extension.getURL("/layout/default/images/check.png"),function(){q.wait();window.setTimeout(function(){S.run(d.editor);q.hide()},1)}),t=m.createInput(f.getMessage("Update_URL_"),{id:"file_url",uuid:a.uuid,
name:a.name,value:a.file_url});t.input.setAttribute("class","updateurl_input");t.elem.setAttribute("class","updateurl");var y=h("textarea","editorta",a.name,a.uuid);y.setAttribute("wrap","off");var A=h("td","editor_outer",a.name,a.uuid,"edit"),C=h("div","editor_100 editor_border",a.name,a.uuid,"edit"),D=h("div","editormenu",a.name,a.uuid,"editormenu");A.appendChild(C);l.appendChild(D);l.appendChild(t.elem);d.inserted||(C.appendChild(y),d.appendChild(A));a.system||(w[a.uuid].saveEm=function(){var b=
!0;v.showFixedSrc&&!a.user_agent&&(b=confirm(f.getMessage("Do_you_really_want_to_store_fixed_code_",f.getMessage("Show_fixed_source"))));var c=d.editor&&v.editor_enabled?d.editor.mirror.getValue():y.value;b&&ia(a.uuid,c,{old_url:t.input?t.input.oldvalue:"",new_url:t.input?t.input.value:"",clean:!1,new_script:a.nnew,reload:!0,lastModified:w[a.uuid].saveEm_lastModified}).done(function(b){b.installed?a.nnew||b.renamed?p(null,!0):(d.editor.changed=!1,b.lastModified&&(a.lastModified=b.lastModified)):b.aborted||
(b.messages&&b.messages.errors&&b.messages.errors.length?u.alert(b.messages.errors.join("\n")):u.alert(f.getMessage("Unable_to_parse_this_")))});return b},D.appendChild(k),D.appendChild(H),D.appendChild(x));a.nnew||D.appendChild(z);D.appendChild(V);!a.system&&v.editor_enabled&&D.appendChild(E);b.appendTab("script_editor_tab"+a.uuid,e,n);if(g)return M["editor"+a.uuid];var B=function(){var b=!1;v.editor_enabled?d.editor&&(b|=d.editor.changed&&d.editor.mirror.historySize().undo):b=y.value!=a.code;return b},
Y=function(){v.editor_autoSave&&B()&&F(a.uuid,"saveEm")};b={afterSelect:function(){d.editor&&d.editor.refresh()},onShow:function(){var b=n.getElementsByTagName("textarea");w[a.uuid].lastI=function(){return a};if(b.length&&!d.editor){var b=b[0],c=function(){d.editor&&(d.editor.changed=!0)};if(v.editor_enabled){var e=b.parentNode,g={search:f.getMessage("Search"),replace:f.getMessage("Replace"),jump:f.getMessage("Jump_to_line"),macro:f.getMessage("Insert_constructor"),reindentall:f.getMessage("Auto_Indent_all")};
e.removeChild(b);d.editor=new MirrorFrame(e,{value:a.code,indentUnit:Number(v.editor_indentUnit),indentWithTabs:"tabs"==v.editor_indentWithTabs,smartIndent:"classic"!=v.editor_tabMode,enterMode:v.editor_enterMode,electricChars:"true"==v.editor_electricChars.toString(),lineNumbers:!0,extraKeys:{Enter:"newlineAndIndentContinueComment"},keyMap:v.editor_keyMap,gutters:["gutter","CodeMirror-linenumbers"],matchBrackets:!0},{save:s,close:p,find:function(a){d.editor.searchText=d.editor.search()},findNext:function(a){d.editor.searchText=
d.editor.search(d.editor.searchText)},findPrev:function(a){d.editor.searchText=d.editor.search(d.editor.searchText,!0)}},{change:c,blur:Y},g)}else b.value=a.code}},onClose:function(b){var c=function(){d.editor=null;delete w[a.uuid].lastI};if(!b&&B())return(b=confirm(f.getMessage("There_are_unsaved_changed_")))&&c(),!b;c();return!1}};return M["editor"+a.uuid]=b},wa=function(a,b,c){w[a.uuid]||(w[a.uuid]={});var d,e,g=a.icon&&!a.nativeScript,n=["script_name"];a.nativeScript||n.push("clickable");a.blacklisted&&
n.push("crossedout");var l=h("span",n.join(" "),"",a.uuid,"sname"),k=h("img","nameNicon16 icon16","",a.uuid,"sname_img"),s=h("span",g?"nameNname16":"","",a.uuid,"sname_name"),p=a.homepage?a.homepage:a.namespace&&0==a.namespace.search("http://")?a.namespace:null;s.textContent=35<a.name.length?a.name.substr(0,35)+"...":a.name;n=r("span","",a.uuid,"sversion");n.textContent=a.version?a.version:"";g&&(k.src=a.icon,l.appendChild(k));var g=[],q=function(){d&&(d.remove(),d=null);delete M["tab"+a.uuid];delete M["editor"+
a.uuid]},x=function(){window.setTimeout(function(){for(var d in J){var e=J[d].script;if(e.uuid==a.uuid){W(b,[e],null,c);break}}pa()},1)},z=function(b){a.uuid&&u.getUrlArgs(!0).open==a.uuid&&(window.location.hash="");e&&e.onClose&&e.onClose(b)||(q(),l.parentNode&&l.parentNode.removeChild(l),b||x())},A=function(){e&&e.afterSelect&&e.afterSelect()},K=function(g,l){if(!d){var k=null;a.nnew?(k=h("div","head_icon","",a.uuid,"details_h"),k.appendChild(m.createImage(a.imageURL,"",a.uuid,"new_script_head"))):
k=h("div","","",a.uuid,"details_h");var n=r("div","",a.uuid,"details_c");d=c.insertTab(null,"details_"+a.uuid,k,n,A,a.nnew?null:z);a.nnew||d.setHeading(f.getMessage("Edit")+" - "+(25<a.name.length?a.name.substr(0,25)+"...":a.name));e=Ha(d,a,b,n,z)}if(e&&e.onShow)e.onShow();d.show();g&&1==g.button||l||d.select();s.setAttribute("open","true");!a.nnew&&a.uuid&&(window.location.hash="open="+a.uuid)};"true"==s.getAttribute("open")&&K(null,!0);k=r("span","",a.uuid,"hp");if(p){var t=r("a","",a.uuid,"hp");
t.setAttribute("href",p);t.setAttribute("target","_blank");p=m.createImage(chrome.extension.getURL("/layout/default/images/home.png"),"",a.uuid,"hp","");t.appendChild(p);k.appendChild(t)}var p=function(a,b){var c=a.getTime(),d=b.getTime(),e=Math.abs(c-d),c=Math.round(e/6E4),d=Math.round(e/36E5),e=Math.round(e/864E5);return 60>=c?c+" min":48>=d?d+" h":e+" d"},y=r("span","",a.uuid,"last_updated"),t="";if(a.nativeScript||a.nnew||a.system)t="";else if(s.inserted||(y.addEventListener("click",function(){F(a.uuid,
"scriptUpdate")}),y.setAttribute("class","clickable"),y.title=f.getMessage("Check_for_Updates")),w[a.uuid].scriptUpdate=function(){var b=y.textContent;y.textContent="";y.appendChild(m.createImage("/layout/default/images/download.gif","down",a.uuid));Ja(a.uuid,function(c){y.textContent=b;c?(y.style.color="green",y.title=f.getMessage("There_is_an_update_for_0name0_avaiable_",a.name),q(),l.parentNode&&l.parentNode.removeChild(l),L(null,!1)):(y.style.color="red",y.title=f.getMessage("No_update_found__sry_"))})},
a.lastUpdated)try{t=p(new Date,new Date(a.lastUpdated))}catch(G){console.log("o: error calculating time "+G.message)}else t="?";y.textContent=t;var C=r("div","",a.uuid,"imported"),D="";E.push(function(){v.sync_enabled&&(D=a.nativeScript||a.nnew||a.system?"":a.sync&&a.sync.imported?!0===a.sync.imported||a.sync.imported==ma.types.ePASTEBIN?'<img src="http://pastebin.com/favicon.ico" class="icon16" title="pastebin.com"/>':a.sync.imported==ma.types.eCHROMESYNC?'<img src="http://www.google.com/images/icons/product/chrome-16.png" class="icon16" title="Google Sync"/>':
'<img src="/layout/default/images/update.png" class="icon16" />':'<img src="/layout/default/images/no.png" class="icon16" />',C.innerHTML=D,C=null)});a.origin&&(t=r("a","",a.uuid,"hp"),t.setAttribute("href",a.origin.url),t.setAttribute("target","_blank"),p=m.createImage(I.origin(a.origin.token),"",a.uuid,a.origin.token,""),t.appendChild(p),k.appendChild(t));w[a.uuid].saveEm_lastModified=a.lastModified;w[a.uuid].fullReset=function(){b.parentNode.removeChild(b)};w[a.uuid].reportAnIssue=function(b){Ka(a.uuid,
b)};w[a.uuid].deleteScript=function(c,d){if(a.nativeScript){var e=d||confirm(f.getMessage("Really_delete_0name0__",a.name));!0==e&&(ja(a.uuid,"installed","false"),b.parentNode.removeChild(b))}else e=d||confirm(f.getMessage("Really_delete_0name0__",a.name)),!0==e&&(ia(a.uuid,null,{reload:!d}),b.parentNode.removeChild(b))};p=[];if(a.nativeScript){w[a.uuid].importNativeScript=function(c,d){!0==(d||confirm(f.getMessage("Really_import_0name0__",a.name)))&&(ja(a.uuid,"imported","true"),b.parentNode.removeChild(b))};
var B=m.createImage(I.get("import"),"",a.uuid,"import",f.getMessage("Import"),function(){F(a.uuid,"importNativeScript")});m.addClass(B,"hidden");p.push(B);E.push(function(){v.native_import&&m.toggleClass(B,"hidden")})}a.nnew||a.system||(t=m.createImage(I.get("delete"),"",a.uuid,"delete",f.getMessage("Delete"),function(){F(a.uuid,"deleteScript")}),p.push(t));a.nnew||a.system||!a.origin||(t=m.createImage(I.get("flag"),"",a.uuid,"issue",f.getMessage("Report_this_as_spam_or_malicious"),function(){F(a.uuid,
"reportAnIssue","hoster")}),p.push(t));a.nnew||a.system||!a.supportURL||(t=m.createImage(I.get("bug"),"",a.uuid,"bug",f.getMessage("Report_a_bug"),function(){F(a.uuid,"reportAnIssue","author")}),p.push(t));l.inserted||a.nativeScript||l.addEventListener("click",K);l.appendChild(s);t=[a.name];a.description&&t.push(a.description);a.blacklisted&&(t=[f.getMessage("This_script_is_blacklisted_")]);l.title=t.join("\n\n").replace(/\"/,"");g.push(a.nnew||a.system?null:{element:La(a),style:"script_sel"});g.push(function(){var b=
a.blacklisted?"enabler_warning":a.enabled?"enabler_enabled":"enabler_disabled",c=a.blacklisted?f.getMessage("This_script_is_blacklisted_"):a.enabled?f.getMessage("Enabled"):f.getMessage("Disabled"),d=a.position,b=m.createEnabler(b,a.uuid,"enabled","enabled",c,function(){F(a.uuid,a.nativeScript?"switchNativeEnabled":"switchEnabled")},a.nativeScript?"":d);w[a.uuid].switchEnabled=function(b,c,d){void 0===c&&(c=!a.enabled);L(a.uuid,"enabled",c,d)};w[a.uuid].switchNativeEnabled=function(b,c,d){void 0===
c&&(c=!a.enabled);ja(a.uuid,"enabled",c,d)};return b}());g.push(l);g.push(n);g.push(Ma(a));g.push(C);g.push(Na(a));g.push(Oa(a));g.push(k);g.push(y);g.push(Pa(a));g.push(function(a,b){var c=r("span","",a.uuid,"wrap");b&&("Array"===u.toType(b)?u.each(b,function(a,b){c.appendChild(a)}):c.appendChild(b));return c}(a,p));for(n=g.length;10>n;n++)g.push(null);!U&&O.open&&a.uuid===O.open?E.push(K):a.nnew&&E.push(function(){K(null,!0)});return g},Ma=function(a){var b=r("span","",a.uuid,"pos_type",!0);if(a.nnew)return b;
a.user_agent?(a=m.createImage("images/user_agent.png","",a.uuid,"user_agent",f.getMessage("This_only_changes_the_user_agent_string")),b.appendChild(a)):a.nativeScript?(a=m.createImage(a.icon,"",a.uuid,"chrome_ext",f.getMessage("This_is_a_chrome_extension")),b.appendChild(a)):a.userscript&&(a=m.createImage("images/txt.png","",a.uuid,"user_agent",f.getMessage("This_is_a_userscript")),b.appendChild(a));return b},Oa=function(a){var b=r("span","",a.uuid,"pos_features",!0);if(a.nnew)return b;if(a.system){var c=
m.createImage(chrome.extension.getURL("/layout/default/images/lock.png"),"",a.uuid,"lock",f.getMessage("This_is_a_system_script"));b.appendChild(c)}if(a.awareOfChrome||a.nativeScript)c=m.createImage("http://www.google.com/images/icons/product/chrome-16.png","",a.uuid,"chrome_mode",f.getMessage("This_script_runs_in_Chrome_mode")),b.appendChild(c);if(a.nativeScript)return b;a.requires.length&&(c=m.createImage("/layout/default/images/script_download.png","",a.uuid,"requires",u.map(u.select(a.requires,
function(a){return a&&a.url}),function(a){return a.url}).join("\n")),b.appendChild(c));a.resources.length&&(c=m.createImage("/layout/default/images/resources.png","",a.uuid,"resources",u.map(u.select(a.resources,function(a){return a&&a.url}),function(a){return a.url}).join("\n")),b.appendChild(c));var c=!1,d={includes:!0,matches:!0},e;for(e in d)if(a[e]){for(d=0;d<a[e].length;d++)if(a[e][d]&&(-1!=a[e][d].search("https")||-1!=a[e][d].search(/^\*:\/\//))){c=m.createImage(chrome.extension.getURL("/layout/default/images/halfencrypted.png"),
"",a.uuid,"encrypt",f.getMessage("This_script_has_access_to_https_pages"));b.appendChild(c);c=!0;break}if(c)break}if(a.user_agent)return b;-1!=a.code.search("GM_xmlhttpRequest")&&(c=m.createImage(chrome.extension.getURL("/layout/default/images/web.png"),"",a.uuid,"web",f.getMessage("This_script_has_full_web_access")),b.appendChild(c));-1!=a.code.search("GM_setValue")&&(c=m.createImage(chrome.extension.getURL("/layout/default/images/db.png"),"",a.uuid,"db",f.getMessage("This_script_stores_data")),
b.appendChild(c));-1!=a.code.search("unsafeWindow")&&(c=m.createImage(chrome.extension.getURL("/layout/default/images/windowlist.png"),"",a.uuid,"unsafeWindow",f.getMessage("This_script_has_access_to_webpage_scripts")),b.appendChild(c));for(e in a.options)if(-1!=e.search("compat_")&&a.options[e]){c=m.createImage(chrome.extension.getURL("/layout/default/images/critical.png"),"",a.uuid,"crit",f.getMessage("One_or_more_compatibility_options_are_set"));b.appendChild(c);break}return b},Qa=function(){var a=
null,b=null,c=null,d=0,e=0,g=function(b){var d=c.x+b.pageX;a.style.top=c.y+b.pageY+"px";a.style.left=d+"px"},f=function(c){if(a){var f=null;for(g(c);f!=e;){var f=e,k=b.previousSibling,h=b.nextSibling,n=b.parentNode,m=l(b);c.pageY>m.y+d&&h?(n.removeChild(h),n.insertBefore(h,b),e++):c.pageY<m.y&&1<e&&(n.removeChild(k),h?n.insertBefore(k,h):n.appendChild(k),e--)}}},l=function(a){for(var b=a.offsetLeft,c=a.offsetTop;a=a.offsetParent;)b+=a.offsetLeft,c+=a.offsetTop;return{x:b,y:c}},k={start:function(){document.addEventListener("mousemove",
f);document.addEventListener("scroll",f)},stop:function(){document.removeEventListener("mousemove",f);document.removeEventListener("scroll",f)},handleEvent:function(f,h){a?(a.style.position="static",L(a.uuid,a.key,e),a=b=c=null,k.stop()):(k.start(),a=this,b=a.parentNode.parentNode.parentNode,d=b.offsetHeight,c=l(b.parentNode.parentNode),c.x=-c.x-a.offsetWidth/2,c.y=-c.y-a.offsetHeight/2,a.style.position="absolute",g(f),e=h)}};return k}(),Pa=function(a){var b=r("span","",a.uuid,"pos_images",!0);if(a.nnew||
a.nativeScript)return b;if(1<a.position||a.position<a.positionof){var c=h("span","clickable movable","position",a.uuid,!0);c.innerHTML="&#9776;";c.title=f.getMessage("Click_here_to_move_this_script");c.uuid=a.uuid;c.key="position";c.addEventListener("click",function(b){Qa.handleEvent.apply(this,[b,a.position])});b.appendChild(c)}return b},Na=function(a){var b=r("span","",a.uuid,"site_images"),c=null;b.inserted&&(c=b,c.setAttribute("id",c.id+"foo"),b=r("span","",a.uuid,"site_images"));if(a.includes||
a.matches)for(var d=0,e=a.includes.length?a.includes:a.matches,g={},f=0;f<e.length;f++){var l=e[f];if(l){if(7<d){a=h("span","",a.uuid,"tbc");a.textContent="...";b.appendChild(a,!0);break}var k=m.getInfoFromUrl(l);if(null==k)l=m.createFavicon("?","",a.uuid,l,l),b.appendChild(l,!0),d++;else{if("*"==k.tld){l=m.createImage(chrome.extension.getURL("/layout/default/images/web.png"),"",a.uuid,l,l);b.appendChild(l,!0);break}if(!g[k.dom]){var s="com",p="";"*"!=k.tld&&"tld"!=k.tld&&(s=k.tld);k.subdom.length&&
(p=k.subdom.join(".")+".");var q=("chrome://favicon/http://"+p+k.dom+"."+s+"/").replace(/\*/g,""),s=("http://"+p+k.dom+"."+s+"/favicon.ico").replace(/\*/g,""),q=[s,q];if(0==s.search("http://userscripts.org/")||0==s.search("http://userscripts.com/"))q=I.origin("uso");l=m.createFavicon(q,"",a.uuid,l,l);b.appendChild(l,!0);g[k.dom]=!0;d++}}}else console.log("o: Warn: script '"+a.name+"' has invalid include (index: "+f+")")}c&&c.parentNode.removeChild(c);return b},La=function(a){var b=r("input","",a.uuid,
"sel");b.type="checkbox";b.s_id=a.uuid;b.name="scriptselectors";b.s_type=a.nativeScript?"n":"s";b.inserted||b.addEventListener("click",function(){w.multiselect.single_click()});return b},ta=function(a){var b=h("input","multiselectcb","sms","all",null),c=h("input","multiselectcb","sms2","all",null);b.inserted||(b.type="checkbox",b.addEventListener("click",w.multiselect.un_selectAll),c.type="checkbox",c.addEventListener("click",w.multiselect.un_selectAll));var d=0,e=[{name:f.getMessage("__Please_choose__"),
value:0},{name:f.getMessage("Enable"),value:1},{name:f.getMessage("Disable"),value:2},{name:f.getMessage("Export"),value:3},{name:f.getMessage("Trigger_Update"),value:5},{name:f.getMessage("Remove"),value:6}],e=m.createDropDown(f.getMessage("Apply_this_action_to_the_selected_scripts"),{value:0,uuid:"sms-select",name:"select"},e,function(){0==this.value?g.setAttribute("disabled","true"):g.removeAttribute("disabled");d=this.value});e.elem.setAttribute("class","float");e.elem.setAttribute("style","display: inline-block;");
var g=m.createButton("MultiSelectButton","button",f.getMessage("Start"),function(){if(0==d)console.log("option: ?!?!");else if(6!=d||confirm(f.getMessage("Really_delete_the_selected_items_"))){for(var a=document.getElementsByName("scriptselectors"),b=[],c=0;c<a.length;c++)b.push(a[c]);for(var a={},e,g=!1,h=100,c=0;c<b.length;c++)b[c].checked&&(1==d||2==d?(e="n"==b[c].s_type?"switchNativeEnabled":"switchEnabled",F(b[c].s_id,e,null,1==d,!1),g=!0):3==d?a[b[c].s_id]=!0:5==d?(e="scriptUpdate",F(b[c].s_id,
e)):6==d&&(e="deleteScript",F(b[c].s_id,e,null,!0),g=!0,h=1500));3==d&&(q.wait(),X(a,{storage:N}).then(function(a){q.wait();return G.zip.download(a).progress(function(a){q.wait(Math.floor(a.item/a.of*100)+"%")})}).always(function(){q.hide()}));g&&(q.wait(f.getMessage("Please_wait___")),window.setTimeout(function(){L(null,!1,null,!0)},h))}});g.setAttribute("class","action_button");g.setAttribute("disabled","true");a=r("div",a.name,a.id,"actions");a.setAttribute("style","display: inline-block;");a.appendChild(e.elem);
a.appendChild(g);return{selAllm:c,selAll:b,actionBox:a}};(function(){var a=0;w.multiselect={};w.multiselect.toggleRow=function(a){var c=$(document.getElementsByName("multiselectcol")||[]);a?c.show():c.hide()};w.multiselect.single_click=function(){for(var b=0,c=document.getElementsByName("scriptselectors"),d=!0,e=!1,g=!1,f=!0,h=!1,k=!1,m=0,p=0;p<c.length;p++)"n"==c[p].s_type?(g=!0,d=d&&c[p].checked,e=e||c[p].checked):"s"==c[p].s_type&&(k=!0,f=f&&c[p].checked,h=h||c[p].checked),c[p].checked&&m++;!g||
!d||k&&!f&&h||(b+=1);!k||!f||g&&!d&&e||(b+=2);b!=a&&(a=b,$(".multiselectcb").prop("checked",0!=b?"checked":""));w.multiselect.toggleRow(m);w.multiselect.checkScroll&&w.multiselect.checkScroll()};w.multiselect.un_selectAll=function(){3<++a&&(a=0);for(var b=!1,c=0,d=document.getElementsByName("scriptselectors"),e=0;e<d.length;e++)0!=e||1!=a&&3!=a||"s"!=d[e].s_type||3<++a&&(a=0),b|="s"==d[e].s_type,d[e].checked=3==a||1==a&&"n"==d[e].s_type||2==a&&"s"==d[e].s_type,d[e].checked&&c++;1<a&&!b&&(a=0);$(".multiselectcb").prop("checked",
0!=a?"checked":"");w.multiselect.toggleRow(c)}})();var S={options:{maxerr:999,newcap:!0,es5:!0,sloppy:!0,browser:!0,white:!0,plusplus:!0,nomen:!0,"continue":!0,todo:!0,eqeq:!0,passfail:!1,unparam:!0,devel:!0},JSLINT_GLOBALS:"CDATA XPathResult xpath uneval escape unescape console JSON TM_info GM_info TM_addStyle TM_deleteValue TM_listValues TM_getValue TM_log TM_registerMenuCommand TM_unregisterMenuCommand TM_openInTab TM_setValue TM_addValueChangeListener TM_removeValueChangeListener TM_xmlhttpRequest TM_getTab TM_setTab TM_saveTab TM_getTabs TM_runNative TM_execUnsafe TM_notification TM_getResourceText TM_getResourceURL GM_addStyle GM_deleteValue GM_listValues GM_getValue GM_log GM_registerMenuCommand GM_unregisterMenuCommand GM_openInTab GM_setValue GM_addValueChangeListener GM_removeValueChangeListener GM_xmlhttpRequest GM_getTab GM_setTab GM_saveTab GM_getTabs GM_setClipboard GM_notification GM_getResourceText GM_getResourceURL".split(" "),
cleanGutters:function(a,b){a.clearGutter("gutter")},setGutters:function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e=0,g=null,h=[];d.marks=[];for(var l=0;l<d.length;l++){var k="",m=d[l];m.stop?(g="no",e=3):m.warn?(1>e&&(g="critical",e=1),k=f.getMessage("Warning")+": "):m.info?(0==e&&(g="info"),k=f.getMessage("Info")+": "):2>e&&(g="error",e=2,k=f.getMessage("Error")+": ");h.push((1<d.length?k:"")+m.text.replace(/\"/g,'\\"'));m.stop||d.marks.push(a.markText({line:m.line-1,ch:m.character-
1},{line:m.line-1,ch:m.character-1+m.evle},{className:"CodeMirror-highlight-"+g}))}d='<span class="editor_gutter" title="'+h.join("\n\n")+'"><span width="15px"><img class="editor_gutter_img" src="/layout/default/images/'+g+'.png"/></span></span>';e=document.createElement("span");e.innerHTML=d;a.setGutterMarker(Number(c)-1,"gutter",e)}return b},run:function(a){a.oldGutters&&S.cleanGutters(a.mirror,a.oldGutters);var b=a.mirror.getValue(),c=null;try{c=JSLINT}catch(d){}var e="/*global "+S.JSLINT_GLOBALS.join(": true, ")+
"*/\n";if(c&&!c(e+b,S.options)){var b={},f;for(f in JSLINT.errors)if((e=JSLINT.errors[f])&&1<e.line){var c=e.line-1,h=e.character,l=0,k=-1!=e.reason.search("Mixed spaces and tabs"),m=0;try{var p=!!e.evidence&&!k;if(p)for(var q=0,r=0;q<h&&r<h;q++,r++)9==e.evidence.charCodeAt(q)&&(r+=v.editor_indentUnit-1,l+=1);h-=l*(v.editor_indentUnit-1);if(p||k)var u=e.evidence.length>h?e.evidence.substr(h-1):"",w=k?u.match(/([ \t])*/):u.match(/([a-zA-Z0-9_])*/),m=w&&w.length?w[0].length:0}catch(A){console.log("jslint: error parsing source "+
A.message)}l=m||1;e={line:c,stop:0==e.reason.search("Stopping"),info:k||-1!=e.reason.search("Combine this with the previous 'var'")||-1!=e.reason.search("Expected '{' and instead saw")||-1!=e.reason.search("Move 'var' declarations to the top"),warn:"(error)"!=e.id||-1!=e.reason.search("used before it was defined"),character:h,evle:l,text:e.reason.replace(/.$/,"")};e.stop&&c++;b[c]||(b[c]=[]);b[c].push(e)}a.oldGutters=S.setGutters(a.mirror,b)}}},T=null,Z=null,A=function(a){null!=T?(window.clearTimeout(T),
T=null,A(a?a:Z.items)):(Z={items:a},T=window.setTimeout(function(){T=null;J=[];var a=Z.items;if(a){var c=document.getElementById("options"),d=h("div","main_container p100100","options","main");if(c){var e=c.parentNode;e.removeChild(c);e.appendChild(d);document.body.setAttribute("class","main")}var c=h("div","head_container","opt","head_container"),e=h("div","tv_container","opt","tv_container"),f=r("a","head_link","fire","head_link");f.href="http://tampermonkey.net";f.target="_blank";var m=h("div",
"float margin4","fire","head1"),l=h("img","banner","fire");l.src=chrome.extension.getURL("images/icon128.png");var k=h("div","float head margin4","fire","head2"),s=r("div","fire"),p=h("div","version","version","version");p.textContent=" by Jan Biniok";var u=r("div","search","box","");s.textContent="Tampermonkey";m.appendChild(l);k.appendChild(s);k.appendChild(p);f.appendChild(m);f.appendChild(k);c.appendChild(f);c.appendChild(u);d.appendChild(c);d.appendChild(e);d=ka.create("_main",e);W(null,a,null,
d);Da();E.push(w.multiselect.single_click);Ba(d);O.selected&&!U&&(a=d.getTabById(O.selected))&&a.select();U=!0;q.hide();pa()}else console.log("options: items is empty!");Z=null},50))},fa=function(a,b){try{var c=function(c){chrome.tabs.sendMessage(c.id,{method:"loadUrl",url:a,newtab:b},function(a){})};b?sendMessage({method:"newTab",url:a},function(a){}):chrome.tabs.getSelected(null,c)}catch(d){console.log("lU: "+d.message)}},Aa=function(a,b){var c=Q();try{sendMessage({method:"exportToJson",ids:a,options:b},
function(a){q.hide();a.json?c.resolve(a.json):c.reject()}),q.wait(f.getMessage("Please_wait___"))}catch(d){console.log("eJ: "+d.message),c.reject({})}return c.promise()},ga=function(a,b){var c=Q();try{sendMessage({method:"importFromJson",json:a,reload:b.reload},function(a){q.hide();a.items&&A(a.items);b.reload&&q.hide();a.err?c.reject(a):c.resolve(a)}),q.wait(f.getMessage("Please_wait___"))}catch(d){console.log("sS: "+d.message),c.reject({err:d.message})}return c.promise()},ia=function(a,b,c){var d=
Q();void 0===c.reload&&(c.reload=!0);try{sendMessage({method:"saveScript",uuid:a,code:b,clean:c.clean,force:c.force,new_script:c.new_script,force_url:c.new_url&&c.new_url!=c.old_url?c.new_url:"",lastModified:c.lastModified,reload:c.reload},function(a){a.items&&A(a.items);!b&&c.reload&&q.hide();d.resolve(a)}),q.wait(f.getMessage("Please_wait___"))}catch(e){console.log("sS: "+e.message),d.reject({err:e.message})}return d.promise()},da=function(a,b,c){try{sendMessage({method:"setOption",name:a,value:b},
function(a){v=a.options||v;c||A(a.items)}),q.wait(f.getMessage("Please_wait___"))}catch(d){console.log("sO: "+d.message)}},va=function(a,b,c,d){try{sendMessage({method:"buttonPress",name:a},function(a){d?window.location.reload():c?q.hide():A(a.items)}),q.wait(f.getMessage("Please_wait___"))}catch(e){console.log("sO: "+e.message)}},Ca=function(a,b,c){void 0==c&&(c=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:c};for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);sendMessage(a,function(a){v=a.options||
v;a.items&&A(a.items)});q.wait(f.getMessage("Please_wait___"))}catch(e){console.log("mSo: "+e.message)}},L=function(a,b,c,d){void 0===d&&(d=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:d},b&&""!=b&&(a[b]=c),sendMessage(a,function(a){v=a.options||v;a.i18n&&f.setLocale(a.i18n);a.items&&A(a.items)}),q.wait(f.getMessage("Please_wait___"))}catch(e){console.log("mSo: "+e.message)}},ja=function(a,b,c,d){void 0===d&&(d=!0);try{sendMessage({method:"modifyNativeScript",nid:a,actionid:b,value:c,reload:d},
function(a){a.items&&A(a.items)}),q.wait(f.getMessage("Please_wait___"))}catch(e){console.log("mSo: "+e.message)}},Ia=function(a,b){try{sendMessage({method:"buttonPress",name:"externals_delete",scriptuid:a,url:b},function(a){a.items&&A(a.items)}),q.wait(f.getMessage("Please_wait___"))}catch(c){console.log("dEx: "+c.message)}},Ja=function(a,b){try{sendMessage({method:"buttonPress",name:"run_script_updates",scriptuid:a},function(a){b&&b(a.updatable)})}catch(c){console.log("rSu: "+c.message)}},Ka=function(a,
b,c){try{sendMessage({method:"reportAnIssue",uuid:a,to:b},function(a){c&&c()})}catch(d){console.log("rRi: "+d.message)}};chrome.extension.onMessage.addListener(function(a,b,c){if("updateOptions"==a.method)v=a.options||v,A(a.items),c({});else if("confirm"==a.method)u.confirm(a.msg,function(a){c({confirm:a})});else if("showMsg"==a.method)u.alert(a.msg),c({});else return!1;return!0});sendMessage({method:"modifyScriptOptions"},function(a){v=a.options||v;a.i18n&&f.setLocale(a.i18n);a.items&&A(a.items)})})});
